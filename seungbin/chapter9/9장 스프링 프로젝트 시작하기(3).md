## 9.3.3 오브젝트 중심 아키텍처

오브젝트 중심 아키텍처가 데이터 중심 아키텍처와 다른 가장 큰 특징은 도메인 모델을 반영하는 오브젝트 구조를 만들어두고 그것을 각 계층 사이에서 정보를 전송하는 데 사용한다는 것이다.

### 데이터와 오브젝트

데이터 중심의 아키텍처는 기본적으로 SQL과 DB관점에서 생각한다.

그렇기에 데이터 중심의 아키텍처에서는 DAO가 만드는 SQL의 결과에 모든 계층의 코드가 의존하게 된다.

하지만 오브젝트 방식은 다르다.

도메인 모델은 애플리케이션 전 계층에서 동일한 의미를 갖는다. 따라서 도메인 모델이 반영된 도메인 오브젝트도 전 계층에서 일관된 구조를 유지한 채로 사용될 수 있다.

### 도메인 오브젝트를 사용하는 코드

도메인 중심의 오브젝트 방식에서는 메소드가 무슨 작업을 하는 지 이해하기 쉽다. 테스트를 만들어 검증하기도 쉬우며 로직이 변경될 때 코드를 수정하기도 수월하다.

하지만 데이터 중심에서는 재사용 가능한 메소드를 만들어 사용하기가 쉽지 않다.

만약 조인을 해서 가져온 경우라면 별도의 합계 계산 코드를 만들어야 한다.

→ 도메인 오브젝트를 사용하는 코드는 간단히 테스트 값을 담은 도메인 오브젝트를 생성해서 쉽게 검증할 수 있다.

### 도메인 오브젝트 사용의 문제점

기본적으로 장점이 많지만 최적화된 SQL을 만들어 사용하는 경우에 비해 성능 면에서 조금은 손해를 감수해야 한다.

다양한 문제를 해결하기 위해 지연된 로딩 기법을 이용해 최소한의 오브젝트 정보만 읽어두고 관계하고 있는 오브젝트가 필요한 경우에만 다이내믹하게 DB에서 다시 읽어올 수 있다.

그런 성능을 증가시키기 위해 도메인 오브젝트를 사용하는 오브젝트 중심 아키텍처에서는 가능하다면 ORM을 사용한다.

### 빈약한 도메인 오브젝트 방식

도메인 오브젝트에 정보만 담겨 있고, 정보를 활용하는 아무런 기능도 갖고 있지 않다면 이는 온전한 오브젝트라고 보기 힘들다. 이를 빈약한 오브젝트라고 부른다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/0da01a99-5a0d-45ba-9b0f-4138668967c6/95ac009b-961a-4dda-83c1-97153b01fcae/Untitled.png)

빈약한 도메인 오브젝트 방식의 한계는 거대 서비스 계층 방식과 유사하다. 서비스 계층의 메소드에 대부분의 비즈니스 로직이 들어 있기 때문에 로직의 재사용성이 떨어지고 중복의 문제가 발생하기 쉽다.

### 풍성한 도메인 오브젝트 방식

빈약한 오브젝트의 단점을 극복하고 도메인 오브젝트의 객체지향적인 특징을 잘 사용할 수 있도록 개선한 것이다.

비즈니스 로직이 특정 도메인 오브젝트에 깊은 관계가 있을 경우에 서비스 계층의 코드가 아니라 도메인 오브젝트에 넣어주고, 서비스 계층의 비즈니스 로직에서 재사용하게 만드는 것이다.

도메인 오브젝트는 DAO 오브젝트를 DI 받을 수 없을까? 그것은 도메인 오브젝트는 스프링 컨테이너가 관리하는 오브젝트, 즉 빈이 아니기 때문이다.

그래서 DAO와 기반계층 오브젝트를 DI받아 사용할 수 있는 서비스 계층의 코드가 필요하다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/0da01a99-5a0d-45ba-9b0f-4138668967c6/7848e760-b7e8-4568-9dfe-917e5c8325e3/Untitled.png)

### 도메인 계층 방식

도메인 오브젝트에는 담을 수 있는 비즈니스 로직은 데이터 엑세스 계층에서 가져온 내부 데이터를 분석하거나 조건에 따라 오브젝트 정보를 변경, 생성 하는 정도에 그칠 수밖에 없다.

도메인 계층의 역할과 비중을 극대화하려다 보면 결국 기존 3계층과 같은 레벨로 격상되어 하나의 계층을 이루게 하는 도메인 계층 방식이다.

도메인 오브젝트가 독립된 계층을 이루면서 2가지 특징을 가지게 된다.

1. 도메인에 종속적인 비즈니스 로직의 처리는 서비스 계층이 아니라 도메인 계층의 오브젝트 안에서 진행된다는 점이다.
2. 도메인 오브젝트가 기존 데이터 엑세스 계층이나 기반 계층의 기능을 직접 활용할 수 있다는 점이다.

다만 도메인 오브젝트를 독립적인 계층으로 만들려고 할 때 고려해야 할 중요한 사항이 있다.

1. 모든 계층에서 도메인 오브젝트를 사용한다.
2. 도메인 오브젝트는 도메인 계층을 벗어나지 못하게 하는 것이다.

이 두 가지 중에서는 기존의 DTO를 이용한 개발에 익숙해져 있다면 후자도 좋고 번거로운 작업은 최소화하고 싶고 표준 개발 정책을 따라서 개발하도록 개발팀을 관리할 수 있다면 전자가 편리하다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/0da01a99-5a0d-45ba-9b0f-4138668967c6/d6a5100f-295c-47cd-a137-6a7a03dd6603/Untitled.png)

도메인 계층은 서비스를 제공하는 싱글톤으로 계속 존재하는 다른 계층의 오브젝트와 달리, 도메인 계층의 오브젝트는 매우 짧은 시간 동안만 존재했다가 사라지는 것을 반복한다.

따라서 이렇게 복잡하기 때문에 도메인 계층을 이용하는 방식을 선택할 때는, 오브젝트 중심 아키텍처의 기본 두 가지 방법을 충분히 경험해보고 오브젝트 중심의 개발 방식에 익숙해진 뒤에 조심스럽게 해야 하는 것이다.

### DTO와 리포트 쿼리

오브젝트 중심 아키텍처라고 해서 애플리케이션 내의 모든 정보를 항상 도메인 오브젝트에 담고 다닐 필요는 없다.

도메인 계층 방식의 경우 도메인 계층을 벗어난 정보를 DTO라 불리는 특정 계층에 종속되지 않는 정보 전달의 목적을 가진 단순 오브젝트에 담아 사용하기도 한다.

대표적인 예는 리포트 쿼리라고 DB쿼리의 실행 결과를 담는 경우다.

## 9.3.4 스프링 애플리케이션을 위한 아키텍처 설계

### 계층형 아키텍처

스프링의 구조는 3계층 구조에 적합하도록 설계되어 있지만 비즈니스 로직이 간단하다면 서비스 계층과 데이터 엑세스 계층을 통합할 수도 있다.

또한 프레젠테이션 계층에 서비스계층을 통합하는 방법도 가능하다.

다만 이 방법은 트랜잭션 경계설정도 애매해지고 AOP를 사용해 경계를 설정하기도 애매해 권장되지 않는다.

SOFEA라고 불리는 아키텍처는 프레젠테이션 계층의 코드가 서버에서 클라이언트로 다운로드돼서 클라이언트 장치 안에서 동작하면서 서버에 존재하는 서비스 계층 또는 부분 프레젠테이션 계층과 통신하는 구조로 만들어진다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/0da01a99-5a0d-45ba-9b0f-4138668967c6/ac42b36c-5b1f-418e-b203-2d33718c4607/Untitled.png)

3계층 방식의 코드의 익숙해진 다음 다양한 방식으로 계층구조의 통하보가 분산을 시도해보는 것이 좋다.

### 정보 전송 아키텍처

빈약한 오브젝트 방식에서 시작하고 도메인 오브젝트 형태를 유지하게 만들며 시작하는 것이 좋다. 다만 DB와 SQL에 많은 비즈니스 로직을 담고 있는 레거시 시스템을 스프링으로 전환하는 경우라면, 일단 데이터 중심의 아키텍처를 사용해도 무방하다.

### 상태 관리와 빈 스코프

아키텍처 설계에서 한 가지 더 신경 써야 할 사항은 상태 관리다.

서버 기반의 애플리케이션은 원래 지속적으로 유지되는 상태를 갖지 않는다는 특징이 있다.

중요한 상태정보를 저장해야 하는 경우에는 DB, 데이터그리드, 파일 시스템에 저장한다. 또는 제약이 있기는 하지만 HTTP 세션과 같은 서블릿 컨테이너가 제공하는 저장공간을 활용하기도 한다.

### 서드파티 프레임워크, 라이브러리 적용

스프링이 지원하는 기술은 무엇인가

첫째, 해당 기술을 스프링의 DI패턴을 따라 사용할 수 있다.

둘쨰, 스프링의 서비스 추상화가 적용됐다.

셋째, 스프링이 지지하는 프로그래밍 모델을 적용했다.

넷째, 템플릿/콜백이 지원된다.

스프링이 가지는 철학에 공감하고 적용하는 기술을 스프링스럽게 풀어가는 것이 중요하다.

# 9.4 정리

- 스프링은 어떤 플랫폼에서도 사용될 수 있지만, 기본적으로는 자바 엔터프라이즈 플랫폼에 최적화되어 있다. HTTP를 통해 접근하는 웹 클라이언트와 백엔드 DB를 사용하는 애플리케이션에 적합하다.
- 스프링 개발의 생산성을 증대시키고 품질을 높이려면 SpringIDE 플러그인이나 STS 같은 적절한 툴의 지원이 필요하다.
- 스프링은 의존 라이브러리가 방대하기 때문에 라이브러리 관리와 의존관계를 관리하는 데 많은 노력을 기울여야 한다. 가능하면 스프링이 의존관계 정보를 제공해주는 Maven이나 Ivy 같은 빌드 툴을 사용해 의존 라이브러리를 관리하는 것이 바람직하다.
- 스프링 애플리케이션은 역할에 따라 3계층으로 구분되고, 다시 기술의 추상도에 따라 세분화되는 계층형 아키텍처를 사용하는 것이 좋다.
- 아키텍처는 애플리케이션이 다루는 정보의 관점에서 데이터 중심과 오브젝트 중심으로 구분할 수 있다.
- 스프링이 가장 잘 어울리는 아키텍처는 오브젝트 중심의 아키텍처다.
- 스프링이 직접 지원하지 않는 서드파트 기술도 스프링 스타일의 접근 방식을 따라서 사용할 수 있도록 준비해둬야 한다.

# 7.6 ìŠ¤í”„ë§ 3.1ì˜ DI
- ìŠ¤í”„ë§ì€ 1.0ë¶€í„° 3.1ê¹Œì§€ ê±°ì˜ ì™„ë²½ì— ê°€ê¹Œìš¸ ë§Œí¼ êµ¬ ë²„ì „ í˜¸í™˜ì„±ì„ ìœ ì§€í•˜ê³  ìˆë‹¤.
  - ê°ì²´ì§€í–¥ì ì¸ ì½”ë“œì˜ ì¥ì ì¸ **ìœ ì—°ì„±ê³¼ í™•ì¥ì„±**ì„ ì§€ì¼œì™”ë‹¤.
  - DI ì›ì¹™ì„ ì¶©ì‹¤í•˜ê²Œ ë”°ë¼ ë§Œë“¤ì–´ì¡Œë‹¤.
 
<br/>

### ìë°” ì–¸ì–´ì˜ ë³€í™”ì™€ ìŠ¤í”„ë§
- **ì–´ë…¸í…Œì´ì…˜ ë©”íƒ€ì •ë³´ í™œìš©**
  - ì½”ë“œì˜ ë™ì‘ì— ì§ì ‘ ì˜í–¥ì„ ì£¼ì§€ëŠ” ëª»í•˜ì§€ë§Œ ë©”íƒ€ì •ë³´ë¡œì„œ í™œìš©ë˜ëŠ” ë°ëŠ” XMLì— ë¹„í•´ ìœ ë¦¬í•œ ì ì´ ë§ë‹¤.
  - ì–´ë…¸í…Œì´ì…˜ í•˜ë‚˜ë¥¼ ë„£ëŠ” ê²ƒë§Œìœ¼ë¡œ, ì–´ë…¸í…Œì´ì…˜ì„ ì°¸ê³ í•˜ëŠ” ì½”ë“œì—ì„œ ë‹¤ì–‘í•œ ë¶€ê°€ ì •ë³´ë¥¼ ì–»ì–´ë‚¼ ìˆ˜ ìˆë‹¤.
    ```
    package com.mycompany.myproject;

    @Special
    public class MyClass {
      ...
    }
    ```
    - @Special ì–´ë…¸í…Œì´ì…˜ì´ íƒ€ì… ë ˆë²¨(í´ë˜ìŠ¤)ì— ë¶€ì—¬ëë‹¤.
    - ì–´ë…¸í…Œì´ì…˜ì´ ë¶€ì—¬ëœ í´ë˜ìŠ¤ì˜ íŒ¨í‚¤ì§€, í´ë˜ìŠ¤ ì´ë¦„, ì ‘ê·¼ ì œí•œì, ìƒì†í•œ í´ë˜ìŠ¤ë‚˜ êµ¬í˜„ ì¸í„°í˜ì´ìŠ¤ê°€ ë¬´ì—‡ì¸ì§€ ì•Œ ìˆ˜ ìˆë‹¤.
    - í´ë˜ìŠ¤ì˜ í•„ë“œë‚˜ ë©”ì„œë“œ êµ¬ì„±ë„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
   
  - ğŸ‘ ìë°” ì½”ë“œì— ì¡´ì¬í•˜ë¯€ë¡œ ë³€ê²½í•  ë•Œë§ˆë‹¤ ë§¤ë²ˆ í´ë˜ìŠ¤ë¥¼ ìƒˆë¡œ ì»´íŒŒì¼í•´ì¤˜ì•¼ í•œë‹¤.
  - ìë°” ê°œë°œì˜ íë¦„ì€ ì ì°¨ í…ìŠ¤íŠ¸ í˜•íƒœì˜ ë©”íƒ€ì •ë³´ í™œìš©(XML)ì„ ìë°” ì½”ë“œì— ë‚´ì¥ëœ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ëŒ€ì²´í•˜ëŠ” ìª½ìœ¼ë¡œ ê°€ê³  ìˆë‹¤.
  - ìŠ¤í”„ë§ 3.1ì—ì„œëŠ” XML ì—†ì´ë„ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ëŒ€ì²´í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‘ì„±í•  ìˆ˜ ìˆê²Œ ëë‹¤.
 
- ì •ì±…ê³¼ ê´€ê³„ë¥¼ ì´ìš©í•œ í”„ë¡œê·¸ë˜ë°
  - ìŠ¤í”„ë§ì€ ì ì°¨ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ë©”íƒ€ì •ë³´ë¥¼ ì‘ì„±í•œë‹¤.
  - ë¯¸ë¦¬ ì •í•´ì§„ ì •ì±…ê³¼ ê´€ë¡€ë¥¼ í™œìš©í•´ì„œ ê°„ê²°í•œ ì½”ë“œì— ë§ì€ ë‚´ìš©ì„ ë‹´ì„ ìˆ˜ ìˆëŠ” ë°©ì‹ì„ ì ê·¹ ë„ì…í•˜ê³  ìˆë‹¤.
 
<br/>

## 7.6.1 ìë°” ì½”ë“œë¥¼ ì´ìš©í•œ ë¹ˆ ì„¤ì •
- ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì™€ DI ì •ë³´ë¥¼ ì´ìš©í•´ í…ŒìŠ¤íŠ¸í•˜ëŠ” UserDaoTestì™€ UserServiceTest 2ê°€ì§€ë§Œ ì‹ ê²½ì„ ì“°ë©´ ëœë‹¤.
  - DI ê´€ë ¨ ì •ë³´ì™€ ì½”ë“œë¥¼ ìŠ¤í”„ë§ 3.1ë¡œ ë³€ê²½í•œë‹¤.
  - í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ê¸°ì¡´ XMLì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ìš´ì˜í™˜ê²½ì—ì„œ ë™ì‘í•  ë•Œ í•„ìš”ë¡œ í•˜ëŠ” DI ì •ë³´ë¥¼ ë¶„ë¦¬í•œë‹¤.
 
<br/>

### í…ŒìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ì˜ ë³€ê²½
- í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ DI ì •ë³´ê°€ XMLì— ë‹´ê²¨ ìˆë‹¤ê³  ì •ì˜í•œ ë¶€ë¶„ì„ ì°¾ì•„ DI ì •ë³´ë¥¼ ë‹´ì€ ìë°” ì½”ë“œë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë°”ê¾¼ë‹¤.

<br/>

```java
@Configuration
public class TestApplicationContext {
}
```
ğŸ”¼ DI ë©”íƒ€ì •ë³´ë¡œ ì‚¬ìš©ë  TestApplicationContext í´ë˜ìŠ¤
- ì•ìœ¼ë¡œ XMLì„ ëŒ€ì²´í•˜ëŠ” DI ì„¤ì •ì •ë³´ë¡œ ì‚¬ìš©ëœë‹¤.

<br/>

```java
@ExtendWith(SpringExtension.class)
@ContextConfiguration(classes = TestApplicationContext.class)
public class UserDaoTest {
```
ğŸ”¼ TestApplicationContextë¥¼ í…ŒìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ë¡œ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½í•œ UserDaoTest
- locations ì—˜ë¦¬ë¨¼íŠ¸ ëŒ€ì‹  classesë¥¼ ë„£ì–´ì„œ TestApplicationContextë¥¼ ì§€ì •í•œë‹¤.
- UserServiceTestë„ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•œë‹¤.
- TestApplicationContextì— `test-applicationContext.xml` íŒŒì¼ì„ ì„í¬íŠ¸í•˜ë©´ ìš°ì„  í…ŒìŠ¤íŠ¸ëŠ” ì„±ê³µí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<br/>

### <context:annotation-config /> ì œê±°
- <context:annotation-config /> íƒœê·¸ë¥¼ ë¨¼ì € ì œê±°í•œë‹¤.
  - @PostConstructë¥¼ ë¶™ì¸ ë©”ì„œë“œê°€ ë¹ˆì´ ì´ˆê¸°í™”ëœ í›„ì— ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ë„ë¡ ì‚¬ìš©í–ˆë‹¤.
  - ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì°¸ê³ í•˜ëŠ” DI ì •ë³´ì˜ ìœ„ì¹˜ê°€ XMLì—ì„œ TestApplicationContextë¼ëŠ” ìë°” í´ë˜ìŠ¤ë¡œ ë°”ë€Œì—ˆê¸° ë•Œë¬¸ì— í•´ë‹¹ íƒœê·¸ë¥¼ ì œê±°í•´ë„ ëœë‹¤.
  - ì»¨í…Œì´ë„ˆê°€ ì§ì ‘ @PostConstruct ì–´ë…¸í…Œì´ì…˜ì„ ì²˜ë¦¬í•˜ëŠ” ë¹ˆ í›„ì²˜ë¦¬ê¸°ë¥¼ ë“±ë¡í•´ì¤€ë‹¤.
 
<br/>

### `<bean>`ì˜ ì „í™˜

> **dataSource ë¹ˆ**

<img width="626" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/a07d3491-6dd4-4d6f-bf85-a0766196dde5">

ğŸ”¼ XMLì„ ì´ìš©í•œ dataSource ë¹ˆì˜ ì •ì˜

<br/>

```java
@Bean
	public DataSource dataSource() {
```
- @Beanì´ ë¶™ì€ public ë©”ì„œë“œë¡œ ë§Œë“ ë‹¤.
- ë©”ì„œë“œ ì´ë¦„ì€ <bean>ì˜ id ê°’ìœ¼ë¡œ í•œë‹¤.
- ë¹ˆì˜ ì˜ì¡´ê´€ê³„ê°€ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì•ˆì „í•˜ê²Œ ë§ºì–´ì§€ë„ë¡ dataSource ë¹ˆì˜ ë¦¬í„´ ê°’ íƒ€ì…ì€ DataSource ì¸í„°í˜ì´ìŠ¤ë¡œ í•œë‹¤.
- ìƒì„±í•  ë¹ˆ ì˜¤ë¸Œì íŠ¸ì˜ í´ë˜ìŠ¤ëŠ” <bean>ì˜ classì— ë‚˜ì˜¨ ê²ƒì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

<br/>

```java
SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
```
- DB ì—°ê²°ì •ë³´ë¥¼ ë„£ê¸° ìœ„í•´ setUrl() ë˜ëŠ” setUsername() ê°™ì€ ìˆ˜ì •ì ë©”ì„œë“œê°€ í•„ìš”í•˜ë‹¤.
- í•˜ì§€ë§Œ ì¸í„°í˜ì´ìŠ¤ì—ì„œëŠ” DB ì»¤ë„¥ì…˜ì„ ê°€ì ¸ì˜¤ëŠ” ê¸°ëŠ¥ë§Œ ì œê³µí•œë‹¤.
- ë”°ë¼ì„œ ë¹ˆ ë‚´ë¶€ì—ì„œ new í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´ ë¹ˆ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ê²½ìš°ì—ëŠ” **êµ¬í˜„ í´ë˜ìŠ¤ íƒ€ì…**ìœ¼ë¡œ ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤.
- ì´í›„ í•„ìš”í•œ í”„ë¡œí¼í‹° ê°’ì„ ë„£ì–´ì£¼ë„ë¡ ìˆ˜ì •ì ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•˜ê³ , ë§ˆì§€ë§‰ìœ¼ë¡œ ìƒì„±ëœ ë¹ˆ ì˜¤ë¸Œì íŠ¸ë¥¼ ë¦¬í„´í•œë‹¤.

<br/>

```java
import java.sql.Driver;
...
dataSource.setDriverClass(Driver.class);
```
- driverClass í”„ë¡œí¼í‹°ëŠ” Class<? extends Driver> íƒ€ì…ì´ë¼ Class íƒ€ì…ì˜ ë“œë¼ì´ë²„ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

<br/>

<img width="500" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/f8bc12f8-05d2-4146-bb83-4daace06c1ac">

ğŸ”¼ ìë°” ì½”ë“œë¡œ ì‘ì„±í•œ dataSource ë¹ˆ

<br/>

> **transactionManager ë¹ˆ**

<img width="500" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/ae0be59f-95ad-496f-a77b-ada3df75e5cc">

ğŸ”¼ XMLë¡œ ì •ì˜í•œ transactionManager ë¹ˆ

<br/>

<img width="500" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/7431c319-869a-409f-af68-e358a476f8fc">

ğŸ”¼ ìë°” ì½”ë“œë¡œ ì •ì˜í•œ transactionManager ë¹ˆ
- XMLë¡œ ì •ì˜ëœ transactionManager ë¹ˆì„ TestApplicationContext ë‚´ì˜ ë©”ì„œë“œë¡œ ì „í™˜í•œë‹¤.
- ì£¼ì…í•´ì¤„ ë¹ˆ(DataSource)ì˜ ë©”ì„œë“œë¥¼ ì§ì ‘ í˜¸ì¶œí•´ì„œ ê·¸ ë¦¬í„´ ê°’ì„ ìˆ˜ì •ì ë©”ì„œë“œì— ë„£ì–´ì£¼ë©´ ëœë‹¤.

<br/>

> **userDao, userService, testUserService, mailSender ë¹ˆ**

<img width="500" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/ba1f748d-2c41-4652-bd99-bd17934bdab0">

ğŸ”¼ XMLì˜ ë¹ˆ ì •ì˜

<br/>

<img width="500" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/930605c2-6098-4e1b-a6f6-1781c6dfa1ac">

ğŸ”¼ @Bean ë©”ì„œë“œë¡œ ë³€í™˜í•œ ë¹ˆ ì •ì˜
- `sqlService()`ì—ì„œ ì—ëŸ¬ê°€ ë‚œë‹¤.
  - sqlService ë¹ˆì€ ì•„ì§ ë©”ì„œë“œë¡œ ë§Œë“¤ì–´ì§€ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë‹¤.
 
<br/>

<img width="500" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/76bc326e-2701-411d-a5e3-9979ddbd55f0">

ğŸ”¼ @Autowiredë¥¼ ì´ìš©í•´ì„œ XML ë¹ˆì„ ì°¸ì¡°í•˜ê²Œ ë§Œë“  userDao() ë©”ì„œë“œ
- XMLì— ì •ì˜ëœ ë¹ˆì€ @Autowiredê°€ ë¶™ì€ í•„ë“œë¥¼ ì„ ì–¸í•´ì„œ ì»¨í…Œì´ë„ˆê°€ ì£¼ì…í•´ì£¼ê²Œ í•´ì•¼ í•œë‹¤.

<br/>

> **sqlService, sqlRegistry, unmarshaller ë¹ˆ**

<img width="500" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/2a4b4db2-989c-45b4-9622-70911b0879a9">
<br/>
<img width="500" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/0e5bd698-dc10-43dc-b4cd-9d280b252b44">

ğŸ”¼ SQL ì„œë¹„ìŠ¤ë¥¼ ìœ„í•œ 3ê°œì˜ ë¹ˆ

<br/>

<img width="500" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/ecd76124-67a2-4635-9689-c5412f034157">

ğŸ”¼ SQL ì„œë¹„ìŠ¤ë¥¼ ìœ„í•œ 3ê°œì˜ @Bean ë©”ì„œë“œ
- embeddedDatabaseëŠ” `<bean>`ì´ ì•„ë‹ˆë¼ `<jdbc:embedded-database>` ì „ìš© íƒœê·¸ë¡œ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì— ì•„ì§ ê·¸ëŒ€ë¡œ ë‘”ë‹¤.
- ì´ë¯¸ ì¡´ì¬í•˜ëŠ” DataSource íƒ€ì…ì˜ ë¹ˆì´ ì¡´ì¬í•˜ë¯€ë¡œ íƒ€ì…ì„ ê¸°ì¤€ìœ¼ë¡œ ì£¼ì…ë°›ê²Œ ë§Œë“¤ë©´ í˜¼ë€ì´ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ í•„ë“œ ì´ë¦„ê³¼ ì¼ì¹˜í•˜ëŠ” ë¹ˆ ì•„ì´ë””ë¥¼ ê°€ì§„ ë¹ˆì„ ì£¼ì…ë°›ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” @Resourceë¥¼ ì´ìš©í•œë‹¤.

<br/>

### ì „ìš© íƒœê·¸ ì „í™˜

<img width="632" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/868f722a-8317-426a-b8d3-3ca3c199e5cf">

ğŸ”¼ XMLì— ë‚¨ì€ 2ê°œì˜ ë¹ˆ

<br/>

<img width="500" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/05ca41b4-c131-4eb1-9db8-19b8ffdf1745">

ğŸ”¼ ë‚´ì¥í˜• DB ë¹ˆì„ ìƒì„±í•˜ëŠ” @Bean ë©”ì„œë“œ

- ë‚´ì¥í˜• DBë¥¼ ìƒì„±í•˜ëŠ” ì „ìš© íƒœê·¸ëŠ” typeì— ì§€ì •í•œ ë‚´ì¥í˜• DBë¥¼ ìƒì„±í•˜ê³ , `<jdbc:script>`ë¡œ ì§€ì •í•œ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì´ˆê¸°í™”í•œ ë’¤ì— DataSource íƒ€ì… DBì˜ ì»¤ë„¥ì…˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì¤€ë‹¤. ë¹ˆì˜ íƒ€ì…ì€ DataSourceë‹¤.
- EmbeddedDatabaseBuilderë¥¼ ì´ìš©í•´ì„œ `<jdbc:embedded-database>` ë¹ˆ ì •ì˜ì— í•´ë‹¹í•˜ëŠ” ë¹ˆ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•´ì£¼ëŠ” ì½”ë“œë¥¼ ë§Œë“¤ì—ˆë‹¤.

<br/>

<img width="500" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/6e2db962-6d68-41f7-bd91-42437518cbd0">

- `<tx:annotation-driven />`ì˜ ì˜µì…˜ì„ ì£¼ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ìœ„ 4ê°€ì§€ í´ë˜ìŠ¤ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì£¼ì–´ì•¼ í•œë‹¤.
- ìŠ¤í”„ë§ 3.1ë¶€í„°ëŠ” @EnableTransactionManagement ì–´ë…¸í…Œì´ì…˜ í•˜ë‚˜ ë¶™ì—¬ì£¼ëŠ” ê²ƒë§Œìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ ë³€í™˜í•  ìˆ˜ ìˆë‹¤.

<br/>

```java
@Configuration
@EnableTransactionManagement
public class TestApplicationContext {

	/**
	 * DB ì—°ê²°ê³¼ íŠ¸ëœì­ì…˜
	 */

	@Bean
	public DataSource dataSource() {
		SimpleDriverDataSource dataSource = new SimpleDriverDataSource();

		dataSource.setDriverClass(Driver.class);
		dataSource.setUrl("jdbc:mysql://localhost/springbook?characterEncoding=UTF-8");
		dataSource.setUsername("spring");
		dataSource.setPassword("book");

		return dataSource;
	}

	@Bean
	public PlatformTransactionManager transactionManager() {
		DataSourceTransactionManager tm = new DataSourceTransactionManager();
		tm.setDataSource(dataSource());
		return tm;
	}

	/**
	 * ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ & í…ŒìŠ¤íŠ¸
	 */

	@Autowired SqlService sqlService;

	@Bean
	public UserDao userDao() {
		UserDaoJdbc dao = new UserDaoJdbc();
		dao.setDataSource(dataSource());
		dao.setSqlService(this.sqlService);
		return dao;
	}

	@Bean
	public UserService userService() {
		UserServiceImpl service = new UserServiceImpl();
		service.setUserDao(userDao());
		service.setMailSender(mailSender());
		return service;
	}

	@Bean
	public UserService testUserService() {
		TestUserService testService = new TestUserService();
		testService.setUserDao(userDao());
		testService.setMailSender(mailSender());
		return testService;
	}

	@Bean
	public MailSender mailSender() {
		return new DummyMailSender();
	}

	/**
	 * SQL ì„œë¹„ìŠ¤
	 */

	@Bean
	public SqlService sqlService() {
		OxmSqlService sqlService = new OxmSqlService();
		sqlService.setUnmarshaller(unmarshaller());
		sqlService.setSqlRegistry(sqlRegistry());
		return sqlService;
	}

	@Bean
	public SqlRegistry sqlRegistry() {
		EmbeddedDbSqlRegistry sqlRegistry = new EmbeddedDbSqlRegistry();
		sqlRegistry.setDataSource(embeddedDatabase());
		return sqlRegistry;
	}

	@Bean
	public Unmarshaller unmarshaller() {
		Jaxb2Marshaller marshaller = new Jaxb2Marshaller();
		marshaller.setContextPath("com.company.project.sql.service.jaxb");
		return marshaller;
	}

	@Bean
	public DataSource embeddedDatabase() {
		return new EmbeddedDatabaseBuilder()
				.setName("embeddedDatabase")
				.setType(EmbeddedDatabaseType.HSQL)
				.addScript("classpath:sql/sqlRegistrySchema.sql")
				.build();
	}
}
```
ğŸ”¼ XMLì˜ ë¹ˆ ì„¤ì •ì •ë³´ë¥¼ ìë°” ì½”ë“œë¡œ ë³€í™˜í•œ TestApplicationContext
- ìµœì¢… ì™„ì„±ëœ TestApplicationContext ì´ë‹¤.
- @ImportResourceë¥¼ ì œê±°í–ˆë‹¤.
- test-applicationContext.xml íŒŒì¼ë„ ì œê±°í–ˆë‹¤.

<br/>

## 7.6.2 ë¹ˆ ìŠ¤ìºë‹ê³¼ ìë™ì™€ì´ì–´ë§
### @Autowiredë¥¼ ì´ìš©í•œ ìë™ì™€ì´ì–´ë§
- ìë™ì™€ì´ì–´ë§ì„ ì´ìš©í•˜ë©´ ì»¨í…Œì´ë„ˆê°€ ì´ë¦„ì´ë‚˜ íƒ€ì…ì„ ê¸°ì¤€ìœ¼ë¡œ ì£¼ì…ë  ë¹ˆì„ ì°¾ì•„ì¤€ë‹¤.

<br/>

```java
public class UserDaoJdbc implements UserDao {

	@Autowired
	public void setDataSource(DataSource dataSource) {
		this.jdbcTemplate = new JdbcTemplate(dataSource);
	}
```
ğŸ”¼ dataSource ìˆ˜ì •ìì— @Autowired ì ìš©
- ìë™ì™€ì´ì–´ë§ ì„¤ì • í›„ TestApplicationContextì˜ userDao()ì—ì„œ setDataSourceë¥¼ ì œê±°í•´ë„ í…ŒìŠ¤íŠ¸ëŠ” ì„±ê³µí•œë‹¤.
  
  <img width="500" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/9cc5497b-d4ff-4aa0-883d-80528ac17c66">

  
<br/>

```java
public class UserDaoJdbc implements UserDao {
	...
	
	@Autowired
	private SqlService sqlService;

	public void setSqlService(SqlService sqlService) {
		this.sqlService = sqlService;
	}
```
ğŸ”¼ sqlService í•„ë“œì— @Autowired ì ìš©
- userDao()ë¥¼ ê°„ë‹¨íˆ ë¹ˆ ì¸ìŠ¤í„´ìŠ¤ë§Œ ìƒì„±í•˜ë„ë¡ ë³€ê²½í•˜ê³ , sqlService ë¹ˆì„ ì°¸ì¡°í•˜ê¸° ìœ„í•œ @Autowiredë„ ì‚­ì œí•œë‹¤.
- í•„ë“œì— ì§ì ‘ ê°’ì„ ë„£ì„ ìˆ˜ ìˆë‹¤ë©´ ìˆ˜ì •ì ë©”ì„œë“œëŠ” ì—†ì–´ë„ ë˜ë¯€ë¡œ setSqlService ë©”ì„œë“œë„ ìƒëµí•´ë„ ëœë‹¤.
  
  <img width="482" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/579d714e-584e-4de1-add1-ead5f2c61715">

  ğŸ”¼ @Autowiredë¥¼ ì£¼ì…í•œ í›„ì˜ userDao() ë©”ì„œë“œ

<br/>

### @Componentë¥¼ ì´ìš©í•œ ìë™ ë¹ˆ ë“±ë¡
- ìŠ¤í”„ë§ì´ ì–´ë…¸í…Œì´ì…˜ì— ë‹´ê¸´ ë©”íƒ€ì •ë³´ë¥¼ ì´ìš©í•˜ê¸° ì‹œì‘í–ˆì„ ë•Œ @Autowiredì™€ í•¨ê»˜ ì†Œê°œëœ ëŒ€í‘œì ì¸ ì–´ë…¸í…Œì´ì…˜
- í´ë˜ìŠ¤ì— ë¶€ì—¬ë˜ë©°, ëŒ€ìƒ í´ë˜ìŠ¤ëŠ” ë¹ˆ ìŠ¤ìºë„ˆë¥¼ í†µí•´ ìë™ìœ¼ë¡œ ë¹ˆìœ¼ë¡œ ë“±ë¡ëœë‹¤.

<br/>

<img width="500" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/fe9cc43b-fc6f-40e4-986b-8ab9db5501de">

ğŸ”¼ userDao() ë©”ì„œë“œ ì œê±°
- TestApplicationContextì—ì„œ userDao()ë¥¼ ì œê±°í•˜ê³  @Autowiredë¥¼ í†µí•´ userDao ë¹ˆì„ ì°¸ì¡°í•˜ë„ë¡ ìˆ˜ì •í•œë‹¤.

<br/>

```java
@Component
public class UserDaoJdbc implements UserDao {
```
ğŸ”¼ @Component ì ìš©
- ìë™ ë¹ˆ ë“±ë¡ ëŒ€ìƒì´ ë  UserDaoJdbc í´ë˜ìŠ¤ì— @Component ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•œë‹¤.
  - ìœ„ì—ì„œ ë°œìƒí–ˆë˜ ì»´íŒŒì¼ ì˜¤ë¥˜ê°€ ì‚¬ë¼ì§„ë‹¤.

    <img width="200" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/422e0d44-788d-4a30-90b4-20185cece2b4">

<br/>

```java
@Configuration
@EnableTransactionManagement
@ComponentScan(basePackages = "com.company.project.user")
public class TestApplicationContext {
```
ğŸ”¼ @ComponentScan ì ìš©
- íŠ¹ì • íŒ¨í‚¤ì§€ ì•„ë˜ì„œë§Œ ì°¾ë„ë¡ ê¸°ì¤€ì´ ë˜ëŠ” íŒ¨í‚¤ì§€ë¥¼ ì§€ì •í•´ì¤„ í•„ìš”ê°€ ìˆë‹¤.
- DI ì„¤ì •ìš© í´ë˜ìŠ¤ì¸ TestApplicationContextì— @ComponentScanì„ ì¶”ê°€í•œë‹¤.

<br/>

```java
@Repository
public class UserDaoJdbc implements UserDao {
```
- ìŠ¤í”„ë§ì´ ê¶Œì¥í•˜ëŠ” @Repository ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì¤€ë‹¤.
  - @RepositoryëŠ” @Componentë¥¼ ë©”íƒ€ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ê°–ê³  ìˆë‹¤.
 
<br/>

```java
@Component
public class UserServiceImpl implements UserService {
	...

	@Autowired
	private UserDao userDao;
	
	@Autowired
	private MailSender mailSender;
```
ğŸ”¼ ìë™ë“±ë¡ê³¼ ìë™ì™€ì´ì–´ë§ ë°©ì‹ì„ ì ìš©í•œ UserServiceImpl
- userService ë¹ˆì—ë„ ìë™ì™€ì´ì–´ë§ê³¼ ìë™ ë¹ˆ ë“±ë¡ì„ ì ìš©í–ˆë‹¤.
- í…ŒìŠ¤íŠ¸ë¥¼ ëŒë ¤ë³´ë©´ UserService íƒ€ì…ì˜ ë¹ˆì´ í•˜ë‚˜ì—¬ì•¼ í•˜ëŠ”ë° ë‘ ê°œê°€ ë°œê²¬ëë‹¤ëŠ” ë‚´ìš©ìœ¼ë¡œ ì‹¤íŒ¨í•œë‹¤.

<br/>

```java
@Service("userService")
public class UserServiceImpl implements UserService {
```
ğŸ”¼ @Service ì–´ë…¸í…Œì´ì…˜ì˜ ì ìš©
- ì„œë¹„ìŠ¤ ê³„ì¸µì˜ ë¹ˆì„ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” @Service ë¹ˆ ìë™ë“±ë¡ìš© ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•œë‹¤.
- ë¹ˆ ì•„ì´ë””ë¥¼ userServiceë¼ê³  ì§€ì •í•´ì„œ ì—ëŸ¬ë¥¼ í•´ê²°í•œë‹¤.

<br/>

## 7.6.3 ì»¨í…ìŠ¤íŠ¸ ë¶„ë¦¬ì™€ @Import
ì„±ê²©ì´ ë‹¤ë¥¸ DI ì •ë³´ë¥¼ ë¶„ë¦¬í•œë‹¤.

<br/>

### í…ŒìŠ¤íŠ¸ìš© ì»¨í…ìŠ¤íŠ¸ ë¶„ë¦¬

```java
@Configuration
public class TestAppContext {

	@Bean
	public UserService testUserService() {
		return new TestUserService();
	}

	@Bean
	public MailSender mailSender() {
		return new DummyMailSender();
	}
}
```
ğŸ”¼ ìë™ì™€ì´ì–´ë§ì„ í™œìš©í•˜ë„ë¡ ê°„ëµí•˜ê²Œ ë°”ê¾¼ í…ŒìŠ¤íŠ¸ DI ì •ë³´
- í…ŒìŠ¤íŠ¸ìš© ë¹ˆê³¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹ˆì˜ ì„¤ì •ì •ë³´ë¥¼ í´ë˜ìŠ¤ë¥¼ ë¶„ë¦¬í•´ì„œ ë”°ë¡œ ë§Œë“¤ì—ˆë‹¤ë©´ ìŠ¤ìº” ëŒ€ìƒì˜ ìœ„ì¹˜ë„ ë¶„ë¦¬ë  í•„ìš”ê°€ ìˆë‹¤.
- í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ íŠ¹ë³„íˆ ë§Œë“  ë¹ˆì€ ì„¤ì •ì •ë³´ì— ë‚´ìš©ì´ ë“œëŸ¬ë‚˜ ìˆëŠ” í¸ì´ ì¢‹ë‹¤.

<br/>

```java
@ExtendWith(SpringExtension.class)
@ContextConfiguration(classes = {TestAppContext.class, AppContext.class})
public class UserDaoTest {
```
ğŸ”¼ í…ŒìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ì˜ DI ì„¤ì • í´ë˜ìŠ¤ ì •ë³´ ìˆ˜ì •
- UserDaoTestì™€ UserServiceTestê°€ 2ê°œì˜ DI í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½í•œë‹¤.

<br/>

### @Import

```java
@Configuration
public class SqlServiceContext {

	@Bean
	public SqlService sqlService() {
		OxmSqlService sqlService = new OxmSqlService();
		sqlService.setUnmarshaller(unmarshaller());
		sqlService.setSqlRegistry(sqlRegistry());
		return sqlService;
	}

	@Bean
	public SqlRegistry sqlRegistry() {
		EmbeddedDbSqlRegistry sqlRegistry = new EmbeddedDbSqlRegistry();
		sqlRegistry.setDataSource(embeddedDatabase());
		return sqlRegistry;
	}

	@Bean
	public Unmarshaller unmarshaller() {
		Jaxb2Marshaller marshaller = new Jaxb2Marshaller();
		marshaller.setContextPath("com.company.project.sql.service.jaxb");
		return marshaller;
	}

	@Bean
	public DataSource embeddedDatabase() {
		return new EmbeddedDatabaseBuilder()
				.setName("embeddedDatabase")
				.setType(EmbeddedDatabaseType.HSQL)
				.addScript("classpath:sql/sqlRegistrySchema.sql")
				.build();
	}
}
```
ğŸ”¼ SQL ì„œë¹„ìŠ¤ ë¹ˆ ì„¤ì •ì„ ìœ„í•œ SqlServiceContext í´ë˜ìŠ¤

<br/>

```java
@Configuration
@EnableTransactionManagement
@ComponentScan(basePackages = "com.company.project.user")
@Import(SqlServiceContext.class)
public class AppContext {
```
ğŸ”¼ @Import ì ìš©
- íŒŒì¼ì„ êµ¬ë¶„í–ˆë”ë¼ë„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • ì •ë³´ì˜ ì¤‘ì‹¬ì´ ë˜ëŠ” AppContextì™€ ê¸´ë°€í•˜ê²Œ ì—°ê²°í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.
- @Importë¥¼ ì¶”ê°€í•´ì„œ SqlServiceContextë¥¼ ê°€ì ¸ì˜¤ê²Œ ë§Œë“ ë‹¤.

<br/>

## 7.6.4 í”„ë¡œíŒŒì¼

<img width="578" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/98edb4c5-0059-406a-8497-6e695c80707f">

ğŸ”¼ ìš´ì˜ìš© ë©”ì¼ ì„œë²„ë¥¼ ì§€ì›í•˜ëŠ” MailSender ë¹ˆ

<br/>

```java
@Configuration
public class ProductionAppContext {

	@Bean
	public MailSender mailSender() {
		JavaMailSenderImpl mailSender = new JavaMailSenderImpl();
		mailSender.setHost("mail.mycompany.com");
		return mailSender;
	}
}
```
ğŸ”¼ ìš´ì˜í™˜ê²½ì—ì„œë§Œ í•„ìš”í•œ ë¹ˆì„ ë‹´ì€ ë¹ˆ ì„¤ì • í´ë˜ìŠ¤
- mailSender ë¹ˆ ì„¤ì •ì„ ProductionAppContextë¼ëŠ” ì´ë¦„ì˜ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì˜®ê¸´ë‹¤.
- ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¡°ê°€ ì»¤ì§€ê³ , ëª¨ë“ˆì´ ë§ì•„ì§€ê³ , ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ë™ì‘í•˜ëŠ” í™˜ê²½ë„ ë‹¨ìˆœíˆ í…ŒìŠ¤íŠ¸ì™€ ìš´ì˜ 2ê°€ì§€ ì´ìƒì´ ë  ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— ì´ëŸ° ì‹ì˜ íŒŒì¼ ì¡°í•©ì„ ì´ìš©í•œ DI ì„¤ì •ì€ ë¶ˆí¸í•œë‹¤.

<br/>

### @Profileê³¼ @ActiveProfiles
- ìŠ¤í”„ë§ 3.1ì€ í™˜ê²½ì— ë”°ë¼ì„œ ë¹ˆ ì„¤ì •ì •ë³´ê°€ ë‹¬ë¼ì ¸ì•¼ í•˜ëŠ” ê²½ìš°ì— íŒŒì¼ì„ ì—¬ëŸ¬ ê°œë¡œ ìª¼ê°œê³  ì¡°í•©í•˜ëŠ” ë“±ì˜ ë²ˆê±°ë¡œìš´ ë°©ë²• ëŒ€ì‹  ê°„ë‹¨íˆ ì„¤ì •ì •ë³´ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•œë‹¤.
- ì‹¤í–‰í™˜ê²½ì— ë”°ë¼ ë¹ˆ êµ¬ì„±ì´ ë‹¬ë¼ì§€ëŠ” ë‚´ìš©ì„ í”„ë¡œíŒŒì¼ë¡œ ì •ì˜í•´ì„œ ë§Œë“¤ì–´ë‘ê³ , ì‹¤í–‰ ì‹œì ì— ì–´ë–¤ í”„ë¡œíŒŒì¼ì˜ ë¹ˆ ì„¤ì •ì„ ì‚¬ìš©í• ì§€ ì§€ì •í•œë‹¤.
- í”„ë¡œíŒŒì¼ì„ ì ìš©í•˜ë©´ í•˜ë‚˜ì˜ ì„¤ì • í´ë˜ìŠ¤ë§Œ ê°€ì§€ê³  í™˜ê²½ì— ë”°ë¼ ë‹¤ë¥¸ ë¹ˆ ì„¤ì • ì¡°í•©ì„ ë§Œë“¤ì–´ë‚¼ ìˆ˜ ìˆë‹¤.
- í”„ë¡œíŒŒì¼ì€ ì„¤ì • í´ë˜ìŠ¤ ë‹¨ìœ„ë¡œ ì§€ì •í•œë‹¤.

<br/>

```java
@Configuration
@Profile("test")
public class TestAppContext {
```
ğŸ”¼ @Profileì„ ì§€ì •í•œ TestAppContext
- ì–´ë…¸í…Œì´ì…˜ì„ í´ë˜ìŠ¤ ë ˆë²¨ì— ë¶€ì—¬í•˜ê³  í”„ë¡œíŒŒì¼ ì´ë¦„ì„ ë„£ì–´ì¤€ë‹¤.

<br/>

```java
@Configuration
@EnableTransactionManagement
@ComponentScan(basePackages = "com.company.project.user")
@Import({SqlServiceContext.class, TestAppContext.class, ProductionAppContext.class})
public class AppContext {
```
ğŸ”¼ @Importì— ëª¨ë“  ì„¤ì • í´ë˜ìŠ¤ ì¶”ê°€
- í”„ë¡œíŒŒì¼ì„ ì ìš©í•˜ë©´ ëª¨ë“  ì„¤ì • í´ë˜ìŠ¤ë¥¼ ë¶€ë‹´ ì—†ì´ ë©”ì¸ ì„¤ì • í´ë˜ìŠ¤ì—ì„œ @Importí•´ë„ ëœë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.

<br/>

```java
@ContextConfiguration(classes=AppContext.class)
```
- UserDaoTestì™€ UserServiceTestì˜ @ContextConfigurationì„ AppContext í•˜ë‚˜ë§Œ ë‚¨ê¸°ë„ë¡ ìˆ˜ì •í•œë‹¤.

<br/>

```java
@ExtendWith(SpringExtension.class)
@ActiveProfiles("test")
@ContextConfiguration(classes=AppContext.class)
public class UserServiceTest {
```
ğŸ”¼ í™œì„± í”„ë¡œíŒŒì¼ì„ ì§€ì •í•œ UserServiceTest
- test í”„ë¡œíŒŒì¼ì„ í™œì„± í”„ë¡œíŒŒì¼ë¡œ ì‚¬ìš©í•˜ê²Œ í•´ì¤€ë‹¤.
- test í”„ë¡œíŒŒì¼ì¼ ì§€ì •ëœ TestAppContextì˜ ë¹ˆ ì„¤ì •ì€ í¬í•¨ë˜ê³ , ProductionAppContextì˜ ë¹ˆ ì„¤ì •ì€ production í”„ë¡œíŒŒì¼ì´ ì„ ì–¸ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë¬´ì‹œëœë‹¤.

<br/>

### ì»¨í…Œì´ë„ˆì˜ ë¹ˆ ë“±ë¡ ì •ë³´ í™•ì¸
ê°„ë‹¨íˆ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡ëœ ë¹ˆ ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë³¸ë‹¤.

<br/>

<img width="500" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/51c0c0b1-d687-4a21-88a4-76a09cb51029">

ğŸ”¼ ë“±ë¡ëœ ë¹ˆ ë‚´ì—­ì„ ì¡°íšŒí•˜ëŠ” í…ŒìŠ¤íŠ¸ ë©”ì„œë“œ
- ë“±ë¡ëœ ë¹ˆ ì´ë¦„ê³¼ ë¹ˆ ì˜¤ë¸Œì íŠ¸ì˜ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ì¶œë ¥í•´ì£¼ëŠ” ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ë©”ì„œë“œì´ë‹¤.
- ì¶œë ¥ ë‚´ìš©ì€ mailSender í•˜ë‚˜ë§Œ ë“±ë¡ë˜ê³ , êµ¬í˜„ í´ë˜ìŠ¤ëŠ” DummyMailSenderê°€ ì‚¬ìš©ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.
  - TestAppContextì— ìˆëŠ” mailSender ë¹ˆ ì„¤ì •
  - test í”„ë¡œíŒŒì¼ì´ ì ìš©ëœ ê²ƒì´ë‹¤.
 
<br/>

### ì¤‘ì²© í´ë˜ìŠ¤ë¥¼ ì´ìš©í•œ í”„ë¡œíŒŒì¼ ì ìš©
- í”„ë¡œíŒŒì¼ì— ë”°ë¼ ë¶„ë¦¬í–ˆë˜ ì„¤ì •ì •ë³´ë¥¼ í•˜ë‚˜ì˜ íŒŒì¼ë¡œ ëª¨ì•„ë³¸ë‹¤.
- í”„ë¡œíŒŒì¼ì´ ì§€ì •ëœ ë…ë¦½ëœ ì„¤ì • í´ë˜ìŠ¤ì˜ êµ¬ì¡°ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€í•œ ì±„ë¡œ ë‹¨ì§€ ì†ŒìŠ¤ì½”ë“œì˜ ìœ„ì¹˜ë§Œ í†µí•©í•œë‹¤.
- ìŠ¤íƒœí‹± ì¤‘ì²© í´ë˜ìŠ¤ë¥¼ ì´ìš©í•œë‹¤.

<br/>

```java
@Configuration
@EnableTransactionManagement
@ComponentScan(basePackages = "com.company.project.user")
@Import({SqlServiceContext.class, AppContext.TestAppContext.class, AppContext.ProductionAppContext.class})
public class AppContext {
	...
	
	@Configuration
	@Profile("production")
	public static class ProductionAppContext {
		
		@Bean
		public MailSender mailSender() {
			JavaMailSenderImpl mailSender = new JavaMailSenderImpl();
			mailSender.setHost("mail.mycompany.com");
			return mailSender;
		}
	}

	@Configuration
	@Profile("test")
	public static class TestAppContext {

		@Bean
		public UserService testUserService() {
			return new UserServiceImpl.TestUserService();
		}

		@Bean
		public MailSender mailSender() {
			return new DummyMailSender();
		}
	}
}
```
ğŸ”¼ TestAppContextì™€ ProductionAppContextë¥¼ ì¤‘ì²© í´ë˜ìŠ¤ë¡œ ë§Œë“  AppContext
- ê°ê° ë…ë¦½ì ìœ¼ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆê²Œ ìŠ¤íƒœí‹± í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ì£¼ê³ , ê¸°ì¡´ì˜ í´ë˜ìŠ¤ íŒŒì¼ì€ ì‚­ì œí•œë‹¤.

<br/>

```java
@Import(SqlServiceContext.class)
```
- @Importì— ì§€ì •í–ˆë˜ 2ê°œì˜ í”„ë¡œíŒŒì¼ ì„¤ì • í´ë˜ìŠ¤ë¥¼ ì•„ì˜ˆ ì œê±°í•´ë„ ëœë‹¤.

<br/>

```java
@Configuration
@EnableTransactionManagement
@ComponentScan(basePackages = "com.company.project.user")
@Import(SqlServiceContext.class)
public class AppContext {

	@Bean
	public DataSource dataSource() {
		SimpleDriverDataSource dataSource = new SimpleDriverDataSource();

		dataSource.setDriverClass(Driver.class);
		dataSource.setUrl("jdbc:mysql://localhost/springbook?characterEncoding=UTF-8");
		dataSource.setUsername("spring");
		dataSource.setPassword("book");

		return dataSource;
	}

	@Bean
	public PlatformTransactionManager transactionManager() {
		DataSourceTransactionManager tm = new DataSourceTransactionManager();
		tm.setDataSource(dataSource());
		return tm;
	}

	@Configuration
	@Profile("production")
	public static class ProductionAppContext {

		@Bean
		public MailSender mailSender() {
			JavaMailSenderImpl mailSender = new JavaMailSenderImpl();
			mailSender.setHost("mail.mycompany.com");
			return mailSender;
		}
	}

	@Configuration
	@Profile("test")
	public static class TestAppContext {

		@Bean
		public UserService testUserService() {
			return new UserServiceImpl.TestUserService();
		}

		@Bean
		public MailSender mailSender() {
			return new DummyMailSender();
		}
	}
}
```
ğŸ”¼ í”„ë¡œíŒŒì¼ì„ ì ìš©í•œ AppContext ì„¤ì • í´ë˜ìŠ¤
- í”„ë¡œíŒŒì¼ì„ ì ìš©í•˜ê³  ì¤‘ì²© í´ë˜ìŠ¤ë¡œ ëª¨ìœ¼ëŠ” ì‘ì—…ê¹Œì§€ ë§ˆë¬´ë¦¬í•œ AppContextì˜ ì½”ë“œì´ë‹¤.

<br/>

## 7.6.5 í”„ë¡œí¼í‹° ì†ŒìŠ¤
ë‹¤ìŒ ì£¼ì°¨

## 3.5 ν…ν”λ¦Ώκ³Ό μ½λ°±
μ§€κΈκΉμ§€ λ§λ“  μ½”λ“λ” μΌμΆ…μ μ „λµ ν¨ν„΄μ΄ μ μ©λ κ²ƒμ΄λ‹¤. <br/>
λ³µμ΅ν•μ§€λ§ λ°”λ€μ§€ μ•λ” μΌμ •ν• ν¨ν„΄μ„ κ°–λ” μ‘μ—… νλ¦„μ΄ μ΅΄μ¬ν•κ³  κ·Έμ¤‘ μΌλ¶€λ¶„λ§ μμ£Ό λ°”κΏ”μ„ μ‚¬μ©ν•΄μ•Ό ν•λ” κ²½μ°μ— μ ν•©ν• κµ¬μ΅°μ΄λ‹¤. <br/>
μ „λµ ν¨ν„΄μ κΈ°λ³Έ κµ¬μ΅°μ— μµλ… λ‚΄λ¶€ ν΄λμ¤λ¥Ό ν™μ©ν• λ°©μ‹μ΄λ‹¤. μ΄λ° λ°©μ‹μ„ μ¤ν”„λ§μ—μ„ **ν…ν”λ¦Ώ/μ½λ°± ν¨ν„΄**μ΄λΌκ³  λ¶€λ¥Έλ‹¤. <br/>
μ „λµ ν¨ν„΄μ μ»¨ν…μ¤νΈλ¥Ό **ν…ν”λ¦Ώ**, μµλ… λ‚΄λ¶€ ν΄λμ¤λ΅ λ§λ“¤μ–΄μ§€λ” μ¤λΈμ νΈλ¥Ό **μ½λ°±**μ΄λΌκ³  λ¶€λ¥Έλ‹¤.

<br/>

### 3.5.1 ν…ν”λ¦Ώ/μ½λ°±μ λ™μ‘μ›λ¦¬
**ν…ν”λ¦Ώ**μ€ κ³ μ •λ μ‘μ—… νλ¦„μ„ κ°€μ§„ μ½”λ“λ¥Ό μ¬μ‚¬μ©ν•λ‹¤λ” μλ―Έμ—μ„ λ¶™μΈ μ΄λ¦„μ΄κ³ , <br/>
**μ½λ°±**μ€ ν…ν”λ¦Ώ μ•μ—μ„ νΈμ¶λλ” κ²ƒμ„ λ©μ μΌλ΅ λ§λ“¤μ–΄μ§„ μ¤λΈμ νΈλ¥Ό λ§ν•λ‹¤.

<br/>

> ***ν…ν”λ¦Ώ/μ½λ°±μ νΉμ§•***

- λ³΄ν†µ **λ‹¨μΌ λ©”μ†λ“ μΈν„°νμ΄μ¤**λ¥Ό μ‚¬μ©ν•λ‹¤. (νΉμ • κΈ°λ¥μ„ μ„ν•΄ ν• λ² νΈμ¶λλ” κ²½μ°κ°€ μΌλ°μ μ΄κΈ° λ•λ¬Έ)
- μ½λ°±μ€ μΌλ°μ μΌλ΅ ν•λ‚μ λ©”μ†λ“λ¥Ό κ°€μ§„ μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν• μµλ… λ‚΄λ¶€ ν΄λμ¤λ΅ λ§λ“¤μ–΄μ§„λ‹¤κ³  λ³΄λ©΄ λλ‹¤.
- μ½λ°± μΈν„°νμ΄μ¤μ λ©”μ†λ“μ—λ” λ³΄ν†µ **νλΌλ―Έν„°**κ°€ μλ”λ°, ν…ν”λ¦Ώμ μ‘μ—… νλ¦„ μ¤‘ λ§λ“¤μ–΄μ§€λ” **μ»¨ν…μ¤νΈ μ •λ³΄λ¥Ό μ „λ‹¬λ°›μ„ λ•** μ‚¬μ©λλ‹¤.

<br/>

![image](https://github.com/Team-Sopetit/server-spring-study/assets/55437339/d2cc1306-559f-4ec5-9e23-0ae409ab1abf)

- μ„ κ·Έλ¦Όμ€ ν…ν”λ¦Ώ/μ½λ°± ν¨ν„΄μ μΌλ°μ μΈ μ‘μ—… νλ¦„μ΄λ‹¤.
- ν΄λΌμ΄μ–ΈνΈμ μ—­ν• μ€ ν…ν”λ¦Ώ μ•μ—μ„ μ‹¤ν–‰λ  λ΅μ§μ„ λ‹΄μ€ μ½λ°± μ¤λΈμ νΈλ¥Ό λ§λ“¤κ³ , μ½λ°±μ— μ°Έμ΅°ν•  μ •λ³΄λ¥Ό μ κ³µν•λ” κ²ƒμ΄λ‹¤. λ§λ“¤μ–΄μ§„ μ½λ°±μ€ ν΄λΌμ΄μ–ΈνΈκ°€ ν…ν”λ¦Ώμ λ©”μ†λ“λ¥Ό νΈμ¶ν•  λ• νλΌλ―Έν„°λ΅ μ „λ‹¬λλ‹¤.
- ν…ν”λ¦Ώμ€ μ •ν•΄μ§„ μ‘μ—… νλ¦„μ„ λ”°λΌ μ‘μ—…μ„ μ§„ν–‰ν•λ‹¤κ°€ λ‚΄λ¶€μ—μ„ μƒμ„±ν• μ°Έμ΅°μ •λ³΄λ¥Ό κ°€μ§€κ³  μ½λ°± μ¤λΈμ νΈμ λ©”μ†λ“λ¥Ό νΈμ¶ν•λ‹¤. μ½λ°±μ€ ν΄λΌμ΄μ–ΈνΈ λ©”μ†λ“μ— μλ” μ •λ³΄μ™€ ν…ν”λ¦Ώμ΄ μ κ³µν• μ°Έμ΅°μ •λ³΄λ¥Ό μ΄μ©ν•΄μ„ μ‘μ—…μ„ μν–‰ν•κ³  κ·Έ κ²°κ³Όλ¥Ό λ‹¤μ‹ ν…ν”λ¦Ώμ—κ² λλ ¤μ¤€λ‹¤.
- ν…ν”λ¦Ώμ€ μ½λ°±μ΄ λλ ¤μ¤€ μ •λ³΄λ¥Ό μ‚¬μ©ν•΄μ„ μ‘μ—…μ„ λ§μ € μν–‰ν•λ‹¤. κ²½μ°μ— λ”°λΌ μµμΆ… κ²°κ³Όλ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² λ‹¤μ‹ λλ ¤μ£ΌκΈ°λ„ ν•λ‹¤.
- ν…ν”λ¦Ώ/μ½λ°± λ°©μ‹μ€ μ „λµ ν¨ν„΄κ³Ό DIμ μ¥μ μ„ μµλ… λ‚΄λ¶€ ν΄λμ¤ μ‚¬μ© μ „λµκ³Ό κ²°ν•©ν• λ…νΉν• ν™μ©λ²•μΌλ΅ μ΄μ• ν•  μ μλ‹¤.
- λ‹¤λ§ μ΄ ν¨ν„΄μ— λ…Ήμ•„ μλ” μ „λµ ν¨ν„΄κ³Ό μλ™ DIλ¥Ό μ΄ν•΄ν•  μ μμ–΄μ•Ό ν•λ‹¤.

<br/>

> ***JdbcContextμ— μ μ©λ ν…ν”λ¦Ώ/μ½λ°±***

![image](https://github.com/Team-Sopetit/server-spring-study/assets/55437339/39c34452-eccc-41e9-af83-30e5b4fc2dbb)

- μ„ κ·Έλ¦Όμ€ UserDao, JdbcContextλ¥Ό ν…ν”λ¦Ώ/μ½λ°± ν¨ν„΄μ κµ¬μ΅°μ—μ„ μ‚΄ν΄λ³Έ κ²ƒμ΄λ‹¤.
- ν…ν”λ¦Ώκ³Ό ν΄λΌμ΄μ–ΈνΈκ°€ λ©”μ†λ“ λ‹¨μ„μΈ κ²ƒμ΄ νΉμ§•μ΄λ‹¤.
- JdbcContextμ workWithStatementStrategy() ν…ν”λ¦Ώμ€ λ¦¬ν„΄ κ°’μ΄ μ—†λ” λ‹¨μν• κµ¬μ΅°λ‹¤. μ΅°ν μ‘μ—…μ—μ„λ” λ³΄ν†µ ν…ν”λ¦Ώμ μ‘μ—… κ²°κ³Όλ¥Ό ν΄λΌμ΄μ–ΈνΈμ— λ¦¬ν„΄ν•΄μ¤€λ‹¤.
- ν…ν”λ¦Ώμ μ‘μ—… νλ¦„μ΄ μΆ€ λ” λ³µμ΅ν• κ²½μ°μ—λ” ν• λ² μ΄μƒ μ½λ°±μ„ νΈμ¶ν•κΈ°λ„ ν•κ³  μ—¬λ¬ κ°μ μ½λ°±μ„ ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° λ°›μ•„ μ‚¬μ©ν•κΈ°λ„ ν•λ‹¤.

<br/>

### 3.5.2 νΈλ¦¬ν• μ½λ°±μ μ¬ν™μ©
ν…ν”λ¦Ώ/λ΅¤λ°± λ°©μ‹μ€ ν΄λΌμ΄μ–ΈνΈμΈ DAOμ λ©”μ†λ“λ” κ°„κ²°ν•΄μ§€κ³  μµμ†ν•μ λ°μ΄ν„° μ•΅μ„Έμ¤ λ΅μ§λ§ κ°–κ³  μκ² λλ‹¤. <br/>
ν•μ§€λ§ DAO λ©”μ†λ“μ—μ„ λ§¤λ² μµλ… λ‚΄λ¶€ ν΄λμ¤λ¥Ό μ‚¬μ©ν•κΈ° λ•λ¬Έμ— μƒλ€μ μΌλ΅ μ½”λ“λ¥Ό μ‘μ„±ν•κ³  μ½κΈ°κ°€ μ΅°κΈ λ¶νΈν•λ‹¤λ” κ²ƒμ΄ μ•„μ‰½λ‹¤.

<br/>

> ***μ½λ°±μ λ¶„λ¦¬μ™€ μ¬ν™μ©***

π”½ μµλ… λ‚΄λ¶€ ν΄λμ¤λ¥Ό μ‚¬μ©ν• ν΄λΌμ΄μ–ΈνΈ μ½”λ“
```java
public void deleteAll() throws SQLException {
  this.jdbcContext.workWithStatementStrategy(
    // λ³€ν•μ§€ μ•λ” μ½λ°± ν΄λμ¤ μ •μμ™€ μ¤λΈμ νΈ μƒμ„±
    new StatementStrategy() {
      public PreparedStatement makePreapredStatement(Connection c) throw SQLException {
        return c.preparedStatement("delete from users"); // λ³€ν•λ” SQL λ¬Έμ¥
      }
    }
  );
}
```
- μ½λ°± μ¤λΈμ νΈ μ½”λ“λ¥Ό μ‚΄ν΄λ³΄λ©΄, κ³ μ •λ SQL μΏΌλ¦¬ ν•λ‚λ¥Ό λ‹΄μ•„μ„ PreparedStatementλ¥Ό λ§λ“λ” κ²ƒμ΄ μ „λ¶€λ‹¤.
- deleteAll()κ³Ό μ μ‚¬ν• λ‚΄μ©μ μ½λ°± μ¤λΈμ νΈκ°€ λ°λ³µλ  κ°€λ¥μ„±μ΄ λ†’λ‹¤.

<br/>

π”½ λ³€ν•μ§€ μ•λ” λ¶€λ¶„μ„ λ¶„λ¦¬μ‹ν‚¨ deleteAll() λ©”μ†λ“
```java
public void deleteAll() throws SQLException {
  executeSql("delete from users"); // λ³€ν•λ” SQL λ¬Έμ¥
}
/** ** ** λ¶„λ¦¬ ** ** **/
private void executeSql(final String query) throws SQLException {
  this.jdbcContext.workWithStatementStrategy(
    // λ³€ν•μ§€ μ•λ” μ½λ°± ν΄λμ¤ μ •μμ™€ μ¤λΈμ νΈ μƒμ„±
    new StatementStrategy() {
      public PreapredStatement makePreparedStatement(Connection c) throws SQLException {
        return c.prepareStatement(query);
      }
    }
  );
}
```
- μ¤‘λ³µλ  κ°€λ¥μ„±μ΄ μλ” μμ£Ό λ°”λ€μ§€ μ•λ” λ¶€λ¶„μ„ λ¶„λ¦¬ν•λ‹¤.
- λ‹¨μ SQLμ„ ν•„μ”λ΅ ν•λ” μ½λ°±μ΄λΌλ©΄ λ‚λ¨Έμ§€ μ½”λ“λ” λ§¤λ² λ™μΌν•  κ²ƒμ΄λ―€λ΅ SQL λ¬Έμ¥κ³Ό λ©”μ†λ“ λ‚΄μ©μ„ λ¶„λ¦¬ν•λ‹¤.
- λ°”λ€μ§€ μ•λ” λ¨λ“  λ¶€λ¶„μ€ executeSql() λ©”μ†λ“λ΅ λΉΌλ‚΄κ³ , λ°”λ€λ” λ¶€λ¶„μΈ SQL λ¬Έμ¥λ§ νλΌλ―Έν„°λ΅ λ°›μ•„μ„ μ‚¬μ©ν•λ„λ΅ λ§λ“¤μ—λ‹¤.
- νλΌλ―Έν„°λ” finalλ΅ μ„ μ–Έν•΄μ„ μ½λ°±(μµλ… λ‚΄λ¶€ ν΄λμ¤) μ•μ—μ„ μ§μ ‘ μ‚¬μ©ν•  μ μκ² ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤.

<br/>

> ***μ½λ°±κ³Ό ν…ν”λ¦Ώμ κ²°ν•©***

π”½ JdbcContextλ΅ μ®κΈ΄ executeSql() λ©”μ†λ“
```java
public class JdbcContext {
  ...
  public void executeSql(final String query) throws SQLException {
    workWithStatementStrategy(
      new StatementStrategy() {
        public PreapredStatement makePreparedStatement(Connection c) throws SQLException {
          return c.prepareStatement(query);
        }
      }
    );
  }
  ...
}
```
- μ¬μ‚¬μ© κ°€λ¥ν• μ½λ°±μ„ λ‹΄κ³  μλ” λ©”μ†λ“λΌλ©΄ (UserDao μ™Έμ—λ„) DAOκ°€ κ³µμ ν•  μ μλ” ν…ν”λ¦Ώ ν΄λμ¤ μ•μΌλ΅ μ®κ²¨λ„ λλ‹¤.
- ν…ν”λ¦Ώμ€ workWithStatementStrategy() λ©”μ†λ“μ΄λ―€λ΅ executeSql() λ©”μ†λ“λ¥Ό JdbcContextλ΅ μ®κ²¨λ„ λ¬Έμ  μ—†λ‹¤.
- λ©”μ†λ“ μ ‘κ·Όμλ” publicμΌλ΅ λ°”κΏ” μ™Έλ¶€μ—μ„ μ ‘κ·Ό κ°€λ¥ν•λ„λ΅ ν•λ‹¤.

<br/>

π”½ JdbcContextλ΅ μ®κΈ΄ executeSql()μ„ μ‚¬μ©ν•λ” deleteAll() λ©”μ†λ“
```java
public void deleteAll() throws SQLException {
  this.jdbcContext.executeSql("delete from users");
}
```
- UserDaoμ λ©”μ†λ“μ—μ„λ„ jdbcContextλ¥Ό ν†µν•΄ executeSql() λ©”μ†λ“λ¥΄ νΈμ¶ν•λ„λ΅ μμ •ν•λ‹¤.

<br/>

![image](https://github.com/Team-Sopetit/server-spring-study/assets/55437339/84f1c3ca-5a72-4637-a012-93853487798c)

- κ²°κµ­ JdbcContext μ•μ— ν΄λΌμ΄μ–ΈνΈμ™€ ν…ν”λ¦Ώ, μ½λ°±μ΄ λ¨λ‘ ν•¨κ» κ³µμ΅΄ν•λ©΄μ„ λ™μ‘ν•λ” κµ¬μ΅°κ°€ λλ‹¤.
- ν•λ‚μ λ©μ μ„ μ„ν•΄ μ„λ΅ κΈ΄λ°€ν•κ² μ—°κ΄€λμ–΄ λ™μ‘ν•λ” **μ‘μ§‘λ ¥μ΄ κ°•ν• μ½”λ“**λ“¤μ΄κΈ° λ•λ¬Έμ— ν• κµ°λ° λ¨μ—¬ μλ” κ² μ λ¦¬ν•λ‹¤.
- κµ¬μ²΄μ μΈ κµ¬ν„κ³Ό λ‚΄λ¶€μ κΈ°μ μ€ μµλ€ν• κ°μ¶°λ‘κ³ , μ™Έλ¶€μ—λ” κΌ­ ν•„μ”ν• κΈ°λ¥μ„ μ κ³µν•λ” λ‹¨μν• λ©”μ†λ“λ§ λ…Έμ¶ν•΄μ£Όλ” κ²ƒμ΄λ‹¤.

<br/>

### 3.5.3 ν…ν”λ¦Ώ/μ½λ°±μ μ‘μ©
> ***ν…μ¤νΈμ™€ try/catch/finally***

- κ°„λ‹¨ν• ν…ν”λ¦Ώ/μ½λ°± μμ λ¥Ό λ§λ“¤μ–΄λ³Έλ‹¤.
- νμΌμ„ ν•λ‚ μ—΄μ–΄μ„ λ¨λ“  λΌμΈμ μ«μλ¥Ό λ”ν• ν•©μ„ λλ ¤μ£Όλ” μ½”λ“λ¥Ό λ§λ“ λ‹¤.

<br/>

π”½ numbers.txt
```text
1
2
3
4
```

π”½ νμΌμ μ«μ ν•©μ„ κ³„μ‚°ν•λ” μ½”λ“μ ν…μ¤νΈ
```java
package springbook.learningtest.template;
...
public class CalcSumTest {
  @Test
  public void sumOfNumbers() throws IOException {
    Calculator calculator = new Calculator();
    int sum = calculator.calcSum(getClass().getResource("numbers.txt").getPath());
    assertThat(sum, is(10));
  }
}
```
- ν΄λμ¤ μ΄λ¦„μ€ Calculator, λ©”μ†λ“λ” μ¤νΈλ§μΌλ΅ λ νμΌ κ²½λ΅λ¥Ό νλΌλ―Έν„°λ΅ λ°›λ” calcSum()μΌλ΅ μ •ν–λ‹¤.
- ν•„μ”ν• κΈ°λ¥μ„ ν…μ¤νΈ μ½”λ“λ΅ λ¨Όμ € λ§λ“¤μ–΄ λ³Έ κ²ƒμ΄κ³ , μ΄μ  ν•λ‚μ”© μ½”λ“λ΅ λ§λ“¤μ–΄λ³΄λ©΄ λλ‹¤. (μ΄κ²ƒμ΄ TDD?!)

<br/>

π”½ μ²μ λ§λ“  Calculator ν΄λμ¤ μ½”λ“
```java
package springbook.learningtest.template;
...
public class Calculator {
  public Integer calcSum(String filepath) throws IOException {
    BufferedReader br = new BufferedReader(new FileReader(filepath)); // ν• μ¤„μ”© μ½κΈ° νΈν•κ² BufferedReaderλ΅ νμΌμ„ κ°€μ Έμ¨λ‹¤.
    Integer num = 0;
    String line = null;
    while((line = br.readLine()) != null ) { // λ§μ§€λ§‰ λΌμΈκΉμ§€ ν• μ¤„μ”© μ½μ–΄κ°€λ©΄μ„ μ«μλ¥Ό λ”ν•λ‹¤.
      sum += Integer.valueOf(line);
    }

    br.close(); // ν• λ² μ—° νμΌμ€ λ°λ“μ‹ λ‹«μ•„μ¤€λ‹¤.
    return sum;
  }
}
```
- νμΌμ„ μ—΄μ–΄μ„ κ° λΌμΈμ„ μμ°¨μ μΌλ΅ μ½λ” μ½”λ“λ§ κ°„λ‹¨ν κµ¬ν„ν–λ‹¤.
- (μ΄λ‚κ° DAOμ™€ λ§μ°¬κ°€μ§€λ΅) νμΌμ„ μ½κ±°λ‚ μ²λ¦¬ν•λ‹¤κ°€ μμ™Έκ°€ λ°μƒν•λ‹¤λ©΄, νμΌμ΄ μ •μƒμ μΌλ΅ λ‹«νμ§€ μ•κ³  λ©”μ†λ“λ¥Ό λΉ μ Έλ‚κ°€λ” λ¬Έμ κ°€ λ°μƒν•  μ μλ‹¤.

<br/>

π”½ try/catch/finallyλ¥Ό μ μ©ν• calcSum() λ©”μ†λ“
```java
public Integer calcSum(String filepath) throws IOException {
  BufferedReader br = null;

  try {
    BufferedReader br = new BufferedReader(new FileReader(filepath)); // ν• μ¤„μ”© μ½κΈ° νΈν•κ² BufferedReaderλ΅ νμΌμ„ κ°€μ Έμ¨λ‹¤.
    Integer sum = 0;
    String line = null;
    while((line = br.readLine()) != null ) { // λ§μ§€λ§‰ λΌμΈκΉμ§€ ν• μ¤„μ”© μ½μ–΄κ°€λ©΄μ„ μ«μλ¥Ό λ”ν•λ‹¤.
      sum += Integer.valueOf(line);
    }
    return sum;
  } catch(IOException e) {
    System.out.println(e.getMessage());
    throw e;
  } finally {
    if (br != null) { // BufferedReader μ¤λΈμ νΈκ°€ μƒμ„±λκΈ° μ „μ— μμ™Έκ°€ λ°μƒν•  μλ„ μμΌλ―€λ΅ λ°λ“μ‹ null μ²΄ν¬λ¥Ό λ¨Όμ € ν•΄μ•Ό ν•λ‹¤.
      try { br.close(); }
      catch(IOException e) { System.out.println(e.getMessage()); }
    }
  }
}
```
- try/catch/finally λΈ”λ΅μ„ μ μ©ν•΄μ„ μ–΄λ–¤ κ²½μ°λΌλ„ νμΌμ΄ μ—΄λ ΈμΌλ©΄ λ°λ“μ‹ λ‹«μ•„μ£Όλ„λ΅ λ§λ“¤μ–΄μ•Ό ν•λ‹¤.

<br/>

> ***μ¤‘λ³µμ μ κ±°μ™€ ν…ν”λ¦Ώ/μ½λ°± μ„¤κ³„***

- νμΌμ— μλ” λ¨λ“  μ«μμ κ³±μ„ κ³„μ‚°ν•λ” κΈ°λ¥μ„ μ¶”κ°€ν•΄μ•Ό ν•λ‹¤λ” μ”κµ¬κ°€ λ°μƒν–λ‹¤.
- κ·Έ μ™Έμ—λ„ μ•μΌλ΅ λ§μ€ νμΌμ— λ‹΄κΈ΄ μ«μ λ°μ΄ν„°λ¥Ό μ—¬λ¬ κ°€μ§€ λ°©μ‹μΌλ΅ μ²λ¦¬ν•λ” κΈ°λ¥μ΄ κ³„μ† μ¶”κ°€λ  κ°€λ¥μ„±λ„ λ†’λ‹¤.

<br/>

π”½ BufferedReaderλ¥Ό μ „λ‹¬λ°›λ” μ½λ°± μΈν„°νμ΄μ¤
```java
package springbook.learningtest.template;
...
public interface BufferedReaderCallback {
  Integer doSomethingWithReader(BufferedReader br) throws IOException;
}
```
- ν…ν”λ¦Ώ/μ½λ°± ν¨ν„΄μ„ μ μ©ν•΄λ³΄μ.
- **ν…ν”λ¦Ώ**μ΄ **BufferedReaderλ¥Ό λ§λ“¤μ–΄μ„ μ½λ°±μ—κ² μ „λ‹¬**ν•΄μ£Όκ³ , **μ½λ°±**μ΄ κ° λΌμΈμ„ μ½μ–΄μ„ μ•μ•„μ„ μ²λ¦¬ν• ν›„μ— **μµμΆ… κ²°κ³Όλ§ ν…ν”λ¦Ώμ—κ² λλ ¤μ£Όλ” κµ¬μ΅°**μ΄λ‹¤.

<br/>

π”½ BufferedReaderCallbackμ„ μ‚¬μ©ν•λ” ν…ν”λ¦Ώ λ©”μ†λ“
```java
public Integer fileReadTemplate(String filepath, BufferedReaderCallback callback) throws SQLException {
  BufferedReader br = null;
  try {
    br = new BufferedReader(new FileReader(filepath));
    int ret = callback.doSomethingWithReader(br); // μ½λ°± μ¤λΈμ νΈ νΈμ¶. ν…ν”λ¦Ώμ—μ„ λ§λ“  μ»¨ν…μ¤νΈ μ •λ³΄μΈ BufferedReaderλ¥Ό μ „λ‹¬ν•΄μ£Όκ³  μ½λ°±μ μ‘μ—… κ²°κ³Όλ¥Ό λ°›μ•„λ‘”λ‹¤.
    return ret;
  } catch(IOException e) {
    System.out.println(e.getMessage());
    throw e;
  } finally {
    if (br != null) { // BufferedReader μ¤λΈμ νΈκ°€ μƒμ„±λκΈ° μ „μ— μμ™Έκ°€ λ°μƒν•  μλ„ μμΌλ―€λ΅ λ°λ“μ‹ null μ²΄ν¬λ¥Ό λ¨Όμ € ν•΄μ•Ό ν•λ‹¤.
      try { br.close(); }
      catch(IOException e) { System.out.println(e.getMessage()); }
    }
  }
}
```
- ν…ν”λ¦Ώ λ¶€λ¶„μ„ λ©”μ†λ“λ΅ λ¶„λ¦¬ν•λ‹¤.
- BufferedReaderCallback μΈν„°νμ΄μ¤ νƒ€μ…μ μ½λ°± μ¤λΈμ νΈλ¥Ό λ°›μ•„ μ μ ν• μ‹μ μ— μ‹¤ν–‰ν•΄μ£Όλ©΄ λλ‹¤.
- μ½λ°±μ΄ λλ ¤μ¤€ κ²°κ³Όλ” μµμΆ…μ μΌλ΅ λ¨λ“  μ²λ¦¬λ¥Ό λ§μΉ ν›„μ— λ‹¤μ‹ ν΄λΌμ΄μ–ΈνΈμ— λλ ¤μ¤€λ‹¤.

<br/>

π”½ ν…ν”λ¦Ώ/μ½λ°±μ„ μ μ©ν• calcSum() λ©”μ†λ“
```java
public Integer calcSum(String filepath) throws IOException {
  BufferedReaderCallback sumCallback = new BufferedReaderCallback() {
    public Integer doSomethingWithReader(BufferedReader br) throws IOException {
      Integer sum = 0;
      String line = null;
      while((line = br.readLine()) != null ) {
        sum += Integer.valueOf(line);
      }
      return sum;
    }
  };
  return fileReadTemplate(filepath, sumCallback);
}
```
- ν…ν”λ¦ΏμΌλ΅ λ¶„λ¦¬ν• λ¶€λ¶„μ„ μ μ™Έν• λ‚λ¨Έμ§€ μ½”λ“λ¥Ό BufferedReaderCallback μΈν„°νμ΄μ¤λ΅ λ§λ“  μµλ… λ‚΄λ¶€ ν΄λμ¤μ— λ‹΄λ”λ‹¤.
- μ²λ¦¬ν•  νμΌμ κ²½λ΅μ™€ ν•¨κ» μ¤€λΉ„λ μµλ… λ‚΄λ¶€ ν΄λμ¤μ μ¤λΈμ νΈλ¥Ό ν…ν”λ¦Ώμ— μ „λ‹¬ν•λ‹¤.
- ν…ν”λ¦Ώμ΄ λ¦¬ν„΄ν•λ” κ°’μ„ μµμΆ… κ²°κ³Όλ΅ μ‚¬μ©ν•λ©΄ λλ‹¤.

<br/>

π”½ μƒλ΅μ΄ ν…μ¤νΈ λ©”μ†λ“λ¥Ό μ¶”κ°€ν• CalcSumTest
```java
package springbook.learningtest.template;
...
public class CalcSumTest {
  Calculator calculator;
  String numFilepath;

  @Before
  public void setUp() {
    this.calculator = new Calculator();
    this.numFilepath = getClass().getResource("numbers.txt").getPath();
  }

  @Test
  public void sumOfNumbers() throws IOException {
    assertThat(calculator.calcSum(this.numFilepath), is(10));
  }

  @Test
  public void multiplyOfNumbers() throws IOException {
    assertThat(calculator.calcMultiply(this.numFilepath), is(24));
  }
}
```
- ν…μ¤νΈλ¥Ό λ§λ“¤μ–΄λ³΄μ.
- μ‚¬μ©ν•  μ¤λΈμ νΈμ™€ νμΌ κ²½λ΅ κ°’μ€ @Before λ©”μ†λ“μ—μ„ λ―Έλ¦¬ ν”½μ¤μ²λ΅ λ§λ“¤μ–΄λ‘λ” κ²ƒμ΄ μΆ‹λ‹¤.

<br/>

π”½ κ³±μ„ κ³„μ‚°ν•λ” μ½λ°±μ„ κ°€μ§„ calcMultiply() λ©”μ†λ“
```java
public Integer calcMultiply(String filepath) throws IOException {
  BufferedReaderCallback multiplyCallback = new BufferedReaderCallback() {
    public Integer doSomethingWithReader(BufferedReader br) throws IOException {
      Integer multiply = 1;
      String line = null;
      while((line = br.readLine()) != null ) {
        multiply *= Integer.valueOf(line);
      }
      return multiply;
    }
  };
  return fileReadTemplate(filepath, multiplyCallback);
}
```
- ν…μ¤νΈλ¥Ό μ„±κ³µμ‹ν‚¤λ” μ½”λ“(calcMultiply() λ©”μ†λ“)λ¥Ό λ§λ“¤μ–΄λ³΄μ.
- κ° λΌμΈμ μ«μλ¥Ό (λ”ν•λ” λ€μ‹ ) κ³±ν•λ” κΈ°λ¥μ„ λ‹΄μ€ μ½λ°±μ„ μ‚¬μ©ν•λ„λ΅ λ§λ“¤μ–΄μ£Όλ©΄ λλ‹¤.

<br/>

> ***ν…ν”λ¦Ώ/μ½λ°±μ μ¬μ„¤κ³„***

- calcSum()κ³Ό calcMultiply()μ— λ‚μ¤λ” 2κ°μ μ½λ°±μ„ λΉ„κµν•΄λ³΄λ©΄, λ‘ μ½”λ“κ°€ μ•„μ£Ό μ μ‚¬ν•¨μ„ μ• μ μλ‹¤.
- λ¨Όμ € κ²°κ³Όλ¥Ό μ €μ¥ν•  λ³€μλ¥Ό μ΄κΈ°ν™”ν•κ³ ,
- BufferedReaderλ¥Ό μ΄μ©ν•΄ νμΌμ λ§μ§€λ§‰ λΌμΈκΉμ§€ μμ°¨μ μΌλ΅ μ½μΌλ©΄μ„ κ° λΌμΈμ—μ„ μ½μ€ λ‚΄μ©μ„ κ²°κ³Όλ¥Ό μ €μ¥ν•  λ³€μμ κ°’κ³Ό ν•¨κ» κ³„μ‚°ν•λ‹¤κ°€,
- νμΌμ„ λ‹¤ μ½μ—μΌλ©΄ κ²°κ³Όλ¥Ό μ €μ¥ν•κ³  μλ” λ³€μμ κ°’μ„ λ¦¬ν„΄ν•λ‹¤.

<br/>

π”½ λΌμΈλ³„ μ‘μ—…μ„ μ •μν• μ½λ°± μΈν„°νμ΄μ¤
```java
package springbook.learningtest.template;
...
public interface LineCallback {
  Integer doSomethingWithLine(String line, Integer value);
}
```
- μ μ‚¬ν• μ½”λ“λ¥Ό μ½λ°± μΈν„°νμ΄μ¤λ΅ μ •μν–λ‹¤.
- νμΌμ κ° λΌμΈκ³Ό ν„μ¬κΉμ§€ κ³„μ‚°ν• κ°’μ„ λ„κ²¨μ£Όλ„λ΅ ν•λ‹¤.
- μƒλ΅μ΄ κ³„μ‚° κ²°κ³Όλ¥Ό λ¦¬ν„΄ κ°’μ„ ν†µν•΄ λ‹¤μ‹ μ „λ‹¬λ°›λ„λ΅ ν•λ‹¤.
- μ΄λ΅μ¨ ν…ν”λ¦Ώμ— ν¬ν•¨λλ” μ‘μ—… νλ¦„μ€ λ” λ§μ•„μ§€κ³  μ½λ°±μ€ λ‹¨μν•΄μ§ κ²ƒμ΄λ‹¤.

<br/>

π”½ LineCallbackμ„ μ‚¬μ©ν•λ” ν…ν”λ¦Ώ
```java
public Integer lineReadTemplate(String filepath, LineCallback callback, int initVal) throws IOException {
  BufferedReader br = null;
  try {
    br = new BufferedReader(new FileReader(filepath));
    Integer res = initVal;
    String line = null;
    while((line = br.readLine()) != null) { // νμΌμ κ° λΌμΈμ„ λ£¨ν”„λ¥Ό λλ©΄μ„ κ°€μ Έμ¤λ” κ²ƒλ„ ν…ν”λ¦Ώμ΄ λ‹΄λ‹Ήν•λ‹¤.
      // res: μ½λ°±μ΄ κ³„μ‚°ν• κ°’μ„ μ €μ¥ν•΄λ’€λ‹¤κ°€ λ‹¤μ λΌμΈ κ³„μ‚°μ— λ‹¤μ‹ μ‚¬μ©ν•λ‹¤.
      // line: κ° λΌμΈμ λ‚΄μ©μ„ κ°€μ§€κ³  κ³„μ‚°ν•λ” μ‘μ—…λ§ μ½λ°±μ—κ² λ§΅κΈ΄λ‹¤.
      res = callback.doSomethingWithLine(line, res);
    }
    return res;
  } catch (IOException e) {
    ...
  } finally {
    ...
  }
}
```
- LineCallback μΈν„°νμ΄μ¤λ¥Ό κ²½κ³„λ΅ ν•΄μ„ λ§λ“  μƒλ΅μ΄ ν…ν”λ¦Ώμ΄λ‹¤.
- νμΌμ κ° λΌμΈμ„ μ½λ” μ‘μ—…μ΄ μ¶”κ°€λλ‹¤.
- κ³„μ‚° κ²°κ³Όλ¥Ό λ‹΄μ„ λ³€μλ¥Ό μ΄κΈ°ν™” ν•  κ°’λ„ νλΌλ―Έν„°λ„ μ „λ‹¬λ°›κ² λ§λ“¤μ—λ‹¤.
- κΈ°μ΅΄μ ν…ν”λ¦Ώκ³Ό λ‹¤λ¥΄κ², μ½λ°±μ„ μ—¬λ¬ λ² λ°λ³µμ μΌλ΅ νΈμ¶ν•λ” κµ¬μ΅°κ°€ λμ—λ‹¤.

<br/>

π”½ lineReadTemplate()μ„ μ‚¬μ©ν•λ„λ΅ μμ •ν• calSum(), calcMultiply() λ©”μ†λ“
```java
public Integer calcSum(String filepath) throws IOException {
  LineCallback sumCallback = new LineCallback() {
    public Integer doSomethingWithReader(String line, Integer value) {
      return value + Integer.valueOf(line);
    }
  };
  return lineReadTemplate(filepath, sumCallback, 0);
}

public Integer calcMultiply(String filepath) throws IOException {
  LineCallback multiplyCallback = new LineCallback() {
    public Integer doSomethingWithReader(String line, Integer value) {
      return value * Integer.valueOf(line);
    }
  };
  return lineReadTemplate(filepath, multiplyCallback, 1);
}
```
- ν•µμ‹¬ μ½”λ“λ” λ”± ν• μ¤„ λΏμ΄λ‹¤.
- νμΌ μ²λ¦¬ μ½”λ“κ°€ ν…ν”λ¦ΏμΌλ΅ λ¶„λ¦¬λκ³  μμν• κ³„μ‚° λ΅μ§λ§ λ‚¨μ•„μκΈ° λ•λ¬Έμ— **μ½”λ“μ κ΄€μ‹¬μ΄ λ¬΄μ—‡μΈμ§€ λ…ν™•ν** λ³΄μΈλ‹¤.

<br/>

> ***μ λ„¤λ¦­μ¤λ¥Ό μ΄μ©ν• μ½λ°± μΈμ¤ν„΄μ¤***

- μλ°” 5μ—μ„ μ¶”κ°€λ μ–Έμ–΄μ μΈ νΉμ§•μ„ μ ν™μ©ν•λ©΄ μΆ€ λ” κ°•λ ¥ν• ν…ν”λ¦Ώ/μ½λ°± κµ¬μ΅°λ¥Ό λ§λ“¤ μ μλ‹¤.
- μ•μ ν…ν”λ¦Ώκ³Ό μ½λ°±μ΄ λ§λ“¤μ–΄λ‚΄λ” κ²°κ³Όλ” Integer νƒ€μ…μΌλ΅ κ³ μ •λμ–΄ μλ‹¤.
- λ§μ•½ **κ²°κ³Όμ νƒ€μ…μ„ λ‹¤μ–‘ν•κ²** κ°€μ Έκ°€κ³  μ‹¶λ‹¤λ©΄, μλ°” μ–Έμ–΄μ— νƒ€μ… νλΌλ―Έν„°λΌλ” κ°λ…μ„ λ„μ…ν• **μ λ„¤λ¦­μ¤(Generics)** λ¥Ό μ΄μ©ν•λ©΄ λλ‹¤.
- μ λ„¤λ¦­μ¤λ¥Ό μ΄μ©ν•λ©΄ λ‹¤μ–‘ν• μ¤λΈμ νΈ νƒ€μ…μ„ μ§€μ›ν•λ” μΈν„°νμ΄μ¤λ‚ λ©”μ†λ“λ¥Ό μ •μν•  μ μλ‹¤.

<br/>

- μ΄μ  νμΌμ κ° λΌμΈμ— μλ” λ¬Έμλ¥Ό λ¨λ‘ μ—°κ²°ν•΄μ„ ν•λ‚μ μ¤νΈλ§μΌλ΅ λλ Ίλ” κΈ°λ¥μ„ λ§λ“¤μ–΄λ³΄μ.
- μ΄λ²μ—λ” λ¦¬ν„΄ν•λ” νƒ€μ…μ΄ String μ΄μ–΄μ•Ό ν•λ‹¤.
- κΈ°μ΅΄μ— λ§λ“¤μ—λ Integer νƒ€μ…μ κ²°κ³Όλ§ λ‹¤λ£¨λ” μ½λ°±/ν…ν”λ¦Ώμ„ String νƒ€μ…λ„ μ²λ¦¬ν•  μ μλ„λ΅ ν™•μ¥ν•λ‹¤.

<br/>

π”½ νƒ€μ… νλΌλ―Έν„°λ¥Ό μ μ©ν• LineCallback
```java
public interface LineCallback<T> {
  T doSomethingWithLine(String line, T value);
}
```
- κΈ°μ΅΄μ μ½λ°± μΈν„°νμ΄μ¤λ¥Ό **μ½λ°± λ©”μ†λ“μ λ¦¬ν„΄ κ°’κ³Ό νλΌλ―Έν„° κ°’μ νƒ€μ…μ„ μ λ„¤λ¦­ νƒ€μ… νλΌλ―Έν„° Tλ΅ μ„ μ–Έ**ν•λ‹¤.

<br/>

π”½ νƒ€μ… νλΌλ―Έν„°λ¥Ό μ¶”κ°€ν•΄μ„ μ λ„¤λ¦­ λ©”μ†λ“λ΅ λ§λ“  lineReadTemplate()
```java
public <T> T lineReadTemplate(String filepath, LineCallback<T> callback, T initVal) throws IOException {
  BufferedReader br = null;
  try {
    br = new BufferedReader(new FileReader(filepath));
    T res = initVal;
    String line = null;
    while((line = br.readLine()) != null) {
      res = callback.doSomethingWithLine(line, res);
    }
    return res;
  } catch (IOException e) {
    ...
  } finally {
    ...
  }
}
```
- lineReadTemplate() λ©”μ†λ“λ„ νƒ€μ… νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•΄ μ λ„¤λ¦­ λ©”μ†λ“λ΅ λ§λ“¤μ–΄μ¤€λ‹¤.
- **μ½λ°±μ νƒ€μ… νλΌλ―Έν„°**μ™€ **μ΄κΈ°κ°’μΈ initValμ νƒ€μ…**, κ·Έλ¦¬κ³  **ν…ν”λ¦Ώμ κ²°κ³Ό κ°’ νƒ€μ…**μ„ λ¨λ‘ λ™μΌν•κ² μ„ μ–Έν•΄μ•Ό ν•λ‹¤.

<br/>

π”½ λ¬Έμμ—΄ μ—°κ²° κΈ°λ¥ μ½λ°±μ„ μ΄μ©ν•΄ λ§λ“  concatenate() λ©”μ†λ“
```java
public String concatenate(String filepath) throws IOException {
  LineCallback<String> concatenateCallback = new LineCallback<String>() {
    public String doSomethingWithLine(String line, String value) {
      return value + line;
    }
  };
  return lineReadTemplate(filepath, concatenateCallback, ""); // ν…ν”λ¦Ώ λ©”μ†λ“μ Tλ” λ¨λ‘ String νƒ€μ…μ΄ λλ‹¤.
}
```
- νμΌμ λ¨λ“  λΌμΈμ λ‚΄μ©μ„ ν•λ‚μ λ¬Έμμ—΄λ΅ κΈΈκ² μ—°κ²°ν•λ” κΈ°λ¥μ„ κ°€μ§„ λ©”μ†λ“λ¥Ό μ¶”κ°€ν–λ‹¤.
- μµμΆ…μ μΌλ΅ lineReadTemplate() λ©”μ†λ“μ κ²°κ³Όλ„ String νƒ€μ…μ΄ λΌμ„ concatenate() λ©”μ†λ“μ λ¦¬ν„΄ νƒ€μ…λ„ StringμΌλ΅ μ •μν•  μ μλ‹¤.

<br/>

π”½ concatenate() λ©”μ†λ“μ— λ€ν• ν…μ¤νΈ
```java
@Test
public void concatenateStrings() throws IOException {
  assertThat(calculator.concatenate(this.numFilepath), is("1234"));
}
```
- concatenate() λ©”μ†λ“μ— λ€ν• ν…μ¤νΈ μ½”λ“μ΄λ‹¤.

<br/>

```java
LineCallback<Integer> sumCallback = new LineCallback<Integer>() { ... };
```
- κΈ°μ΅΄μ— λ§λ“¤μ—λ calcSum()κ³Ό calcMultiply()μ€ Integer νƒ€μ… νλΌλ―Έν„°λ¥Ό κ°€μ§„ μΈν„°νμ΄μ¤λ΅ μ •μν•΄μ£ΌκΈ°λ§ ν•λ©΄ κ·Έλ€λ΅ μ‚¬μ©ν•  μ μλ‹¤.

<br/>

- μ΄λ ‡κ² λ²”μ©μ μΌλ΅ λ§λ“¤μ–΄μ§„ ν…ν”λ¦Ώ/μ½λ°±μ„ μ΄μ©ν•λ©΄ νμΌμ„ λΌμΈ λ‹¨μ„λ΅ μ²λ¦¬ν•λ” λ‹¤μ–‘ν• κΈ°λ¥μ„ νΈλ¦¬ν•κ² λ§λ“¤ μ μλ‹¤.

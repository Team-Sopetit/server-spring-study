## 3.3 JDBC ì „ëµ íŒ¨í„´ì˜ ìµœì í™”
DAO ë©”ì†Œë“œëŠ” ì „ëµ íŒ¨í„´ì˜ í´ë¼ì´ì–¸íŠ¸ë¡œì„œ ì»¨í…ìŠ¤íŠ¸ì— í•´ë‹¹í•˜ëŠ” jdbcContextWithStatementStrategy() ë©”ì†Œë“œì— ì ì ˆí•œ ì „ëµì„ ì œê³µí•œë‹¤. <br/>
ì—¬ê¸°ì„œ **ì»¨í…ìŠ¤íŠ¸**ëŠ” **PreparedStatementë¥¼ ì‹¤í–‰í•˜ëŠ” JDBCì˜ ì‘ì—… íë¦„**ì´ê³ , **ì „ëµ**ì€ **PreparedStatementë¥¼ ìƒì„±í•˜ëŠ” ê²ƒ**ì´ë‹¤.

### 3.3.1 ì „ëµ í´ë˜ìŠ¤ì˜ ì¶”ê°€ ì •ë³´

ğŸ”½ add() ë©”ì†Œë“œì˜ PreparedStatement ìƒì„± ë¡œì§ì„ ë¶„ë¦¬í•œ í´ë˜ìŠ¤
```java
public class AddStatement implements StatementStrategy {
  public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
    PreparedStatement ps = c.preparedStatement("insert into users(id, name, password) values(?,?,?)");
    ps.setString(1, user.getId());
    ps.setString(2, user.getName());
    ps.setString(3, user.getPassword()); // ê·¸ëŸ°ë° userëŠ” ì–´ë””ì„œ ê°€ì ¸ì˜¬ê¹Œ?

    return ps;
  }
}
```
- add() ë©”ì†Œë“œì—ì„œ ë³€í•˜ëŠ” ë¶€ë¶„ì¸ PreparedStatementë¥¼ ë§Œë“œëŠ” ì½”ë“œë¥¼ AddStatement í´ë˜ìŠ¤ë¡œ ì˜®ê²¨ ë‹´ëŠ”ë‹¤.
- í•˜ì§€ë§Œ add()ì—ì„œëŠ” userë¼ëŠ” ë¶€ê°€ì ì¸ ì •ë³´ê°€ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ì»´íŒŒì¼ ì—ëŸ¬ê°€ ë‚œë‹¤.

<br/>

ğŸ”½ User ì •ë³´ë¥¼ ìƒì„±ìë¡œë¶€í„° ì œê³µë°›ë„ë¡ ë§Œë“  AddStatement
```java
package springbook.user.dao;
...
public class AddStatement implements StatementStrategy {
  User user;

  public AddStatement(User user) {
    this.user = user;
  }

  public PreparedStatement makePreparedStatement(Connection c) {
    ...
    ps.setString(1, user.getId());
    ps.setString(2, user.getName());
    ps.setString(3, user.getPassword());
    ...
  }
}
```
- í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° User íƒ€ì… ì˜¤ë¸Œì íŠ¸ë¥¼ ë°›ì„ ìˆ˜ ìˆë„ë¡ AddStatementì˜ ìƒì„±ìë¥¼ í†µí•´ ì œê³µë°›ë„ë¡ í–ˆë‹¤.

<br/>

ğŸ”½ user ì •ë³´ë¥¼ AddStatementì— ì „ë‹¬í•´ì£¼ëŠ” add() ë©”ì†Œë“œ
```java
public void add(User user) throws SQLException {
  StatementStrategy st = new AddStatement(user);
  jdbcContextWithStatementStrategy(st);
}
```
- ì•ìœ¼ë¡œ ë¹„ìŠ·í•œ ê¸°ëŠ¥ì˜ DAO ë©”ì†Œë“œê°€ í•„ìš”í•  ë•Œë§ˆë‹¤ Statement ì „ëµê³¼ jdbcContextWithStatementStrategy() ì»¨í…ìŠ¤íŠ¸ë¥¼ í™œìš©í•¨ìœ¼ë¡œì¨ try/catch/finallyë¡œ ë²”ë²…ëœ ì½”ë“œë¥¼ ë§Œë“¤ë‹¤ê°€ ì‹¤ìˆ˜í•  ê°€ëŠ¥ì„±ì€ ë‚®ì•„ì¡Œë‹¤.
- DAO ì½”ë“œë„ ê°„ê²°í•´ì¡Œë‹¤. ì „ê³¼ ë¹„êµí•´ ì½”ë“œì˜ ì–‘ì„ 70~80%ê¹Œì§€ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

<br/>

### 3.3.2 ì „ëµê³¼ í´ë¼ì´ì–¸íŠ¸ì˜ ë™ê±°
ì¢€ ë” ê°œì„ í•  ë¶€ë¶„ì´ 2ê°€ì§€ ìˆë‹¤.
- DAO ë©”ì†Œë“œë§ˆë‹¤ ìƒˆë¡œìš´ StatementStrategy êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤.
- DAO ë©”ì†Œë“œì—ì„œ StatementStrategyì— ì „ë‹¬í•  ë¶€ê°€ì ì¸ ì •ë³´(Ex. User)ê°€ ìˆëŠ” ê²½ìš°, ìƒì„±ìì™€ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ë¥¼ ë²ˆê±°ë¡­ê²Œ ë§Œë“¤ì–´ì•¼ í•œë‹¤.

<br/>

> ***ë¡œì»¬ í´ë˜ìŠ¤***

ğŸ”½ add() ë©”ì†Œë“œ ë‚´ì˜ ë¡œì»¬ í´ë˜ìŠ¤ë¡œ ì´ì „í•œ AddStatement
```java
public void add(User user) throws SQLException {
  class AddStatement implements StatementStrategy { // add() ë©”ì†Œë“œ ë‚´ë¶€ì— ì„ ì–¸ëœ ë¡œì»¬ í´ë˜ìŠ¤
    User user;
  
    public AddStatement(User user) {
      this.user = user;
    }

    public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
      PreparedStatement ps = c.preparedStatement("insert into users(id, name, password) values(?,?,?)");
      ps.setString(1, user.getId());
      ps.setString(2, user.getName());
      ps.setString(3, user.getPassword());
  
      return ps;
    }
  }

  StatementStrategy st = new AddStatement(user);
  jdbcContextWithStatementStrategy(st);
}
```
- í´ë˜ìŠ¤ íŒŒì¼ì´ ë§ì•„ì§€ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤.
- StatementStrategy ì „ëµ í´ë˜ìŠ¤ë¥¼ ë§¤ë²ˆ ë…ë¦½ëœ íŒŒì¼ë¡œ ë§Œë“¤ì§€ ë§ê³ , **UserDao í´ë˜ìŠ¤ ì•ˆì— ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ì •ì˜**í•´ë²„ë¦¬ëŠ” ê²ƒì´ë‹¤.
- (DeleteAllStatement, AddStatement ëª¨ë‘) UserDaoì—ì„œë§Œ ì‚¬ìš©ë˜ê³ , UserDao ë©”ì†Œë“œ ë¡œì§ì— ê°•í•˜ê²Œ ê²°í•©ë˜ì–´ ìˆë‹¤.
- íŠ¹ì • ë©”ì†Œë“œì—ì„œë§Œ ì‚¬ìš©ëœë‹¤ë©´ ë¡œì»¬ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

<br/>

ğŸ”½ add() ë©”ì†Œë“œì˜ ë¡œì»¬ ë³€ìˆ˜ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •í•œ AddStatement
```java
public void add(final User user) throws SQLException {
  class AddStatement implements StatementStrategy { // add() ë©”ì†Œë“œ ë‚´ë¶€ì— ì„ ì–¸ëœ ë¡œì»¬ í´ë˜ìŠ¤
    public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
      PreparedStatement ps = c.preparedStatement("insert into users(id, name, password) values(?,?,?)");

      // ë¡œì»¬(ë‚´ë¶€) í´ë˜ìŠ¤ì˜ ì½”ë“œì—ì„œ ì™¸ë¶€ì˜ ë©”ì†Œë“œ ë¡œì»¬ ë³€ìˆ˜ì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
      ps.setString(1, user.getId());
      ps.setString(2, user.getName());
      ps.setString(3, user.getPassword());
  
      return ps;
    }
  }

  StatementStrategy st = new AddStatement(); // ìƒì„±ìê°€ íŒŒë¼ë¯¸í„°ë¡œ userë¥¼ ì „ë‹¬í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.
  jdbcContextWithStatementStrategy(st);
}
```
- ë¡œì»¬ í´ë˜ìŠ¤ëŠ” í´ë˜ìŠ¤ê°€ ë‚´ë¶€ í´ë˜ìŠ¤ì´ê¸° ë•Œë¬¸ì— **ìì‹ ì´ ì„ ì–¸ëœ ê³³ì˜ ì •ë³´ì— ì ‘ê·¼**í•  ìˆ˜ ìˆë‹¤.
- ë‚´ë¶€ í´ë˜ìŠ¤ì—ì„œ ì™¸ë¶€ì˜ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì™¸ë¶€ ë³€ìˆ˜ëŠ” ë°˜ë“œì‹œ **final**ë¡œ ì„ ì–¸í•´ì¤˜ì•¼ í•œë‹¤.
- user íŒŒë¼ë¯¸í„°ëŠ” ë©”ì†Œë“œ ë‚´ë¶€ì—ì„œ ë³€ê²½ë  ì¼ì´ ì—†ìœ¼ë¯€ë¡œ finalë¡œ ì„ ì–¸í•´ë„ ë¬´ë°©í•˜ë‹¤.
- user ì •ë³´ë¥¼ ì „ë‹¬ë°›ê¸° ìœ„í•´ ë§Œë“¤ì—ˆë˜ ìƒì„±ìì™€ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ë¥¼ ì œê±°í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì½”ë“œê°€ ê°„ê²°í•´ì§„ë‹¤.

<br/>

> ***ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤***

ğŸ”½ AddStatementë¥¼ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ì „í™˜
```java
StatementStrategy st = new StatementStrategy() { // ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ëŠ” êµ¬í˜„í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±ìì²˜ëŸ¼ ì´ìš©í•´ì„œ ì˜¤ë¸Œì íŠ¸ë¡œ ë§Œë“ ë‹¤.
    public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
      PreparedStatement ps = c.preparedStatement("insert into users(id, name, password) values(?,?,?)");
      ps.setString(1, user.getId());
      ps.setString(2, user.getName());
      ps.setString(3, user.getPassword());
  
      return ps;
    }
};
```
- AddStatement í´ë˜ìŠ¤ëŠ” add() ë©”ì†Œë“œì—ì„œë§Œ ì‚¬ìš©í•  ìš©ë„ë¡œ ë§Œë“¤ì–´ì¡Œìœ¼ë¯€ë¡œ **ê°„ê²°í•˜ê²Œ í´ë˜ìŠ¤ ì´ë¦„ë„ ì œê±°**í•  ìˆ˜ ìˆë‹¤.
- ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ëŠ” ì„ ì–¸ê³¼ ë™ì‹œì— ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•œë‹¤.
- ì´ë¦„ì´ ì—†ê¸° ë•Œë¬¸ì— í´ë˜ìŠ¤ ìì‹ ì˜ íƒ€ì…ì„ ê°€ì§ˆ ìˆ˜ ì—†ê³ , êµ¬í˜„í•œ ì¸í„°í˜ì´ìŠ¤ íƒ€ì…ì˜ ë³€ìˆ˜ì—ë§Œ ì €ì¥í•  ìˆ˜ ìˆë‹¤.

<br/>

ğŸ”½ ë©”ì†Œë“œ íŒŒë¼ë¯¸í„°ë¡œ ì´ì „í•œ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤
```java
public void add(final User user) throws SQLException {
  jdbcContextWithStatementStrategy(
    new StatementStrategy() { // ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ëŠ” êµ¬í˜„í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±ìì²˜ëŸ¼ ì´ìš©í•´ì„œ ì˜¤ë¸Œì íŠ¸ë¡œ ë§Œë“ ë‹¤.
        public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
          PreparedStatement ps = c.preparedStatement("insert into users(id, name, password) values(?,?,?)");
          ps.setString(1, user.getId());
          ps.setString(2, user.getName());
          ps.setString(3, user.getPassword());
      
          return ps;
        }
    }
  );
}
```
- ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ëŠ” í•œ ë²ˆë§Œ ì‚¬ìš©ë˜ë¯€ë¡œ jdbcContextWithStatementStrategy() ë©”ì†Œë“œì˜ íŒŒë¼ë¯¸í„°ë¡œ ë°”ë¡œ ìƒì„±í•œë‹¤.

<br/>

ğŸ”½ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ ì ìš©í•œ deleteAll() ë©”ì†Œë“œ
```java
public void deleteAll() throws SQLException {
  jdbcContextWithStatementStrategy(
    new StatementStrategy() {
      public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
        return c.preparedStatement("delete from users");
      }
    }
  );
}
```
- DeleteAllStatementë„ deleteAll() ë©”ì†Œë“œë¡œ ê°€ì ¸ì™€ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ê°„ëµí•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

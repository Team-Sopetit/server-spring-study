# 6.5 μ¤ν”„λ§ AOP

- λ¶„λ¦¬ν•΄λ‚Έ νΈλμ­μ… μ½”λ“λ” ν¬λ…ν• λ¶€κ°€κΈ°λ¥ ν•νƒλ΅ μ κ³µλμ–΄μ•Ό ν•λ‹¤.
- ν¬λ…ν•λ‹¤λ” κ±΄ λ¶€κ°€κΈ°λ¥μ„ μ μ©ν• ν›„μ—λ„ κΈ°μ΅΄ μ„¤κ³„μ™€ μ½”λ“μ—λ” μν–¥μ„ μ£Όμ§€ μ•λ”λ‹¤λ” λ»μ΄λ‹¤.

<br/>

## 6.5.1 μλ™ ν”„λ΅μ‹ μƒμ„±

- π‘ λ¶€κ°€κΈ°λ¥μ μ μ©μ΄ ν•„μ”ν• νƒ€κΉƒ μ¤λΈμ νΈλ§λ‹¤ κ±°μ λΉ„μ·ν• λ‚΄μ©μ ProxyFactoryBean λΉ μ„¤μ •μ •λ³΄λ¥Ό μ¶”κ°€ν•΄μ£Όλ” λ¬Έμ μ μ„ ν•΄κ²°ν•΄μ•Ό ν•λ‹¤.

<br/>

### μ¤‘λ³µ λ¬Έμ μ μ ‘κ·Ό λ°©λ²•

- λ°λ³µμ μΈ ν”„λ΅μ‹μ λ©”μ†λ“ κµ¬ν„μ„ μ½”λ“ μλ™μƒμ„± κΈ°λ²•μ„ μ΄μ©ν•΄ ν•΄κ²°ν–λ‹¤λ©΄ ProxyFactoryBean λ°λ³µ μ„¤μ • λ¬Έμ λ” μ„¤μ • μλ™λ“±λ΅ κΈ°λ²•μΌλ΅ ν•΄κ²°ν•  μ μ—†μ„κΉ?
- μ‹¤μ  λΉ μ¤λΈμ νΈλ” ProxyFactoryBeanμ„ ν†µν•΄ μƒμ„±λλ” ν”„λ΅μ‹ κ·Έ μμ²΄μ΄λ―€λ΅ ν”„λ΅μ‹κ°€ μλ™μΌλ΅ λΉμΌλ΅ μƒμ„±λκ² ν•  μλ” μ—†μ„κΉ?
- ν•μ§€λ§ μ§€κΈκΉμ§€ μ‚΄ν΄λ³Έ λ°©λ²•μ—μ„λ” ν• λ²μ— μ—¬λ¬ κ°μ λΉμ— ν”„λ΅μ‹λ¥Ό μ μ©ν•  λ§ν• λ°©λ²•μ€ μ—†μ—λ‹¤.

<br/>

### λΉ ν›„μ²λ¦¬κΈ°λ¥Ό μ΄μ©ν• μλ™ ν”„λ΅μ‹ μƒμ„±κΈ°

- λΉ ν›„μ²λ¦¬κΈ°(BeanPostProcessor)λ” μ¤ν”„λ§ λΉ μ¤λΈμ νΈλ΅ λ§λ“¤μ–΄μ§„ ν›„μ— λΉ μ¤λΈμ νΈλ¥Ό λ‹¤μ‹ κ°€κ³µν•  μ μκ² ν•΄μ¤€λ‹¤.
- DefaultAdvisorAutoProxyCreatorλ” μ–΄λ“λ°”μ΄μ €λ¥Ό μ΄μ©ν• μλ™ ν”„λ΅μ‹ μƒμ„±κΈ°λ‹¤.
- μ¤ν”„λ§μ€ λΉ ν›„μ²λ¦¬κΈ°κ°€ λΉμΌλ΅ λ“±λ΅λμ–΄ μμΌλ©΄ λΉ μ¤λΈμ νΈκ°€ μƒμ„±λ  λ•λ§λ‹¤ λΉ ν›„μ²λ¦¬κΈ°μ— λ³΄λ‚΄μ„ ν›„μ²λ¦¬ μ‘μ—…μ„ μ”μ²­ν•λ‹¤.
- μ΄λ¥Ό μ μ΄μ©ν•λ©΄ μ¤ν”„λ§μ΄ μƒμ„±ν•λ” λΉ μ¤λΈμ νΈμ μΌλ¶€λ¥Ό ν”„λ΅μ‹λ΅ ν¬μ¥ν•κ³ , ν”„λ΅μ‹λ¥Ό λΉμΌλ΅ λ€μ‹  λ“±λ΅ν•  μλ„ μλ‹¤.

<br/>

π”½ λΉ ν›„μ²λ¦¬κΈ°λ¥Ό μ΄μ©ν• ν”„λ΅μ‹ μλ™μƒμ„±

![image](https://github.com/Team-Sopetit/server-spring-study/assets/55437339/8c0c3009-5b9b-4966-a980-46a20cad8636)

- λΉ ν›„μ²λ¦¬κΈ°λ¥Ό μ΄μ©ν• μλ™ ν”„λ΅μ‹ μƒμ„± λ°©λ²•μ„ μ„¤λ…ν•λ‹¤.
- 1οΈβƒ£ DefaultAdvisorAutoProxyCreator λΉ ν›„μ²λ¦¬κΈ°κ°€ λ“±λ΅λμ–΄ μμΌλ©΄ μ¤ν”„λ§μ€ λΉ μ¤λΈμ νΈλ¥Ό λ§λ“¤ λ•λ§λ‹¤ ν›„μ²λ¦¬κΈ°μ—κ² λ³΄λ‚Έλ‹¤.
- 2οΈβƒ£ DefaultAdvisorAutoProxyCreatorλ” λΉμΌλ΅ λ“±λ΅λ λ¨λ“  μ–΄λ“λ°”μ΄μ € λ‚΄μ ν¬μΈνΈμ»·μ„ μ΄μ©ν•΄ μ „λ‹¬λ°›μ€ λΉμ΄ ν”„λ΅μ‹ μ μ© λ€μƒμΈμ§€ ν™•μΈν•λ‹¤.
  - μ μ© λ€μƒμ΄λ©΄ λ‚΄μ¥λ ν”„λ΅μ‹ μƒμ„±κΈ°μ—κ² ν„μ¬ λΉμ— λ€ν• ν”„λ΅μ‹λ¥Ό λ§λ“¤κ² ν•κ³ , λ§λ“¤μ–΄μ§„ ν”„λ΅μ‹μ— μ–΄λ“λ°”μ΄μ €λ¥Ό μ—°κ²°ν•΄μ¤€λ‹¤.
- 3οΈβƒ£ λΉ ν›„μ²λ¦¬κΈ°λ” ν”„λ΅μ‹κ°€ μƒμ„±λλ©΄ ν”„λ΅μ‹ μ¤λΈμ νΈλ¥Ό μ»¨ν…μ΄λ„μ—κ² λλ ¤μ¤€λ‹¤.
- 4οΈβƒ£ μ»¨ν…μ΄λ„λ” μµμΆ…μ μΌλ΅ λΉ ν›„μ²λ¦¬κΈ°κ°€ λλ ¤μ¤€ μ¤λΈμ νΈλ¥Ό λΉμΌλ΅ λ“±λ΅ν•κ³  μ‚¬μ©ν•λ‹¤.
- μ΄λ ‡κ² λλ©΄ μΌμΌμ΄ ProxyFactoryBean λΉμ„ λ“±λ΅ν•μ§€ μ•μ•„λ„ νƒ€κΉƒ μ¤λΈμ νΈμ— μλ™μΌλ΅ ν”„λ΅μ‹κ°€ μ μ©λκ² ν•  μ μλ‹¤.

<br/>

### ν™•μ¥λ ν¬μΈνΈμ»·

- ν¬μΈνΈμ»·μ€ μ¤λΈμ νΈ λ‚΄μ λ©”μ†λ“λ¥Ό μ„ νƒν•λ” κΈ°λ¥, λΉ μ¤λΈμ νΈ μμ²΄λ¥Ό μ„ νƒν•λ” κΈ°λ¥ 2κ°€μ§€λ¥Ό λ¨λ‘ κ°€μ§€κ³  μλ‹¤.

<br/>

π”½ λ‘ κ°€μ§€ κΈ°λ¥μ„ μ •μν• Pointcut μΈν„°νμ΄μ¤
```java
public interface Pointcut {
  ClassFilter getClassFilter(); // ν”„λ΅μ‹λ¥Ό μ μ©ν•  ν΄λμ¤μΈμ§€ ν™•μΈν•΄μ¤€λ‹¤.
  MethodMatcher getMethodMatcher(); // μ–΄λ“λ°”μ΄μ¤λ¥Ό μ μ©ν•  λ©”μ†λ“μΈμ§€ ν™•μΈν•΄μ¤€λ‹¤.
}
```
- ν¬μΈνΈμ»·μ€ **ν΄λμ¤ ν•„ν„°**μ™€ **λ©”μ†λ“ λ§¤μ²** λ‘ κ°€μ§€λ¥Ό λλ ¤μ£Όλ” λ©”μ†λ“λ¥Ό κ°–κ³  μλ‹¤.
- μ‹¤μ  ν¬μΈνΈμ»·μ μ„ λ³„ λ΅μ§μ€ μ΄ λ‘ κ°€μ§€ νƒ€μ…μ μ¤λΈμ νΈμ— λ‹΄κ²¨ μλ‹¤.

<br/>

### ν¬μΈνΈμ»· ν…μ¤νΈ

- NameMatchMethodPointcutμ„ ν™•μ¥ν•΄μ„ ν΄λμ¤λ„ κ³ λ¥Ό μ μλ„λ΅ ν•΄λ³΄μ.
- ν”„λ΅μ‹ μ μ© ν›„λ³΄λ¥Ό μ—¬λΏ λ§λ“¤μ–΄λ‘κ³  ν¬μΈνΈμ»·μ„ μ μ©ν• ProxyFactoryBeanμΌλ΅ ν”„λ΅μ‹λ¥Ό λ§λ“¤λ„λ΅ ν•΄μ„ μ–΄λ“λ°”μ΄μ¤κ°€ μ μ©λλ”μ§€ ν™•μΈν•μ.

<br/>

π”½ ν™•μ¥ ν¬μΈνΈμ»· ν…μ¤νΈ
```java
@Test
public void classNamedPointcutAdvisor() {
  // ν¬μΈνΈμ»· μ¤€λΉ„
  NameMatchMethodPointcut classMethodPointcut = new NameMatchMethodPointcut() {
    public ClassFilter getClassFilter() {
      return new ClassFilter() {
        public boolean matches(Class<?> clazz) {
          return class.getSimpleName().startsWith("HelloT"); // ν΄λμ¤ μ΄λ¦„μ΄ HelloTλ΅ μ‹μ‘ν•λ” κ²ƒλ§ μ„ μ •ν•λ‹¤.
        }
      };
    }
  };
  classMethodPointcut.setMappedName("sayH*"); // sayHλ΅ μ‹μ‘ν•λ” λ©”μ†λ“ μ΄λ¦„μ„ κ°€μ§„ λ©”μ†λ“λ§ μ„ μ •ν•λ‹¤.

  // ν…μ¤νΈ
  checkAdviced(new HelloTarget(), classMethodPointcut, true); // HelloTarget μ μ© ν΄λμ¤λ‹¤.

  class HelloWorld extends HelloTarget {};
  checkAdviced(new HelloWorld(), classMethodPointcut, false); // HelloWorldλ” μ μ© ν΄λμ¤κ°€ μ•„λ‹λ‹¤.

  class HelloSohyeon extends HelloTarget {};
  checkAdviced(new HelloToby(), classMethodPointcut, true); // HelloSohyeonμ€ μ μ© ν΄λμ¤λ‹¤.
}

private void checkAdviced(Object target, Pointcut pontcut, boolean adviced) {
  ProxyFactoryBean pfBean = new ProxyFactoryBean();
  pfBean.setTarget(target);
  pfBean.addAdvisor(new DefaultPointcutAdvisor(pontcut, new UppercaseAdvice()));
  Hello proxiedHello = (Hello)pfBean.getObject();

  if (adviced) {
    // λ©”μ†λ“ μ„ μ • λ°©μ‹μ„ ν†µν•΄ μ–΄λ“λ°”μ΄μ¤ μ μ©
    assertThat(proxiedHello.sayHello("Toby"), is("HELLO TOBY"));
    assertThat(proxiedHello.sayHi("Toby"), is("HI TOBY"));

    assertThat(proxiedHello.sayThankYou("Toby"), is("Thank You Toby"));
  } else {
    // μ–΄λ“λ°”μ΄μ¤ μ μ© λ€μƒ ν›„λ³΄μ—μ„ μ•„μ νƒλ½
    assertThat(proxiedHello.sayHello("Toby"), is("Hello Toby"));
    assertThat(proxiedHello.sayHi("Toby"), is("Hi Toby"));
    assertThat(proxiedHello.sayThankYou("Toby"), is("Thank You Toby"));
  }
}
```
- μ›λ λ¨λ“  ν΄λμ¤λ¥Ό λ‹¤ λ°›μ•„μ£Όλ” ν΄λμ¤ ν•„ν„°λ¥Ό λ¦¬ν„΄ν•λ getClassFilter()λ¥΄ μ¤λ²„λΌμ΄λ“ν•΄μ„ μ΄λ¦„μ΄ HelloTλ΅ μ‹μ‘ν•λ” ν΄λμ¤λ§ μ„ μ •ν•΄μ£Όλ” ν•„ν„°λ΅ λ§λ“¤μ—λ‹¤.
- ν…μ¤νΈλ” 3κ°€μ§€ ν΄λμ¤μ— λ€ν•΄ μ§„ν–‰ν•λ‹¤. λ¨λ‘ κΈ°μ΅΄ HelloTargetμ„ κ·Έλ€λ΅ μ μ©ν–μΌλ―€λ΅ μ†λ„ λ™μΌν•λ‹¤.
- HelloWorldλ” μ„ μ • κΈ°μ¤€(ν΄λμ¤ μ΄λ¦„)μ— μ¶©μ΅±ν•μ§€ λ»ν•΄ ν΄λμ¤ ν•„ν„°μ—μ„ νƒλ½ν•λ‹¤.
- ν¬μΈνΈμ»·μ΄ ν΄λμ¤ ν•„ν„°κΉμ§€ λ™μ‘ν•΄μ„ ν΄λμ¤λ¥Ό κ±Έλ¬λ²„λ¦¬λ©΄  μ•„λ¬΄λ¦¬ ν”„λ΅μ‹λ¥Ό μ μ©ν•΄λ„ λ¶€κ°€κΈ°λ¥μ€ μ κ³µλμ§€ μ•λ”λ‹¤λ” μ μ„ μ£Όμν•΄μ•Ό ν•λ‹¤.

<br/>

## 6.5.2 DefaultAdvisorAutoProxyCreatorμ μ μ©

- ν¬μΈνΈμ»·μ„ μ μ©ν•΄λ³΄μ.

<br/>

### ν΄λμ¤ ν•„ν„°λ¥Ό μ μ©ν• ν¬μΈνΈμ»· μ‘μ„±

π”½ ν΄λμ¤ ν•„ν„°κ°€ ν¬ν•¨λ ν¬μΈνΈμ»·
```java
package springbook.learningtest.jdk.proxy;
...
public class NameMatchClassMethodPointcut extends NameMatchMethodPointcut {
  public void setMappedClassName(String mappedClassName) {
    this.setClassFilter(new SimpleClassFilter(mappedClassName)); // λ¨λ“  ν΄λμ¤λ¥Ό λ‹¤ ν—μ©ν•λ λ””ν΄νΈ ν΄λμ¤ ν•„ν„°λ¥Ό ν”„λ΅νΌν‹°λ΅ λ°›μ€ ν΄λμ¤ μ΄λ¦„μ„ μ΄μ©ν•΄μ„ ν•„ν„°λ¥Ό λ§λ“¤μ–΄ λ®μ–΄μ”μ΄λ‹¤.
  }

  static class SimpleClassFilter implements ClassFilter {
    String mappedName;

    private SimpleClassFilter(String mappedName) {
      this.mappedName = mappedName;
    }

    public boolean matches(Class<?> clazz) {
      // simpleMatch: μ™€μΌλ“μΉ΄λ“(*)κ°€ λ“¤μ–΄κ°„ λ¬Έμμ—΄ λΉ„κµλ¥Ό μ§€μ›ν•λ” μ¤ν”„λ§μ μ ν‹Έλ¦¬ν‹° λ©”μ„λ“
      // "*name, name*, *name* 3κ°€μ§€ λ°©μ‹μ„ λ¨λ‘ μ§€μ›ν•λ‹¤.
      return PatternMatchUtils.simpleMatch(mappedName, clazz.getSimpleName());
    }
  }
}
```
- NameMatchMethodPointcut(λ©”μ„λ“ μ΄λ¦„λ§ λΉ„κµ)μ„ μƒμ†ν•΄μ„ ν΄λμ¤ μ΄λ¦„μ„ λΉ„κµν•λ” ClassFilterλ¥Ό μ¶”κ°€ν•λ‹¤.

<br/>

### μ–΄λ“λ°”μ΄μ €λ¥Ό μ΄μ©ν•λ” μλ™ ν”„λ΅μ‹ μƒμ„±κΈ° λ“±λ΅
- DefaultAdvisorAutoProxyCreator(μλ™ ν”„λ΅μ‹ μƒμ„±κΈ°)λ” λ“±λ΅λ λΉ μ¤‘μ—μ„ Advisor μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν• κ²ƒμ„ λ¨λ‘ μ°Ύλ”λ‹¤.
- μƒμ„±λλ” λ¨λ“  λΉμ— λ€ν•΄ μ–΄λ“λ°”μ΄μ €μ ν¬μΈνΈμ»·μ„ μ μ©ν•΄λ³΄λ©΄μ„ ν”„λ΅μ‹ μ μ© λ€μƒμ„ μ„ μ •ν•λ‹¤. (μ„ μ • λ€μƒμ΄λΌλ©΄ ν”„λ΅μ‹λ΅ λ°”κΏ”μΉκΈ°)
- νƒ€κΉƒ λΉμ— μμ΅΄ν•λ‹¤κ³  μ •μν• λ‹¤λ¥Έ λΉλ“¤μ€ ν”„λ΅μ‹ μ¤λΈμ νΈλ¥Ό λ€μ‹  DI λ°›κ² λλ‹¤.

<br/>

```xml
<bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator" />
```
- λ“±λ΅μ„ μ„ν• ν• μ¤„μ΄λ‹¤.
- λ‹¤λ¥Έ λΉμ—μ„ μ°Έμ΅°λκ±°λ‚ μ½”λ“μ—μ„ λΉ μ΄λ¦„μΌλ΅ μ΅°νλ  ν•„μ”κ°€ μ—†λ” λΉμ€ idλ¥Ό λ“±λ΅ν•μ§€ μ•μ•„λ„ λ¬΄λ°©ν•λ‹¤.

<br/>

### ν¬μΈνΈμ»· λ“±λ΅

π”½ ν¬μΈνΈμ»· λΉ
```xml
<bean id=transactionPointcut" class="springbook.service.NameMatchClassMethodPointcut">
  <property name="mappedClassName" value="*ServiceImpl" /> <!-- ν΄λμ¤ μ΄λ¦„ ν¨ν„΄ -->
  <property name="mappedName" value="upgrade*" /> <!-- λ©”μ„λ“ μ΄λ¦„ ν¨ν„΄ -->
</bean>
```
- κΈ°μ΅΄μ ν¬μΈνΈμ»· μ„¤μ •μ„ μ‚­μ ν•κ³  μƒλ΅ λ§λ“  ν΄λμ¤ ν•„ν„° μ§€μ› ν¬μΈνΈμ»·μ„ λΉμΌλ΅ λ“±λ΅ν•λ‹¤.
- ServiceImplλ΅ μ΄λ¦„μ΄ λλ‚λ” ν΄λμ¤μ™€ upgradeλ΅ μ‹μ‘ν•λ” λ©”μ„λ“λ¥Ό μ„ μ •ν•΄μ¤€λ‹¤.

<br/>

### μ–΄λ“λ°”μ΄μ¤μ™€ μ–΄λ“λ°”μ΄μ €
- μ–΄λ“λ°”μ΄μ¤(transactionAdvice)μ™€ μ–΄λ“λ°”μ΄μ €(transactionAdvisor) λΉμ€ μμ •ν•  ν•„μ”λ” μ—†μ§€λ§, μ‚¬μ©λλ” λ°©λ²•μ€ λ°”λ€μ—λ‹¤.
- μ–΄λ“λ°”μ΄μ €λ¥Ό μ΄μ©ν•λ” μλ™ ν”„λ΅μ‹ μƒμ„±κΈ°(DefaultAdvisorAutoProxyCreator)μ— μν•΄ **μλ™μμ§‘**λκ³ , **ν”„λ΅μ‹ λ€μƒ μ„ μ •** κ³Όμ •μ— μ°Έμ—¬ν•λ©°, μλ™μƒμ„±λ ν”„λ΅μ‹μ— **λ‹¤μ΄λ‚΄λ―Ήν•κ² DI**λΌμ„ λ™μ‘ν•λ‹¤.

<br/>

### ProxyFactoryBean μ κ±°μ™€ μ„λΉ„μ¤ λΉμ μ›μƒλ³µκµ¬

π”½ ν”„λ΅μ‹ ν©ν† λ¦¬ λΉμ„ μ κ±°ν• ν›„μ λΉ μ„¤μ •
```xml
<bean id="userService" class="springbook.service.UserServiceImpl">
  <property name="userDao" ref="userDao" />
  <property name="mailSender" ref="mailSender" />
</bean>
```
- λ” μ΄μƒ λ…μ‹μ μΈ ν”„λ΅μ‹ ν©ν† λ¦¬ λΉμ„ λ“±λ΅ν•μ§€ μ•λ”λ‹¤.
- ProxyFactoryBean νƒ€μ…μ λΉμ€ μ‚­μ ν•λ‹¤.
- UserServiceμ™€ κ΄€λ ¨λ λΉ μ„¤μ •μ€ userService ν•λ‚λ΅ μ¶©λ¶„ν•λ‹¤.

<br/>

### μλ™ ν”„λ΅μ‹ μƒμ„±κΈ°λ¥Ό μ‚¬μ©ν•λ” ν…μ¤νΈ

- @Autowiredλ¥Ό ν†µν•΄ μ»¨ν…μ¤νΈμ—μ„ κ°€μ Έμ¤λ” UserService νƒ€μ… μ¤λΈμ νΈλ” νΈλμ­μ…μ΄ μ μ©λ ν”„λ΅μ‹μ΄μ–΄μ•Ό ν•λ‹¤.
- μ΄μ  ν©ν† λ¦¬ λΉμ€ μ΅΄μ¬ν•μ§€ μ•κ³ , ν”„λ΅μ‹ μ¤λΈμ νΈλ§ λ‚¨μ•„μμ„ λΏμ΄λ‹¤.
- κΈ°μ΅΄μ— λ§λ“¤μ—λ κ°•μ  μμ™Έ λ°μƒμ© TestUserService ν΄λμ¤λ¥Ό μ§μ ‘ λΉμΌλ΅ λ“±λ΅ν•΄λ³΄μ.

<br/>

π”½ μμ •ν• ν…μ¤νΈμ© UserService κµ¬ν„ ν΄λμ¤
```java
// ν¬μΈνΈμ»·μ ν΄λμ¤ ν•„ν„°μ— μ„ μ •λλ„λ΅ μ΄λ¦„ λ³€κ²½. μ΄λμ„ μ²μλ¶€ν„° μ΄λ¦„μ„ μ μ§€μ–΄μ•Όν•λ‹¤κ³  ν•λ‹¤.
static class TestUserServiceImpl extends UserServiceImpl {
  private String id = "madnite1"; // ν…μ¤νΈ ν”½μ¤μ²μ users(3)μ id κ°’μ„ κ³ μ •ν•λ‹¤.

  protected void upgradeLevel(User user) {
    if (user.getId().equals(this.id)) throw new TestUserServiceException();
    super.upgradeLevel(user);
  }
}
```
- ν΄λμ¤ μ΄λ¦„μ„ TestUserServiceImplμΌλ΅ λ³€κ²½ν•λ‹¤.
- μμ™Έλ¥Ό λ°μƒμ‹ν‚¬ μ‚¬μ©μ idλ¥Ό ν΄λμ¤ λ‚΄μ— λ„£λ”λ‹¤.

<br/>

π”½ ν…μ¤νΈμ© UserServiceμ λ“±λ΅
```xml
<bean id="testUserService" class="springbook.user.service.UserServiceTest$TestUserServiceImpl" parent="userService" />
```
- `UserServiceTest$TestUserServiceImpl` : μ¤νƒν‹± λ©¤λ²„ ν΄λμ¤λ” $λ΅ μ§€μ •ν•λ‹¤.
- `parent` : ν”„λ΅νΌν‹° μ •μλ¥Ό ν¬ν•¨ν•΄μ„ userService λΉμ μ„¤μ •μ„ μƒμ†λ°›λ”λ‹¤.

<br/>

π”½ testUserService λΉμ„ μ‚¬μ©ν•λ„λ΅ μμ •λ ν…μ¤νΈ
```java
public class UserServiceTest {
  @Autowired UserService userService;
  @Autowired UserService testUserService; // κ°™μ€ νƒ€μ…μ λΉμ΄ 2κ° μ΅΄μ¬ν•κΈ° λ•λ¬Έμ— ν•„λ“ μ΄λ¦„μ„ κΈ°μ¤€μΌλ΅ μ£Όμ…λ  λΉμ΄ κ²°μ •λλ‹¤.
  ...

  @Test
  public void upgradeAllOrNothing() { // μ¤ν”„λ§ μ»¨ν…μ¤νΈμ λΉ μ„¤μ •μ„ λ³€κ²½ν•μ§€ μ•μΌλ―€λ΅ @DirtiesContext μ–΄λ…Έν…μ΄μ…μ€ μ κ±°ν–λ‹¤.
    userDao.deleteAll();
    for(User user : users) userDao.add(user);

    try {
      this.testUserService.upgradeLevels();
      fail("TestUserServiceException expected");
    } catch (TestUserServiceException e) {
    }

    checkLevelUpgraded(users.get(1), false);
  }
}
```
- μλ™ ν”„λ΅μ‹ μƒμ„± λ°©μ‹μΌλ΅ ν…μ¤νΈ μ½”λ‘ κΉ”λ”ν•΄μ΅λ‹¤.
- ν…μ¤νΈ μ½”λ“μ—μ„ μμ™Έμƒν™©μ„ μ μ©ν•κΈ° μ„ν•΄ DIλ¥Ό μ μ©ν•¨μΌλ΅μ¨ μ½”λ“κ°€ λ‹¨μν•΄μ΅λ‹¤.

<br/>

### μλ™μƒμ„± ν”„λ΅μ‹ ν™•μΈ
- λ¬΄μ¨ κΈ°μ μ΄λ“  μλ™μΌλ΅ λ¬΄μ—‡μ„ ν•΄μ¤€λ‹¤κ³  ν•λ©΄ μ •λ§ κ·Έλ°μ§€ ν• λ²μ―¤μ€ μ§μ ‘ ν™•μΈν•΄λ³΄λ” μµκ΄€μ„ λ“¤μ΄μ.
- ν›„μ²λ¦¬κΈ° λ©”μ»¤λ‹μ¦μ„ ν†µν•΄ μ μ©ν•¨μΌλ΅μ¨ μµμ† 2κ°€μ§€λ¥Ό ν™•μΈν•΄μ•Ό ν–λ‹¤.
  - 1οΈβƒ£ νΈλμ­μ…μ΄ ν•„μ”ν• λΉμ— νΈλμ­μ… λ¶€κ°€κΈ°λ¥μ΄ μ μ©λλ”κ°€
  - 2οΈβƒ£ μ•„λ¬΄ λΉμ—λ‚ νΈλμ­μ…μ΄ λ¶€κ°€κΈ°λ¥μ΄ μ μ©λ κ²ƒμ€ μ•„λ‹κ°€
 
<br/>

π”½ ν΄λμ¤ ν•„ν„°μ© μ΄λ¦„μ„ λ³€κ²½ν• ν¬μΈνΈμ»· μ„¤μ •
```xml
<bean id="transactionPointcut" class="springbook.user.service.NameMatchClassMethodPointcut">
  <property name="mappedClassName" value="*NotServiceImpl" />
  <property name="mappedName" value="upgrade*" />
</bean>
```
- ν΄λμ¤ ν•„ν„°μ© μ΄λ¦„ ν¨ν„΄μ„ λ³€κ²½ν•¨μΌλ΅μ¨ Test ν΄λμ¤κ°€ νΈλμ­μ…μ΄ μ μ©λμ§€ μ•λ”μ§€ ν™•μΈν•λ‹¤.
- ν…μ¤νΈ ν›„μ—λ” μ›μƒλ³µκµ¬ ν•λ‹¤.

<br/>

π”½ μλ™μƒμ„±λ ν”„λ΅μ‹ ν™•μΈ
```java
@Test
public void advisorAutoProxyCreator() {
  assertThat(testUserService, is(java.lang.reflect.Proxy.class)); // ν”„λ΅μ‹λ΅ λ³€κ²½λ μ¤λΈμ νΈμΈμ§€ ν™•μΈν•λ‹¤.
}
```
- μ΄λ¥Ό ν†µν•΄ μλ™ ν”„λ΅μ‹ μƒμ„±μ© λΉ ν›„μ²λ¦¬κΈ°(DefaultAdvisorAutoProxyCreator)κ°€ μλ™μΌλ΅ λΉ μ¤λΈμ νΈλ¥Ό ν”„λ΅μ‹ λΉμΌλ΅ λ°”κΏ”μ¤€λ‹¤λ” μ‚¬μ‹¤μ„ μ¶©λ¶„ν μ• μ μλ‹¤.

<br/>

## 6.5.3 ν¬μΈνΈμ»· ν‘ν„μ‹μ„ μ΄μ©ν• ν¬μΈνΈμ»·

- μ¤ν”„λ§μ€ μ•„μ£Ό κ°„λ‹¨ν•κ³  ν¨κ³Όμ μΈ λ°©λ²•μΌλ΅ ν¬μΈνΈμ»·μ ν΄λμ¤μ™€ λ©”μ„λ“λ¥Ό μ„ μ •ν•λ” μ•κ³ λ¦¬μ¦μ„ μ‘μ„±ν•  μ μλ” λ°©λ²•μ„ μ κ³µν•λ‹¤.
- μ •κ·μ‹μ΄λ‚ JSPμ ELκ³Ό λΉ„μ·ν• μΌμΆ…μ ν‘ν„μ‹ μ–Έμ–΄λ¥Ό μ‚¬μ©ν•΄μ„ ν¬μΈνΈμ»·μ„ μ‘μ„±ν•  μ μλ„λ΅ ν•λ‹¤.
- **ν¬μΈνΈμ»· ν‘ν„μ‹**μ΄λΌκ³  λ¶€λ¥Έλ‹¤.

<br/>

### ν¬μΈνΈμ»· ν‘ν„μ‹

- AspectJExpressionPointcut ν΄λμ¤λ¥Ό μ‚¬μ©ν•λ‹¤.
- ν΄λμ¤μ™€ λ©”μ„λ“μ μ„ μ • μ•κ³ λ¦¬μ¦μ„ ν¬μΈνΈμ»· ν‘ν„μ‹μ„ μ΄μ©ν•΄ ν• λ²μ— μ§€μ •ν•  μ μκ² ν•΄μ¤€λ‹¤.
- AspectJλΌλ” ν”„λ μ„μ›ν¬μ—μ„ μ κ³µν•λ” κ²ƒμ„ κ°€μ Έμ™€ ν™•μ¥ν•μ—¬ μ‚¬μ©ν•κΈ° λ•λ¬Έμ— AspectJ ν¬μΈνΈμ»· ν‘ν„μ‹μ΄λΌκ³ λ„ ν•λ‹¤.

<br/>

π”½ ν¬μΈνΈμ»· ν…μ¤νΈμ© ν΄λμ¤
```java
package springbook.learningtest.spring.pointcut;
...
public class Target implements TargetInterface {
  public void hello() {}
  public void hello(String a) {}
  public int minus(int a, int b) throws RuntimeException { return 0; }
  public int plus(int a, int b) { return 0; }
  public void method() {}
}
```
- ν¬μΈνΈμ»·μ μ„ μ • ν›„λ³΄κ°€ λ  μ—¬λ¬ κ°μ λ©”μ„λ“λ¥Ό κ°€μ§„ ν΄λμ¤μ΄λ‹¤.
- 4κ°λ” TargetInterface μΈν„°νμ΄μ¤μ— μ •μλ λ©”μ„λ“λ¥Ό κµ¬ν„ν• κ²ƒμ΄κ³ , λ§μ§€λ§‰ λ©”μ„λ“λ” Target ν΄λμ¤μ—μ„ μ •μν• κ²ƒμ΄λ‹¤.

<br/>

π”½ ν¬μΈνΈμ»· ν…μ¤νΈμ© μ¶”κ°€ ν΄λμ¤
```java
package springbook.learningtest.spring.pointcut;

public class Bean {
  public void method() throws RuntimeException {
  }
}
```
- μ—¬λ¬ κ°μ ν΄λμ¤ μ„ μ • κΈ°λ¥μ„ ν™•μΈν•΄λ³΄κΈ° μ„ν• ν΄λμ¤μ΄λ‹¤.
- μ΄μ  2κ°μ ν΄λμ¤μ™€ μ΄ 6κ°μ λ©”μ„λ“λ¥Ό λ€μƒμΌλ΅ ν¬μΈνΈμ»· ν‘ν„μ‹μ„ μ μ©ν•΄λ³Έλ‹¤.

<br/>

### ν¬μΈνΈμ»· ν‘ν„μ‹ λ¬Έλ²•
- ν¬μΈνΈμ»· μ§€μ‹μλ¥Ό μ΄μ©ν•΄ μ‘μ„±ν•λ‹¤. (execution()μ΄ κ°€μ¥ λ€ν‘μ μΈ κ²ƒ)
- κΈ°λ³Έμ μΌλ΅ `[]` κ΄„νΈλ” μµμ…ν•­λ©μ΄κΈ° λ•λ¬Έμ— μƒλµ κ°€λ¥ν•λ©°, |λ” OR μ΅°κ±΄μ΄λΌλ” λ»μ΄λ‹¤.

<br/>

```
execution([μ ‘κ·Όμ ν•μ ν¨ν„΄] νƒ€μ…ν¨ν„΄ [νƒ€μ…ν¨ν„΄.]μ΄λ¦„ν¨ν„΄ (νƒ€μ…ν¨ν„΄ | "...", ...) [throws μμ™Έ ν¨ν„΄])
```
- `[μ ‘κ·Όμ ν•μ ν¨ν„΄]` : public, privateκ³Ό κ°™μ€ μ ‘κ·Όμ ν•μ, μƒλµ κ°€λ¥
- `νƒ€μ…ν¨ν„΄` : λ¦¬ν„΄ κ°’μ νƒ€μ… ν¨ν„΄
- `[νƒ€μ…ν¨ν„΄.]` : ν¨ν‚¤μ§€μ™€ ν΄λμ¤ μ΄λ¦„μ— λ€ν• ν¨ν„΄, μƒλµ κ°€λ¥, μ‚¬μ©ν•  λ•λ” '.'μ„ λ‘μ–΄ μ—°κ²°ν•΄μ•Ό ν•¨
- `μ΄λ¦„ν¨ν„΄` : λ©”μ„λ“ μ΄λ¦„ ν¨ν„΄
- `(νƒ€μ…ν¨ν„΄ | "...", ...)` : νλΌλ―Έν„°μ νƒ€μ… ν¨ν„΄μ„ μμ„λ€λ΅ λ„£μ„ μ μμ, μ™€μΌλ“μΉ΄λ“λ¥Ό μ΄μ©ν•΄ νλΌλ―Έν„° κ°μμ— μƒκ΄€μ—†λ” ν¨ν„΄λ„ κ°€λ¥
- `μμ™Έ ν¨ν„΄` : μμ™Έ μ΄λ¦„ ν¨ν„΄

<br/>

```java
System.out.printlnl(Target.class.getMethod("minus", int.class, int.class));
```
- λ¬Έμ¥μ„ μ‹¤ν–‰ν•λ©΄ λ¦¬ν”λ ‰μ…μ Method μ¤λΈμ νΈκ°€ μ κ³µν•λ” Target.minus() λ©”μ„λ“μ ν’€ μ‹κ·Έλ‹μ²λ¥Ό λ³Ό μ μλ‹¤.
- μ¶λ ¥ κ²°κ³Όλ” μ•„λμ™€ κ°™λ‹¤.

<br/>

```java
public int springbook.learningtest.spring.pointcut.Target.minus(int, int) throws java.lang.RuntimeException
```
- `public` : μ ‘κ·Όμ ν•μ, ν‘ν„μ‹μ—μ„ μƒλµ κ°€λ¥(μ΅°κ±΄ λ¶€μ—¬X)
- `int` : λ¦¬ν„΄ κ°’μ νƒ€μ…, ν•„μν•­λ© (λ°λ“μ‹ ν•λ‚μ νƒ€μ… μ§€μ • ν•„μ” or *λ¥Ό μ¨μ„ λ¨λ“  νƒ€μ… μ„ νƒλ„ κ°€λ¥)
- `springbook.learningtest.spring.pointcut.Target` : ν¨ν‚¤μ§€μ™€ νƒ€μ… μ΄λ¦„μ„ ν¬ν•¨ν• ν΄λμ¤μ νƒ€μ… ν¨ν„΄, μƒλµ κ°€λ¥(λ¨λ“  νƒ€μ… ν—μ©), * μ‚¬μ© κ°€λ¥, '..'λ¥Ό μ‚¬μ©ν•λ©΄ ν• λ²μ— μ—¬λ¬ κ°μ ν¨ν‚¤μ§€ μ„ νƒ κ°€λ¥
- `minus` : λ©”μ„λ“ μ΄λ¦„ ν¨ν„΄, ν•„μν•­λ©, λ¨λ“  λ©”μ„λ“λ¥Ό λ‹¤ μ„ νƒν•λ ¤λ©΄ *
- `(int, int)` : λ©”μ„λ“ νλΌλ―Έν„°μ νƒ€μ… ν¨ν„΄, '.'λ΅ κµ¬λ¶„ν•λ©΄μ„ μμ„λ€λ΅ κΈ°μ¬, νλΌλ―Έν„° μ—†μΌλ©΄ (), λ¨λ‘ λ‹¤ ν—μ©ν•λ ¤λ©΄ '..', '..'λ¥Ό μ΄μ©ν•΄μ„ λ’·λ¶€λ¶„μ νλΌλ―Έν„° μ΅°κ±΄λ§ μƒλµ κ°€λ¥, ν•„μν•­λ©
- `throws java.lang.RuntimeException` : μμ™Έ μ΄λ¦„μ— λ€ν• νƒ€μ… ν¨ν„΄, μƒλµ κ°€λ¥

<br/>

π”½ λ©”μ„λ“ μ‹κ·Έλ‹μ²λ¥Ό μ΄μ©ν• ν¬μΈνΈμ»· ν‘ν„μ‹ ν…μ¤νΈ
```java
@Test
public void methodSignaturePointcut() throws SecurityException, NoSuchMethodException {
  AspectJExpressionPointcut pointcut = new AspectJExpressionPointcut();
  pointcut.setExpression("execution(public int springbook.learningtest.spring.pointcut.Target.minus(int, int) throws java.lang.RuntimeException)); // Target ν΄λμ¤ minus() λ©”μ„λ“ μ‹κ·Έλ‹μ²

  // Target.minus()
  assertThat(pointcut.getClassFilter().matches(Target.class) && pointcut.getMethodMatcher().matches(Target.class.getMethod("minus", int.class. int.class), null), is(true)); // ν¬μΈνΈμ»· ν†µκ³Ό

  // Target.plus()
  assertThat(pointcut.getClassFilter().matches(Target.class) && pointcut.getMethodMatcher().matches(Target.class.getMethod("plus", int.class. int.class), null), is(false)); // λ©”μ„λ“ λ§¤μ²μ—μ„ μ‹¤ν¨

  // Bean.method()
  assertThat(pointcut.getClassFilter().matches(Bean.class) && pointcut.getMethodMatcher().matches(Target.class.getMethod("method"), null), is(false)); // ν΄λμ¤ ν•„ν„°μ—μ„ μ‹¤ν¨
}
```
- AspectJExpressionPointcut ν΄λμ¤μ μ¤λΈμ νΈλ¥Ό λ§λ“¤κ³  ν¬μΈνΈμ»· ν‘ν„μ‹μ„ execution ν”„λ΅νΌν‹°μ— λ„£μ–΄μ£Όλ©΄ ν¬μΈνΈμ»·μ„ μ‚¬μ©ν•  μ¤€λΉ„κ°€ λλ‹¤.
- execution()μ€ λ©”μ„λ“ μ‹¤ν–‰μ— λ€ν• ν¬μΈνΈμ»·μ΄λ‹¤.
- Target.minus() : 2κ°€μ§€ μ΅°κ±΄μ„ λ¨λ‘ λ§μ΅±ν•λ―€λ΅ true
- Target.plus() : λ©”μ„λ“ μ΄λ¦„, μμ™Έ ν¨ν„΄μ΄ ν‘ν„μ‹κ³Ό μΌμΉν•μ§€ μ•μ•„ false
- Bean.class : ν΄λμ¤λ¶€ν„° μΌμΉν•μ§€ μ•μ•„ false

<br/>

### ν¬μΈνΈμ»· ν‘ν„μ‹ ν…μ¤νΈ

```java
execution(int minus(int, int)) // int νƒ€μ…μ λ¦¬ν„΄ κ°’, minusλΌλ” λ©”μ„λ“ μ΄λ¦„, 2κ°μ int νλΌλ―Έν„°λ¥Ό κ°€μ§„ λ¨λ“  λ©”μ„λ“λ¥Ό μ„ μ •
```
- μµμ… ν•­λ©μ„ μ κ±°ν•¨μΌλ΅μ¨ μ½”λ“κ°€ κ°„κ²°ν•΄μ΅λ‹¤.
- μƒλµν• λ¶€λ¶„μ€ λ¨λ“  κ²½μ°λ¥Ό λ‹¤ ν—μ©ν•λ‹¤.

<br/>

```java
execution(* minus(int, int)) // λ¦¬ν„΄ νƒ€μ…μ€ μƒκ΄€μ—†μ΄ minusλΌλ” λ©”μ„λ“ μ΄λ¦„, 2κ°μ int νλΌλ―Έν„°λ¥Ό κ°€μ§„ λ¨λ“  λ©”μ„λ“λ¥Ό μ„ μ •
```
- μ–΄λ–¤ λ¦¬ν„΄ νƒ€μ…μ΄λ“  μƒκ΄€μ—†κ² μ§€μ •ν•λ ¤λ©΄ μ™€μΌλ“μΉ΄λ“(*)λ¥Ό μ‚¬μ©ν•λ‹¤.

<br/>

```java
execution(* minus(..)) // λ¦¬ν„΄ νƒ€μ…κ³Ό νλΌλ―Έν„°μ μΆ…λ¥, κ°μμ— μƒκ΄€μ—†μ΄ minus λ©”μ„λ“ μ΄λ¦„μ„ κ°€μ§„ λ¨λ“  λ©”μ„λ“λ¥Ό μ„ μ •
```
- νλΌλ―Έν„°μ κ°μμ™€ νƒ€μ… λ¬΄μ‹

<br/>

```java
execution(* *(..)) // λ¦¬ν„΄ νƒ€μ…, νλΌλ―Έν„°, λ©”μ„λ“ μ΄λ¦„μ— μƒκ΄€μ—†μ΄ λ¨λ“  λ©”μ„λ“ μ΅°κ±΄μ„ ν—μ©ν•λ” ν¬ν„μ‹
```
- λ¨λ“  μ„ μ •μ΅°κ±΄ μ κ±° (λ¨λ“  λ©”μ„λ“ ν—μ©)

<br/>

π”½ ν¬μΈνΈμ»·κ³Ό λ©”μ„λ“λ¥Ό λΉ„κµν•΄μ£Όλ” ν…μ¤νΈ ν—¬νΌ λ©”μ„λ“
```java
public void pointcutMatches(String expression, Boolean expected, Class<?> clazz, String methodName, Class<?>... args) throws Exception {
  AspectJExpressionPointcut pointcut = new AspectJExpressionPointcut();
  pointcut.setExpression(expression);

  assertThat(pointcut.getClassFilter().matches(clazz) && pointcut.getMethodMatcher().matches(clazz.getMethod(methodName, args), null), is(expected));
}
```
- ν¬μΈνΈμ»·μ ν΄λμ¤ ν•„ν„°μ™€ λ©”μ„λ“ λ§¤μ² 2κ°€μ§€λ¥Ό λ™μ‹μ— λ§μ΅±ν•λ”μ§€ ν™•μΈν•λ‹¤.
- λ©”μ„λ“λ¥Ό μ§€μ •ν•λ ¤λ©΄ ν΄λμ¤μ™€ λ©”μ„λ“ μ΄λ¦„, λ©”μ„λ“ νλΌλ―Έν„° νƒ€μ… μ •λ³΄κ°€ ν•„μ”ν•λ‹¤.

<br/>

π”½ νƒ€κΉƒ ν΄λμ¤μ λ©”μ„λ“ 6κ°μ— λ€ν•΄ ν¬μΈνΈμ»· μ„ μ • μ—¬λ¶€λ¥Ό κ²€μ‚¬ν•λ” ν—¬νΌ λ©”μ„λ“
```java
public void targetClassPointcutMatches(String expression, boolean... expected) throws Exception {
  pointcutMatches(expression, expected[0], Target.class, "hello");
  pointcutMatches(expression, expected[1], Target.class, "hello", String.class);
  pointcutMatches(expression, expected[2], Target.class, "plus", int.class, int.class);
  pointcutMatches(expression, expected[3], Target.class, "minus", int.class, int.class);
  pointcutMatches(expression, expected[4], Target.class, "method");
  pointcutMatches(expression, expected[5], Boolean.class, "method");
}
```
- ν¬μΈνΈμ»· μ„ μ • μ—¬λ¶€λ¥Ό ν™•μΈν•λ‹¤.
- ν‘ν„μ‹κ³Ό 6κ°μ λ©”μ„λ“μ— λ€ν• μμƒ κ²°κ³Όλ¥Ό μ£Όλ©΄ μ΄λ¥Ό κ²€μ¦ν•λ‹¤.

<br/>

π”½ ν¬μΈνΈμ»· ν‘ν„μ‹ ν…μ¤νΈ
```java
@Test
public void pointcut() throws Exception {
  targetClassPointcutMatches("execution(* *(..))", true, true, true, true, true, true);
  // λ‚λ¨Έμ§€λ” μƒλµ - μ•„λ ν‘μ λ‚΄μ©κ³Ό λ™μΌν•λ‹¤.
}
```
- ν¬μΈνΈμ»·μ„ ν†µν•΄ λ¨λ“  λ©”μ„λ“μ— λ€ν• ν¬μΈνΈμ»· μ μ© κ²°κ³Όλ¥Ό ν™•μΈν•λ‹¤.

<br/>

π”½ AspectJ ν¬μΈνΈμ»· ν‘ν„μ‹μ λ©”μ„λ“ μ„ μ • κ²°κ³Ό

<img width="350" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/8641c955-b6d3-4493-aacc-f1d8db1bf36b">

<br/>

- 1λ²: helloλΌλ” μ΄λ¦„μ„ κ°€μ§„ λ©”μ„λ“λ¥Ό μ„ μ •ν•λ” κ²ƒ
- 2λ²: νλΌλ―Έν„° ν¨ν„΄μ΄ ()λ΅ λμ–΄μμΌλ―€λ΅ hello λ©”μ„λ“ μ¤‘ νλΌλ―Έν„°κ°€ μ—†λ” κ²ƒ
- 3λ²: νλΌλ―Έν„°μ κ°μκ°€ 1κ°μ΄λ©° Stirng νƒ€μ…μΈ κ²ƒ
- 4λ²: λ©”μ„λ“ μ΄λ¦„μ— μ™€μΌλ“μΉ΄λ“λ¥Ό μ‚¬μ©ν•μ—¬, methλ΅ μ‹μ‘ν•λ” λ¨λ“  ν΄λμ¤μ λ©”μ„λ“λ¥Ό ν—μ©
- 5λ²: νλΌλ―Έν„° νƒ€μ…λ§μΌλ΅ μ„ μ •
- 6λ²: νλΌλ―Έν„°κ°€ μ—†λ” λ¨λ“  λ©”μ„λ“λ¥Ό μ„ νƒ
- 7-9λ²: ν¨ν‚¤μ§€μ™€ ν΄λμ¤ νƒ€μ… ν¨ν„΄μ„ μ‚¬μ©
  - 7λ². ν΄λμ¤ μ§μ ‘ μ§€μ •
  - 8λ². ν΄λμ¤ μ΄λ¦„μ— μ™€μΌλ“ μΉ΄λ“λ¥Ό μ μ©ν•μ—¬ ν•΄λ‹Ή ν¨ν‚¤μ§€μ λ¨λ“  λ©”μ„λ“ μ„ μ •
  - 9λ². '..'λ¥Ό μ‚¬μ©ν•μ—¬ μ„λΈν¨ν‚¤μ§€μ λ¨λ“  ν΄λμ¤κΉμ§€ ν¬ν•¨
- 10λ². νΉμ • ν¨ν‚¤μ§€μ λ¨λ“  μ„λΈν¨ν‚¤μ§€ μ§€μ •
- 11λ². comμΌλ΅ μ‹μ‘ν•λ” ν¨ν‚¤μ§€ μ„ μ •
- 12λ². ν¨ν‚¤μ§€μ— μƒκ΄€μ—†μ΄ Targetμ΄λΌλ” μ΄λ¦„μ λ¨λ“  ν΄λμ¤μ— μ μ©
- 13-15λ². ν΄λμ¤ μ΄λ¦„μ— μ™€μΌλ“μΉ΄λ“ λ¶€μ—¬
- 16λ². Target ν΄λμ¤κ°€ κµ¬ν„ν• TargetInterface μΈν„°νμ΄μ¤λ¥Ό μ„ μ •μ΅°κ±΄μΌλ΅ μ„¤μ •
- 17λ². λ©”μ„λ“&ν΄λμ¤μ™€ μƒκ΄€μ—†μ΄ μμ™Έ μ„ μ–Έλ§ ν™•μΈν•΄μ„ λ©”μ„λ“ μ„ μ •
- 18-19λ². λ¦¬ν„΄ νƒ€μ…μ„ μ΄μ©ν•΄ λ©”μ„λ“ μ„ μ •

<br/>

### ν¬μΈνΈμ»· ν‘ν„μ‹μ„ μ΄μ©ν•λ” ν¬μΈνΈμ»· μ μ©
- μ¤ν”„λ§μ—μ„ μ‚¬μ©λ  λ• μ΄λ¦„μΌλ΅ λΉ„κµν•λ” bean()μ΄ μλ‹¤.
- bean(*Service)λΌκ³  μ“°λ©΄ idκ°€ Serviceλ΅ λλ‚λ” λ¨λ“  λΉμ„ μ„ μ •ν•λ‹¤.
- μ–΄λ…Έν…μ΄μ… μ μ© κΈ°μ¤€μ— λ”°λ¥Έ ν¬μΈνΈμ»·λ„ λ§λ“¤ μ μλ‹¤.

<br/>

```java
@annotation(org.springframework.transaction.annotation.Transactional)
```
- @Transactionalμ΄λΌλ” μ–΄λ…Έν…μ΄μ…μ΄ μ μ©λ λ©”μ„λ“λ¥Ό μ„ μ •ν•λ‹¤.

<br/>

- μ•μ—μ„ λ§λ“  transactionPointcut λΉμ€ μ κ±°ν•λ‹¤.
- μ§μ ‘ λ§λ“  ν¬μΈνΈμ»· κµ¬ν„ ν΄λμ¤(NameMatchClassMethodPointcut)λ¥Ό μ‚¬μ©ν•λ” μΌμ€ μ—†μ„ κ²ƒμ΄λ‹¤.

<br/>

π”½ ν¬μΈνΈμ»· ν‘ν„μ‹μ„ μ‚¬μ©ν• λΉ μ„¤μ •
```xml
<bean id="transactionPointcut" class="org.springframework.aop.aspectj.AspectJExpressionPointcut">
  <property name="expression" value="execution(* *..*ServiceImpl.upgrade*(..))" />
</bean>
```
- AspectJExpressionPointcut λΉμ„ λ“±λ΅ν•κ³  expression ν”„λ΅νΌν‹°λ¥Ό λ„£μ–΄μ¤€λ‹¤.
- ν΄λμ¤ μ΄λ¦„μ€ ServiceImplλ΅ λλ‚κ³  λ©”μ„λ“ μ΄λ¦„μ€ upgradeλ΅ μ‹μ‘ν•λ” λ¨λ“  ν΄λμ¤μ— μ μ©λλ„λ΅ ν•λ” ν‘ν„μ‹μ„ λ§λ“¤μ–΄ μ„¤μ •ν•λ‹¤.

<br/>

### νƒ€μ… ν¨ν„΄κ³Ό ν΄λμ¤ μ΄λ¦„ ν¨ν„΄
- TestUserServiceImpl ν΄λμ¤λ¥Ό λ‹¤μ‹ TestServiceλ΅ λ³€κ²½ν•΄λ„ ν…μ¤νΈλ” ν†µκ³Όν•λ‹¤.
- ν¬μΈνΈμ»· ν‘ν„μ‹μ ν΄λμ¤ μ΄λ¦„μ— μ μ©λλ” ν¨ν„΄μ€ νƒ€μ… ν¨ν„΄μ΄κΈ° λ•λ¬Έμ΄λ‹¤.
- ν¬μΈνΈμ»· ν‘ν„μ‹μ νƒ€μ… ν¨ν„΄ ν•­λ©μ„ *..UserServiceλΌκ³  μ§μ ‘ μΈν„°νμ΄μ¤ μ΄λ¦„μ„ λ…μ‹ν•΄λ„ 2κ° λΉμ΄ λ¨λ‘ μ„ μ •λλ‹¤. (2κ° ν΄λμ¤ λ¨λ‘ UserService μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„)
- ν¬μΈνΈμ»· ν‘ν„μ‹μ νƒ€μ… ν¨ν„΄μ€ *..*ServiceImplμ΄λΌκ³  λ‚¨κ²¨λ‘”λ‹¤.
- ν¬μΈνΈμ»· ν‘ν„μ‹μ—μ„ νƒ€μ… ν¨ν„΄μ΄λΌκ³  λ…μ‹λ λ¶€λ¶„μ€ λ¨λ‘ λ™μΌν• μ›λ¦¬κ°€ μ μ©λλ‹¤λ” μ μ„ κΈ°μ–µν•μ.

<br/>


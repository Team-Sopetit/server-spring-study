## 6.1. νΈλμ­μ… μ½”λ“μ λ¶„λ¦¬
- νΈλμ­μ… κ²½κ³„μ„¤μ •μ„ μ„ν•΄ λ„£μ€ μ½”λ“κ°€ μ°μ°ν•λ‹¤.
- λΉ„μ¦λ‹μ¤ λ΅μ§μ΄ μ£ΌμΈμ΄μ–΄μ•Ό ν•  λ©”μ†λ“ μ•μ— νΈλμ­μ… μ½”λ“κ°€ λ” λ§μ€ μλ¦¬λ¥Ό μ°¨μ§€ν•κ³  μλ‹¤.

<br/>

### 6.1.1 λ©”μ†λ“ λ¶„λ¦¬

π”½ νΈλμ­μ… κ²½κ³„μ„¤μ •κ³Ό λΉ„μ¦λ‹μ¤ λ΅μ§μ΄ κ³µμ΅΄ν•λ” λ©”μ†λ“
```java
public void upgradeLevels() throws Exception {
  // νΈλμ­μ… κ²½κ³„μ„¤μ •
  TransactionStatus status = this.transactionManager.getTransaction(new DefaultTransactionDefinition());
  try {

    // λΉ„μ¦λ‹μ¤ λ΅μ§
    List<User> users = userDao.getAll();
    for (User user : users) {
      if (canUpgradeLevel(user)) {
        upgradeLevel(user);
      }
    }

    // νΈλμ­μ… κ²½κ³„μ„¤μ •
    this.transactionManager.commit(status);
  } catch (Exception e) {
    this.transactionManager.rollback(status);
    throw e;
  }
}
```
- νΈλμ­μ… κ²½κ³„μ„¤μ • μ½”λ“μ™€ λΉ„μ¦λ‹μ¤, **2κ°€μ§€ μΆ…λ¥μ μ½”λ“κ°€ λλ ·ν•κ² κµ¬λ¶„**λμ–΄ μλ‹¤.
- λΉ„μ¦λ‹μ¤ λ΅μ§ μ½”λ“λ¥Ό μ‚¬μ΄μ— λ‘κ³  νΈλμ­μ… μ‹μ‘κ³Ό μΆ…λ£λ¥Ό λ‹΄λ‹Ήν•λ” μ½”λ“κ°€ μ•λ’¤μ— μ„μΉν•κ³  μλ‹¤.
- νΈλμ­μ… κ²½κ³„μ„¤μ •μ μ½”λ“μ™€ λΉ„μ¦λ‹μ¤ λ΅μ§ μ½”λ“ κ°„μ— **μ„λ΅ μ£Όκ³ λ°›λ” μ •λ³΄κ°€ μ—†λ‹¤.**

<br/>

π”½ λΉ„μ¦λ‹μ¤ λ΅μ§κ³Ό νΈλμ­μ… κ²½κ³„μ„¤μ •μ λ¶„λ¦¬
```java
public void upgradeLevels() throws Exception {
  TransactionStatus status = this.transactionManager.getTransaction(new DefaultTransactionDefinition());
  try {
    upgradeLevelsInternal();
    this.transactionManager.commit(status);
  } catch (Exception e) {
    this.transactionManager.rollback(status);
    throw e;
  }
}

// λ¶„λ¦¬λ λΉ„μ¦λ‹μ¤ λ΅μ§ μ½”λ“
// νΈλμ­μ…μ„ μ μ©ν•κΈ° μ „κ³Ό λ™μΌν•λ‹¤.
private void upgradeLevelsInternal() {
  List<User> users = userDao.getAll();
  for (User user : users) {
    if (canUpgradeLevel(user)) {
      upgradeLevel(user);
    }
  }
}
```
- λΉ„μ¦λ‹μ¤ λ΅μ§μ„ λ‹΄λ‹Ήν•λ” μ½”λ“λ¥Ό λ©”μ†λ“λ΅ μ¶”μ¶ν•΄μ„ λ…λ¦½μ‹μΌ°λ‹¤.

<br/>

### 6.1.2 DIλ¥Ό μ΄μ©ν• ν΄λμ¤μ λ¶„λ¦¬
- μ—¬μ „ν νΈλμ­μ…μ„ λ‹΄λ‹Ήν•λ” κΈ°μ μ μΈ μ½”λ“κ°€ λ²„μ “μ΄ UserService μ•μ— μλ¦¬ μ΅κ³  μλ‹¤.
- κ°„λ‹¨ν•κ² νΈλμ­μ… μ½”λ“λ¥Ό ν΄λμ¤ λ°–μΌλ΅ λ½‘μ•„λ‚΄λ³΄μ.

<br/>

> ***DI μ μ©μ„ μ΄μ©ν• νΈλμ­μ… λ¶„λ¦¬***

- DIμ κΈ°λ³Έ μ•„μ΄λ””μ–΄λ” μ‹¤μ  μ‚¬μ©ν•  μ¤λΈμ νΈμ ν΄λμ¤ μ •μ²΄λ” κ°μ¶ μ±„ μΈν„°νμ΄μ¤λ¥Ό ν†µν•΄ κ°„μ ‘μΌλ΅ μ ‘κ·Όν•λ” κ²ƒμ΄λ‹¤.

<br/>

π”½ UserService ν΄λμ¤μ™€ ν΄λΌμ΄μ–ΈνΈμ μ§μ ‘ μ—°κ²°μ„ ν†µν• κ°•ν• κ²°ν•© <br/>
<img width="482" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/d43191f8-4e0b-4b5e-a7fc-879ed1a655a2">

- UserService ν΄λμ¤μ™€ κ·Έ μ‚¬μ© ν΄λΌμ΄μ–ΈνΈ κ°„μ κ΄€κ³„κ°€ κ°•ν• κ²°ν•©λ„λ΅ κ³ μ •λμ–΄ μλ‹¤.

<br/>

π”½ UserService μΈν„°νμ΄μ¤ λ„μ…μ„ ν†µν•΄ μ•½ν• κ²°ν•©μ„ κ°–λ” μ μ—°ν• κµ¬μ΅° <br/>
<img width="430" alt="image" src="https://github.com/Team-Sopetit/server-spring-study/assets/55437339/8f8aa557-4361-4718-aa83-39fb9d7a62d7">

- UserServiceλ¥Ό μΈν„°νμ΄μ¤λ΅ λ§λ“¤κ³  κΈ°μ΅΄ μ½”λ“λ” UserService μΈν„°νμ΄μ¤μ κµ¬ν„ ν΄λμ¤λ¥Ό λ§λ“¤μ–΄λ„£λ„λ΅ ν•λ‹¤.
- μ§μ ‘ κµ¬ν„ ν΄λμ¤μ— μμ΅΄ν•κ³  μμ§€ μ•κΈ° λ•λ¬Έμ— **μ μ—°ν• ν™•μ¥**μ΄ κ°€λ¥ν•΄μ§„λ‹¤.
- μΈν„°νμ΄μ¤λ¥Ό μ΄μ©ν•΄ ν΄λΌμ΄μ–ΈνΈμ™€ UserService κµ¬ν„ ν΄λμ¤μ μ§μ ‘ κ²°ν•©μ„ λ§‰μ•„μ£Όκ³ , μ μ—°ν• ν™•μ¥μ΄ κ°€λ¥ν•κ² λ§λ“ λ‹¤.
- ν• λ²μ— ν• κ°€μ§€ ν΄λμ¤λ¥Ό μ„ νƒν•΄μ„ μ μ©ν•λ„λ΅ λμ–΄ μλ‹¤.

<br/>

**ν• λ²μ— 2κ°μ UserService μΈν„°νμ΄μ¤ κµ¬ν„ ν΄λμ¤λ¥Ό λ™μ‹μ— μ΄μ©ν•λ‹¤λ©΄ μ–΄λ–¨κΉ?**
- μ§€κΈ ν•΄κ²°ν•λ ¤κ³  ν•λ” λ¬Έμ λ” UserServiceμ—λ” μμν•κ² λΉ„μ¦λ‹μ¤ λ΅μ§μ„ λ‹΄κ³  μλ” μ½”λ“λ§ λ†”λ‘κ³  νΈλμ­μ… κ²½κ³„μ„¤μ •μ„ λ‹΄λ‹Ήν•λ” μ½”λ“λ¥Ό μ™Έλ¶€λ΅ λΉΌλ‚΄λ ¤λ” κ²ƒμ΄λ‹¤.
- ν•μ§€λ§ ν΄λΌμ΄μ–ΈνΈκ°€ UserServiceμ κΈ°λ¥μ„ μ λ€λ΅ μ΄μ©ν•λ ¤λ©΄ νΈλμ­μ…μ΄ μ μ©λΌμ•Ό ν•λ‹¤.

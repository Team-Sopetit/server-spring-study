# 6.7 μ–΄λ…Έν…μ΄μ… νΈλμ­μ… μ†μ„±κ³Ό ν¬μΈνΈμ»·
- μ„Έλ°€ν• νΈλμ­μ… μ†μ„±μ μ μ–΄κ°€ ν•„μ”ν• κ²½μ°λ¥Ό μ„ν•΄ μ¤ν”„λ§μ΄ μ κ³µν•λ” λ°©λ²•μ΄ μλ‹¤.
- μ§μ ‘ νƒ€κΉƒμ— νΈλμ­μ… μ†μ„±μ •λ³΄λ¥Ό κ°€μ§„ μ–΄λ…Έν…μ΄μ…μ„ μ§€μ •ν•λ” λ°©λ²•μ΄λ‹¤.

<br/>

## 6.7.1 νΈλμ­μ… μ–΄λ…Έν…μ΄μ…
- ν•„μ”μ— λ”°λΌ μ–΄λ…Έν…μ΄μ… μ •μλ¥Ό μ½κ³  κ·Έ λ‚΄μ©/νΉμ§•μ„ μ΄ν•΄ν•  μ μλ„λ΅ μ£Όμ” λ©”νƒ€ μ–΄λ…Έν…μ΄μ…μ„ μ•κ³  μμ–΄μ•Ό ν•λ‹¤.

<br/>

### @Transactional

```java
package org.springframework.transaction.annotation;
...
@Target({ElementType.METHOD, ElementType.TYPE}) // μ–΄λ…Έν…μ΄μ… μ‚¬μ© λ€μƒ μ§€μ •, 1κ° μ΄μƒμ λ€μƒ μ§€μ • κ°€λ¥
@Retention(RetentionPolicy.RUNTIME) // μ–΄λ…Έν…μ΄μ… μ μ§€ λ²”μ„ μ§€μ •, λ°νƒ€μ„ λ•λ„ λ¦¬ν”λ ‰μ…μ„ ν†µν•΄ μ •λ³΄ μ–»κΈ° κ°€λ¥
@Inherited // μƒμ†μ„ ν†µν•΄ μ–΄λ…Έν…μ΄μ… μ •λ³΄ μ–»κΈ° κ°€λ¥
@Documented
public @interface Transactional { // νΈλμ­μ… μ†μ„±μ λ¨λ“  ν•­λ©μ„ elementλ΅ μ§€μ •ν•  μ μλ‹¤. default κ°’μ΄ μ„¤μ •λμ–΄ μμ–΄ λ¨λ‘ μƒλµ κ°€λ¥ν•λ‹¤.
  String value() default "";
  Propagation propagation() default Propagation.REQUIRED;
  Isolation isolation() default Isolation.DEFAULT;
  int timeout() default TransactionDefinition.TIMEOUT_DEFAULT;
  boolean readOnly() default false;
  Class<? extends Throwable>[] rollbackFor() default {};
  String[] rollbackForClassName() default {};
  Class<? extends Throwable>[] noRollbackFor() default {};
  String[] noRollbackForClassName() default {};
}
```
π”Ό @Transaction μ–΄λ…Έν…μ΄μ…
- νƒ€κΉƒ: λ©”μ„λ“, νƒ€μ… (λ©”μ„λ“, ν΄λμ¤, μΈν„°νμ΄μ¤μ— μ‚¬μ© κ°€λ¥)
- μ¤ν”„λ§μ€ @Transactionalμ΄ λ¶€μ—¬λ λ¨λ“  μ¤λΈμ νΈλ¥Ό μλ™μΌλ΅ νƒ€κΉƒ μ¤λΈμ νΈλ΅ μΈμ‹ν•λ‹¤.
- λ¶€μ—¬λ λΉ μ¤λΈμ νΈλ¥Ό λ¨λ‘ μ°Ύμ•„μ„ ν¬μΈνΈμ»·μ μ„ μ • κ²°κ³Όλ΅ λλ ¤μ¤€λ‹¤.
- κΈ°λ³Έμ μΌλ΅ νΈλμ­μ… μ†μ„±μ„ μ •μν•λ©΄μ„, λ™μ‹μ— ν¬μΈνΈμ»·μ μλ™ λ“±λ΅μ—λ„ μ‚¬μ©λλ‹¤.

<br/>

### νΈλμ­μ… μ†μ„±μ„ μ΄μ©ν•λ” ν¬μΈνΈμ»·

![image](https://github.com/Team-Sopetit/server-spring-study/assets/55437339/02db22fd-972a-4ef0-bdda-a6d104056dec)

- μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν–μ„ λ• μ–΄λ“λ°”μ΄μ €μ λ™μ‘ λ°©μ‹
- TransactionInterceptorλ” μ–΄λ…Έν…μ΄μ…μ elementμ—μ„ νΈλμ­μ… μ†μ„±μ„ κ°€μ Έμ¤λ” AnnotationTransactionAttributeSourceλ¥Ό μ‚¬μ©ν•λ‹¤.
- λ©”μ„λ“λ§λ‹¤ λ‹¤λ¥΄κ² μ„¤μ •ν•  μ μμ–΄ μ μ—°ν• νΈλμ­μ… μ†μ„± μ„¤μ •μ΄ κ°€λ¥ν•λ‹¤.
- ν¬μΈνΈμ»·λ„ @Transactionalμ„ ν†µν• νΈλμ­μ… μ†μ„±μ •λ³΄λ¥Ό μ°Έμ΅°ν•λ„λ΅ ν•λ‹¤. (ν¬μΈνΈμ»·μ μ„ μ • λ€μƒ)
- νΈλμ­μ… λ¶€κ°€κΈ°λ¥ μ μ© λ‹¨μ„λ” λ©”μ„λ“μ΄κΈ° λ•λ¬Έμ—, λ©”μ„λ“λ§λ‹¤ @Transactionalμ„ λ¶€μ—¬ν•κ³  μ†μ„±μ„ μ§€μ •ν•  μ μλ‹¤.

<br/>

### λ€μ²΄ μ •μ±…
- μ¤ν”„λ§μ€ @Transactionalμ„ μ μ©ν•  λ• 4λ‹¨κ³„ λ€μ²΄ μ •μ±…μ„ μ΄μ©ν•  μ μκ² ν•λ‹¤.
- λ©”μ„λ“μ μ†μ„±μ„ ν™•μΈν•  λ• νƒ€κΉƒ λ©”μ„λ“, νƒ€κΉƒ ν΄λμ¤, μ„ μ–Έ λ©”μ„λ“, μ„ μ–Έ νƒ€μ…μ μμ„μ— λ”°λΌμ„ @Transacionalμ΄ μ μ©λλ”μ§€ μ°¨λ΅€λ΅ ν™•μΈν•κ³ , κ°€μ¥ λ¨Όμ € λ°κ²¬λλ” μ†μ„±μ •λ³΄λ¥Ό μ‚¬μ©ν•κ² ν•λ‹¤.

<br/>

```java
[1]
public interface Service {
  [2]
  void method1();
  [3]
  void method2();
}
[4]
public class ServiceImpl implements Service {
  [5]
  public void method1() {
  };
  [6]
  public void method2() {
  }
}
```
π”Ό @Transactional λ€μ²΄ μ •μ±…μ μ
- μΈν„°νμ΄μ¤μ—λ” 2κ°μ λ©”μ„λ“κ°€, κµ¬ν„ ν΄λμ¤μ—λ” μ •μλ 2κ°μ λ©”μ„λ“κ°€ μλ‹¤.
- @Transactionalμ„ λ¶€μ—¬ν•  μ μλ” μ„μΉλ” [1]~[6] μ΄ 6κ°μ΄λ‹¤.
- μ²« λ²μ§Έ ν›„λ³΄: [5], [6]
- λ‘ λ²μ§Έ ν›„λ³΄: [4]
- μ„Έ λ²μ§Έ ν›„λ³΄: [2], [3]
- λ„¤ λ²μ§Έ ν›„λ³΄: [1]
- κΈ°λ³Έμ μΌλ΅ @Transactional μ μ© λ€μƒμ€ μΈν„°νμ΄μ¤κ°€ μ •μν• λ©”μ„λ“μ΄λ―€λ΅, μ–΄λ…Έν…μ΄μ…μ€ νƒ€κΉƒ ν΄λμ¤λ³΄λ‹¤ μΈν„°νμ΄μ¤μ— λ‘λ” κ²ƒμ΄ λ°”λμ§ν•λ‹¤.
- μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•λ” ν”„λ΅μ‹ λ°©μ‹μ AOPκ°€ μ•„λ‹ λ°©μ‹μΌλ΅ μ μ©ν•λ©΄, νƒ€κΉƒ ν΄λμ¤μ— λ‘λ” κ²ƒμ΄ κ¶μ¥λλ‹¤.
- μΈν„°νμ΄μ¤μ— λ‘λ©΄ κµ¬ν„ ν΄λμ¤κ°€ λ°”λ€μ–΄λ„ νΈλμ­μ… μ†μ„±μ„ μ μ§€ν•  μ μκ³ , νƒ€κΉƒ ν΄λμ¤μ— λ‘λ©΄ λ§μ νΈν•κ³  μ•μ „ν•λ‹¤.

<br/>

### νΈλμ­μ… μ–΄λ…Έν…μ΄μ… μ‚¬μ©μ„ μ„ν• μ„¤μ •
```xml
<tx:annotation-driven />
```
- νƒκ·Έ ν•λ‚λ΅ νΈλμ­μ… μ–΄λ…Έν…μ΄μ…μ„ μ΄μ©ν•λ” λ° ν•„μ”ν• μ”μ†λ“¤μ΄ λ“±λ΅λλ‹¤. (μ–΄λ“λ°”μ΄μ €, μ–΄λ“λ°”μ΄μ¤, ν¬μΈνΈμ»·, μ–΄λ…Έν…μ΄μ…μ„ μ΄μ©ν•λ” νΈλμ­μ… μ†μ„±μ •λ³΄)

<br/>

## 6.7.2 νΈλμ­μ… μ–΄λ…Έν…μ΄μ… μ μ©
- @Transactionalμ„ UserServiceμ— μ μ©ν•΄λ³΄μ.

<br/>

```xml
<tx:attributes>
  <!-- get* λ©”μ„λ“μ μ†μ„±μ΄ μ°μ„  μ μ©λκ³  λ‚λ¨Έμ§€ λ©”μ„λ“λ” λ””ν΄νΈ μ†μ„±μ„ κ°–λ”λ‹¤ -->
  <tx:method name="get*" read-only="true" />
  <tx:method name="*" />
</tx:attributes>
```
π”Ό tx μ¤ν‚¤λ§μ νƒκ·Έλ¥Ό μ΄μ©ν• νΈλμ­μ… μ†μ„± μ •μ
- λ©”μ„λ“ μ΄λ¦„ ν¨ν„΄μ„ μ΄μ©ν•΄ 2κ°€μ§€ μΆ…λ¥μ μ†μ„±μ„ μ§€μ •ν–λ‹¤.
- λ§μ΄ μ‚¬μ©λλ” ν• κ°€μ§€λ¥Ό νƒ€μ… λ λ²¨μ— κ³µν†µ μ†μ„±μΌλ΅ μ§€μ •ν•κ³ , λ‚λ¨Έμ§€ μ†μ„±μ€ κ°λ³„ λ©”μ„λ“μ— μ μ©ν•΄μ•Ό ν•λ‹¤.

<br/>

```java
@Transactional
public interface UserService {
  // <tx:method name="" /> μ„¤μ • ν¨κ³Ό
  // νƒ€μ… λ λ²¨μ— λ¶€μ—¬λ λ””ν΄ν„° μ†μ„± μ μ©
  void add(User user);
  void deleteAll();
  void update(User user);
  void upgradeLevels();

  // <tx:method name="get" read-only="true"/> ν¨κ³Ό
  // μ°μ„  μ μ©
  @Transactional(readOnly=true)
  User get(String id);

  @Transactional(readOnly=true)
  List<User> getAll();
}
```
π”Ό @Transactional μ–΄λ…Έν…μ΄μ…μ„ μ΄μ©ν• μ†μ„± λ¶€μ—¬
- UserService μΈν„°νμ΄μ¤μ— μ μ©ν•λ‹¤. (μΈν„°νμ΄μ¤ λ°©μ‹μ ν”„λ΅μ‹λ¥Ό μ‚¬μ©)
- μΈν„°νμ΄μ¤ λ λ²¨μ— λ””ν΄νΈ μ†μ„±μ„ λ¶€μ—¬ν•κ³ , μ½κΈ°μ „μ© μ†μ„±μ„ μ§€μ •ν•  getμΌλ΅ μ‹μ‘ν•λ” λ©”μ„λ“μ—λ” μ½κΈ°μ „μ© νΈλμ­μ… μ†μ„±μ„ λ°λ³µ μ§€μ •ν•λ‹¤.

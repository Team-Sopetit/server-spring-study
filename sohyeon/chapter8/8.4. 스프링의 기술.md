# 8.4 스프링의 기술
## 8.4.1 제어의 역전(IoC) / 의존관계 주입(DI)
유연한 확장이 가능하게 한다.

<br/>

### DI의 활용 방법
- 핵심 기능의 변경
  - DI의 가장 대표적인 적용 방법은 **의존 대상의 구현을 바꾸는 것**이다.
  - DI를 이용해 새로운 구현 방식을 통째로 변경한다.
 
- 핵심 기능의 동적인 변경
  - 기능은 같지만 독립적인 상태 정보를 저장할 수 있는 자신만의 오브젝트를 가지게 할 수 있다.
  - 기술적으로 보면 다이내믹 라우팅 프록시나 프록시 오브젝트 기법을 활용한 것이다.
 
- 부가 기능의 추가
  - 핵심 기능은 그대로 둔 채 부가 기능을 추가한다. (like 데코레이터 패턴)
  - 부가 기능의 추가 방식을 특정 오브젝트가 아니라 좀 더 많은 대상으로 일반화해서 적용하면 AOP가 된다.
 
- 인터페이스의 변경
  - 인터페이스가 다른 오브젝트를 클라이언트가 사용하는 인터페이스로 바꿔주는 기능을 이용하면 된다. (A -> B(C로 위임) -> C)
  - 디자인 패턴에서 말하는 오브젝트 방식의 어댑터 패턴의 응용이라고 볼 수 있다.
 
- 프록시
  - 지연된 로딩(lazy loading)을 적용하려면 프록시가 필요하다.
  - 원격 프록시를 적용하려고 할 때도 프록시가 필요하다.
 
- 템플릿과 콜백
  - 공정적인 작업 흐름과 그 사이에서 자주 바뀌는 부분을 분리해서 템플릿과 콜백으로 만들고 이를 DI 원리를 응용해 적용하면 코드를 간결하게 만들 수 있다.
  - OCP의 폐쇄 원칙에 가장 잘 들어맞는다.
    - 콜백을 얼마든지 만들어서 사용할 수 있다. (유연한 확장)
    - 템플릿은 한 번 만들어두면 계속 재사용할 수 있다.
   
- 싱글톤과 오브젝트 스코프
  - 생명주기를 DI 컨테이너가 주관하기 때문에 그 오브젝트의 스코프를 자유롭게 제어할 수 있다.
  - 컨테이너가 알아서 싱글톤을 만들고 관리하기 때문에 클래스 자체는 싱글톤을 고려하지 않고 자유롭게 설계할 수 있다.
  - 개발자 스스로 일정한 스코프를 갖는 오브젝트를 만들고 이를 DI에 적용하는 것도 가능하다.
 
- 테스트
  - 의존 오브젝트를 대신해서 스텁 또는 목 오브젝트 같은 테스트 대역을 활용해야 한다. (DI가 중요한 역할)
  - 테스트용으로 설정을 별도로 만드는 방법도 있다.
 
<br/>

## 8.4.2 애스펙트 지향 프로그래밍(AOP)
스프링의 AOP는 스프링이 POJO 프로그래밍을 지원하려는 그 핵심 목적을 위해 중요한 역할을 하고 있다.

<br/>

### AOP의 적용 기법
- 스프링과 같이 다이내믹 프록시를 사용한다.
  - 데코레이터 패턴을 응용한 것이다.
  - 👎 부가기능을 부여할 수 있는 곳은 메서드의 호출이 일어나는 지점 뿐이다.
  - 엔터프라이즈 개발에서 필요로 하는 AOP는 대부분이 이 프록시 방식의 AOP면 된다.
 
- 자바 언어의 한계를 넘어서는 언어의 확장을 이용한다.
  - AspectJ는 강력한 고급 기능을 가진 AOP를 제공한다.
  - 사용하기 까다롭지만, 경우에 따라 프록시 방식의 AOP로는 할 수 없는 작업을 위해 AspectJ를 사용해야 한다.
 
<br/>

### AOP의 적용 단계
1. 미리 준비된 AOP 이용
   - 스프링이 미리 만들어서 제공하는 AOP 기능을 그대로 가져다 적용해본다. (Ex. 트랜잭션)
   - @Configurable 어노테이션을 이용해서 도메인 오브젝트에 DI를 자동 적용해주는 AOP 기능도 있다.
     - 도메인 오브젝트를 전용 계층에 두고 접근하는 아키텍처 방식을 따를 때 필요하다.
     - AspectJ를 이용한 AOP가 필요하다.
    
   - AOP에 대한 지식이나 경험이 많지 않아도 간단히 이용 가능하다.
  
2. 전담팀을 통한 정책 AOP 적용
   - 애플리케이션 전체적으로 이용 가능한 것을 소수의 AOP 담당자 관리 하에 적용해본다.
   - Ex. 보안, 로깅, 트레이싱, 실시간 성능 모니터링 등
   - 운영 중에 필요한 기능 외에 개발 가이드라인이나 표준을 따라서 코드가 작성되어 있는지를 검증하는 작업을 AOP를 이용해 할 수 있다.
  
3. AOP의 자유로운 이용
   - 개발자 스스로가 AOP를 활용한다.
   - 개발자가 구현하는 기능에 적용하면 유용한 세부적인 AOP를 이용할 수 있다.
   - 한 모듈 또는 특정 기능 안에서도 AOP로 분리하면 유용한 것들이 있다.
  
<br/>

## 8.4.3 포터블 서비스 추상화(PSA)

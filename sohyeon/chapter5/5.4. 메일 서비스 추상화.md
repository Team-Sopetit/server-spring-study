## 5.4 ë©”ì¼ ì„œë¹„ìŠ¤ ì¶”ìƒí™”
- ë ˆë²¨ì´ ì—…ê·¸ë ˆì´ë“œë˜ëŠ” ì‚¬ìš©ì¥ê²ŒëŠ” ì•ˆë‚´ ë©”ì¼ì„ ë°œì†¡í•´ì•¼ í•œë‹¤.
  - ì‚¬ìš©ìì˜ ì´ë©”ì¼ ì •ë³´ë¥¼ ê´€ë¦¬í•´ì•¼ í•œë‹¤.
  - UserServiceì˜ upgradeLevel() ë©”ì†Œë“œì— ë©”ì¼ ë°œì†¡ ê¸°ëŠ¥ì„ ì¶”ê°€í•œë‹¤.
 
<br/>

### 5.4.1 JavaMailì„ ì´ìš©í•œ ë©”ì¼ ë°œì†¡ ê¸°ëŠ¥
- DBì˜ User í…Œì´ë¸”ì— email í•„ë“œë¥¼, User í´ë˜ìŠ¤ì— email í”„ë¡œí¼í‹°ë¥¼ ì¶”ê°€í•œë‹¤.

<br/>

> ***JavaMail ë©”ì¼ ë°œì†¡***

ğŸ”½ ë ˆë²¨ ì—…ê·¸ë ˆì´ë“œ ì‘ì—… ë©”ì†Œë“œ ìˆ˜ì •
```java
protected void upgradeLevel(User user) {
  user.upgradeLevel();
  userDao.update(user);
  sendUpgradeEMail(user);
}
```
- ë©”ì¼ ë°œì†¡ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤.

<br/>

ğŸ”½ JavaMailì„ ì´ìš©í•œ ë©”ì¼ ë°œì†¡ ë©”ì†Œë“œ
```java
private void sendUpgradeEMail(User user) {
  Properties props = new Properties();
  props.put("mail.smtp.host", "mail.ksug.org");
  Session s = Session.getInstance(props, null);

  MimeMessage message = new MimeMessage(s);
  try {
    message.setFrom("new InternetAddress("useradmin@ksug.org"));
    message.addRecipient(Message.RecipientType.TO, new InternetAddress(user.getEmail()));
    message.setSubject("Upgrade ì•ˆë‚´");
    message.setText("ì‚¬ìš©ìë‹˜ì´ ë“±ê¸‰ì´ " + user.getLevel().name() + "ë¡œ ì—…ê·¸ë ˆì´ë“œë˜ì—ˆìŠµë‹ˆë‹¤.");

    Transport.send(message);
  } catch (AddressException e) {
    throw new RuntimeException(e);
  } catch (MessagingException e) {
    throw new RuntimeException(e);
  } catch (UnsupportedEncodingException e) {
    throw new RuntimeException(e);
  }
}
```
- JavaMail APIë¥¼ ì‚¬ìš©í•˜ëŠ” ë©”ì†Œë“œë¥¼ ì¶”ê°€í•œë‹¤.

<br/>

### 5.4.2 JavaMailì´ í¬í•¨ëœ ì½”ë“œì˜ í…ŒìŠ¤íŠ¸

- ë©”ì¼ ë°œì†¡ í…ŒìŠ¤íŠ¸ë€ ì—„ë°€íˆ ë§í•´ì„œ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
- ë©”ì¼ í…ŒìŠ¤íŠ¸ë¥¼ í•œë‹¤ê³  ë§¤ë²ˆ ë©”ì¼ ìˆ˜ì‹  ì—¬ë¶€ê¹Œì§€ ì¼ì¼ì´ í™•ì¸í•  í•„ìš”ëŠ” ì—†ê³ , í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ë©”ì¼ ì„œë²„ê¹Œì§€ë§Œ ì˜ ì „ì†¡ë˜ëŠ”ì§€ í™•ì¸í•˜ë©´ ëœë‹¤.

<br/>

ğŸ”½ í…ŒìŠ¤íŠ¸ ë©”ì¼ ì„œë²„ë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸ êµ¬ì¡°

![image](https://github.com/Team-Sopetit/server-spring-study/assets/55437339/b3ffc922-62aa-4792-aaf8-8eeb0cde6a89)

- ì‹¤ì œ ë©”ì¼ ì„œë²„ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  í…ŒìŠ¤íŠ¸ ë©”ì¼ ì„œë²„ë¥¼ ì´ìš©í•´ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì´ë‹¤.
- í…ŒìŠ¤íŠ¸ ë©”ì¼ ì„œë²„ëŠ” JavaMailê³¼ ì—°ë™í•´ì„œ ë©”ì¼ ì „ì†¡ ìš”ì²­ì„ ë°›ëŠ” ê²ƒê¹Œì§€ë§Œ ë‹´ë‹¹í•œë‹¤.

<br/>

ğŸ”½ í…ŒìŠ¤íŠ¸ìš© JavaMailì„ ì´ìš©í•œ í…ŒìŠ¤íŠ¸ êµ¬ì¡°

![image](https://github.com/Team-Sopetit/server-spring-study/assets/55437339/9d2e9f74-df3a-419c-aafe-362ada228d41)

- JavaMail APIë¥¼ í†µí•´ ìš”ì²­ì´ ë“¤ì–´ê°„ë‹¤ëŠ” ë³´ì¥ë§Œ ìˆìœ¼ë©´ êµ³ì´ í…ŒìŠ¤íŠ¸ í•  ë•Œë§ˆë‹¤ JavaMailì„ ì§ì ‘ êµ¬ë™ì‹œí‚¬ í•„ìš”ê°€ ì—†ë‹¤.
- ê°œë°œ ì¤‘ì´ê±°ë‚˜ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•  ë•ŒëŠ” JavaMailì„ ëŒ€ì‹ í•  ìˆ˜ ìˆëŠ” ì½”ë“œê°€ ë™ì‘í•˜ë„ë¡ ë§Œë“¤ì–´ë„ ëœë‹¤.
- ë§¤ë²ˆ ê²€ì¦ì´ í•„ìš” ì—†ëŠ” ë¶ˆí•„ìš”í•œ ë©”ì¼ ì „ì†¡ ìš”ì²­ì„ ë³´ë‚´ì§€ ì•Šì•„ë„ ë˜ê³ , í…ŒìŠ¤íŠ¸ë„ ë§¤ìš° ë¹ ë¥´ê³  ì•ˆì „í•˜ê²Œ ìˆ˜í–‰ë  ìˆ˜ ìˆë‹¤.

<br/>

### 5.4.3 í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì„œë¹„ìŠ¤ ì¶”ìƒí™”

> ***JavaMailì„ ì´ìš©í•œ í…ŒìŠ¤íŠ¸ì˜ ë¬¸ì œì ***

- êµ¬í˜„ì„ ë°”ê¿”ì¹˜ê¸°í•  ë§Œí•œ ì¸í„°í˜ì´ìŠ¤ì˜ ì¡´ì¬ê°€ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤. (JavaMailì˜ êµ¬í˜„ì„ í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ë°”ê¿”ì¹˜ê¸° ë¶ˆê°€)

<br/>

> ***ë©”ì¼ ë°œì†¡ ê¸°ëŠ¥ ì¶”ìƒí™”***

ğŸ”½ JavaMailì˜ ì„œë¹„ìŠ¤ ì¶”ìƒí™” ì¸í„°í˜ì´ìŠ¤
```java
package org.springframework.mail;
...
public interface MailSender {
  void send(SimpleMailMessage simpleMessage) throws MailException;
  void send(SimpleMailMessage[] simpleMessages) throws MailException;
}
```
- SimpleMailMessageë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ì— ë‹´ê¸´ ë©”ì¼ ë©”ì„¸ì§€ë¥¼ ì „ì†¡í•˜ëŠ” ë©”ì†Œë“œë¡œë§Œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.
- ê¸°ë³¸ì ìœ¼ë¡œëŠ” JavaMailì„ ì‚¬ìš©í•´ ë©”ì¼ ë°œì†¡ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” JavaMailSenderImpl í´ë˜ìŠ¤ë¥¼ ì´ìš©í•˜ë©´ ëœë‹¤.

<br/>

ğŸ”½ ìŠ¤í”„ë§ì˜ MailSenderë¥¼ ì´ìš©í•œ ë©”ì¼ ë°œì†¡ ë©”ì†Œë“œ
```java
private void sendUpgradeEMail(User user) {
  JavaMailSenderImpl mailSender = new JavaMailSenderImpl(); // MailSender êµ¬í˜„ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±
  mailSender.setHost("mail.server.com");

  // MailMessage ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ í´ë˜ìŠ¤ ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ì–´ ë©”ì¼ ë‚´ìš©ì„ ì‘ì„±í•œë‹¤.
  SimpleMailMessage mailMessage = new SimpleMailMessage();
  mailMessage.setTo(user.getEmail());
  mailMessage.setFrom("useradmin@ksug.org");
  mailMessage.setSubject("Upgrade ì•ˆë‚´");
  mailMessage.setText("ì‚¬ìš©ìë‹˜ì˜ ë“±ê¸‰ì´ " + user.getLevel().name());

  mailSender.send(mailMessage);
}
```
- ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” JavaMailSender êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ì„œ ë§Œë“  ë©”ì¼ ë°œì†¡ìš© ì½”ë“œë‹¤.
- MailMessage íƒ€ì…ì˜ SimpleMailMessage ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ì–´ì„œ ë©”ì‹œì§€ë¥¼ ë„£ê³  JavaMailSender íƒ€ì… ì˜¤ë¸Œì íŠ¸ì˜ send() ë©”ì†Œë“œì— ì „ë‹¬í•œë‹¤.
- JavaMailSenderImplì€ ë‚´ë¶€ì ìœ¼ë¡œ JavaMail APIë¥¼ ì´ìš©í•´ ë©”ì¼ì„ ì „ì†¡í•´ì¤€ë‹¤.
- ì•„ì§ JavaMail APIë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í…ŒìŠ¤íŠ¸ìš© ì˜¤ë¸Œì íŠ¸ë¡œ ëŒ€ì²´í•  ìˆ˜ëŠ” ì—†ë‹¤.

<br/>

ğŸ”½ ë©”ì¼ ì „ì†¡ ê¸°ëŠ¥ì„ ê°€ì§„ ì˜¤ë¸Œì íŠ¸ë¥¼ DI ë°›ë„ë¡ ìˆ˜ì •í•œ UserService
```java
public class UserService {
  ...
  private MailSender mailSender;

  public void setMailSender(MailSender mailSender) {
    this.mailSender = mailSender;
  }

  private void sendUpgradeEMail(User user) {
    SimpleMailMessage mailMessage = new SimpleMailMessage();
    mailMessage.setTo(user.getEmail());
    mailMessage.setFrom("useradmin@ksug.org");
    mailMessage.setSubject("Upgrade ì•ˆë‚´");
    mailMessage.setText("ì‚¬ìš©ìë‹˜ì˜ ë“±ê¸‰ì´ " + user.getLevel().name());

    this.mailSender.send(mailMessage);
  }
}
```
- sendUpgradeMail() ë©”ì†Œë“œì—ëŠ” MailSender ì¸í„°í˜ì´ìŠ¤ë§Œ ë‚¨ê¸°ê³ , êµ¬ì²´ì ì¸ ë©”ì¼ ì „ì†¡ êµ¬í˜„ì„ ë‹´ì€ ì •ë³´ëŠ” ì½”ë“œì—ì„œ ì œê±°í•œë‹¤.
- MailSender ì¸í„°í˜ì´ìŠ¤ íƒ€ì…ì˜ ë³€ìˆ˜ë¥¼ ë§Œë“¤ê³  ìˆ˜ì •ì ë©”ì†Œë“œë¥¼ ì¶”ê°€í•´ DIê°€ ê°€ëŠ¥í•˜ë„ë¡ ë§Œë“ ë‹¤.

<br/>

ğŸ”½ ë©”ì¼ ë°œì†¡ ì˜¤ë¸Œì íŠ¸ì˜ ë¹ˆ ë“±ë¡
```xml
<bean id="userService" class="springbook.user.service.UserService">
  <property name="userDao" ref="userDao" />
  <property name="transactionManager" ref="transactionManager" />
  <property name="mailSender" ref="mailSender" />
</bean>

<bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
  <property name="host" value="mail.server.com" />
</bean>
```
- ì„¤ì •íŒŒì¼ ì•ˆì— JavaMailSenderImpl í´ë˜ìŠ¤ë¡œ ë¹ˆì„ ë§Œë“¤ê³  UserServiceì— DI í•´ì¤€ë‹¤.
- ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ëŠ” MailSenderì˜ êµ¬í˜„ í´ë˜ìŠ¤ë“¤ì€ ì‹±ê¸€í†¤ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•´ì•¼ í•œë‹¤.

<br/>

> ***í…ŒìŠ¤íŠ¸ìš© ë©”ì¼ ë°œì†¡ ì˜¤ë¸Œì íŠ¸***

ğŸ”½ ì•„ë¬´ëŸ° ê¸°ëŠ¥ì´ ì—†ëŠ” MailSender êµ¬í˜„ í´ë˜ìŠ¤
```java
package springbook.user.service;
...
public class DummyMailSender implements MailSender {
  public void send(SimpleMailMessage mailMessage) throws MailException {
  }

  public void send(SimpleMailMessage[] mailMessage) throws MailException {
  }
}
```
- MailSender ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í–ˆì„ ë¿, **í•˜ëŠ” ì¼ì´ ì—†ë‹¤.**
- í…ŒìŠ¤íŠ¸ ì„¤ì •íŒŒì¼ì˜ mailSender ë¹ˆ í´ë˜ìŠ¤ë„ DummyMailSenderë¡œ ë³€ê²½í•´ì¤€ë‹¤.

<br/>

ğŸ”½ í…ŒìŠ¤íŠ¸ìš© UserServiceë¥¼ ìœ„í•œ ë©”ì¼ ì „ì†¡ ì˜¤ë¸Œì íŠ¸ì˜ ìˆ˜ë™ DI
```java
public class UserServiceTest {
  ...
  @Autowired
  MailSender mailSender;

  @Test
  public void upgradeAllOrNothing() throws Exception {
    ...
    testUserService.setMailSender(mailSender);
```
- ìˆ˜ë™ DI ë°©ì‹ì„ ì‚¬ìš©í•œ upgradeAllOrNothing() ë©”ì†Œë“œì—ë„ mailSenderë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.
- í…ŒìŠ¤íŠ¸ìš© ë©”ì¼ ì „ì†¡ í´ë˜ìŠ¤(DummyMailSender)ë¥¼ ì´ìš©í•˜ëŠ” í•œ ë©”ì¼ì´ ë©”ì¼ ì„œë²„ë¡œ ë°œì†¡ë  ì¼ì€ ì—†ë‹¤.

<br/>

> ***í…ŒìŠ¤íŠ¸ì™€ ì„œë¹„ìŠ¤ ì¶”ìƒí™”***

ğŸ”½ ìŠ¤í”„ë§ì˜ ë©”ì¼ ì „ì†¡ ì„œë¹„ìŠ¤ ì¶”ìƒí™” êµ¬ì¡°
![image](https://github.com/Team-Sopetit/server-spring-study/assets/55437339/da3a7153-115e-4041-a1f9-a583596b5efd)

- MailSender ì¸í„°í˜ì´ìŠ¤ë¥¼ í•µì‹¬ìœ¼ë¡œ í•˜ëŠ” ë©”ì¼ ì „ì†¡ ì„œë¹„ìŠ¤ ì¶”ìƒí™”ì˜ êµ¬ì¡°
- JavaMail ì™¸ì˜ ë‹¤ë¥¸ ë©”ì‹œì§• ì„œë²„ì˜ APIë¥¼ ì´ìš©í•´ ë©”ì¼ì„ ì „ì†¡í•˜ëŠ” ê²½ìš°ì—ë„, í•´ë‹¹ ê¸°ìˆ ì˜ APIë¥¼ ì´ìš©í•˜ëŠ” MailSender êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ DIí•˜ë©´ ëœë‹¤.
- ë©”ì¼ì„ ë°”ë¡œ ì „ì†¡í•˜ì§€ ì•Šê³  ì‘ì—… íì— ë‹´ì•„ë’€ë‹¤ê°€ ì •í•´ì§„ ì‹œê°„ì— ë©”ì¼ì„ ë°œì†¡í•˜ëŠ” ê¸°ëŠ¥ì„ ë§Œë“¤ ìˆ˜ë„ ìˆë‹¤.
- ê·¸ ì™¸ì—ë„ ì¶”ìƒí™” ê³„ì¸µì„ ì´ìš©í•  ìˆ˜ ìˆëŠ” ìˆ˜ë§ì€ **ì‘ìš© ë°©ë²•**ì´ ìˆë‹¤.
- ë©”ì¼ ë°œì†¡ ê¸°ëŠ¥ì—ë„ íŠ¸ëœì­ì…˜ ê°œë…ì„ ì ìš©í•´ì•¼ í•œë‹¤. (í˜„ì¬ ì ìš©X)
  - ë©”ì¼ì„ ì—…ê·¸ë ˆì´ë“œí•  ì‚¬ìš©ìë¥¼ ë°œê²¬í•  ë•Œë§ˆë‹¤ ë°œì†¡ ëŒ€ìƒì„ ë³„ë„ì˜ ëª©ë¡ì— ì €ì¥í•´ë‘ê³ , ëª¨ë“  ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ëë‚œ í›„ í•œ ë²ˆì— ë©”ì¼ì„ ì „ì†¡í•œë‹¤.
  - MailSenderë¥¼ í™•ì¥í•´ì„œ ë©”ì¼ ì „ì†¡ì— íŠ¸ëœì­ì…˜ ê°œë…ì„ ì ìš©í•œë‹¤.
- íŠ¹ë³„íˆ ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ì™€ ì—°ë™í•˜ëŠ” ëŒ€ë¶€ë¶„ì˜ ì‘ì—…ì€ ì¶”ìƒí™”ì˜ ëŒ€ìƒì´ ë  ìˆ˜ ìˆë‹¤.

<br/>

### 5.4.4 í…ŒìŠ¤íŠ¸ ëŒ€ì—­
- í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•˜ëŠ” ê¸°ë²•ì´ ìˆë‹¤.
- ëŒ€ë¶€ë¶„ í…ŒìŠ¤íŠ¸í•  ëŒ€ìƒì´ ì˜ì¡´í•˜ê³  ìˆëŠ” ì˜¤ë¸Œì íŠ¸ DIë¥¼ í†µí•´ ë°”ê¿”ì¹˜ê¸°í•˜ëŠ” ê²ƒì´ë‹¤.

<br/>

> ***ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ì˜ ë³€ê²½ì„ í†µí•œ í…ŒìŠ¤íŠ¸ ë°©ë²•***

ğŸ”½ UserDao í…ŒìŠ¤íŠ¸ êµ¬ì¡°

![image](https://github.com/Team-Sopetit/server-spring-study/assets/55437339/57972e90-5ccd-4c6b-babf-ea01ba5aadef)

- UserDaoTestë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ê°€ ì§„í–‰ë  ë•Œì˜ ìƒí™©ì„ ë‚˜íƒ€ë‚¸ë‹¤.
- UserDaoTestì˜ ê´€ì‹¬ì€ UserDaoê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ì—ë§Œ ìˆë‹¤.

<br/>

ğŸ”½ UserService í…ŒìŠ¤íŠ¸ êµ¬ì¡°

![image](https://github.com/Team-Sopetit/server-spring-study/assets/55437339/53a30e2d-9456-4243-94f2-85725285a690)

- UserServiceì˜ í…ŒìŠ¤íŠ¸ ì¤‘ì— ë©”ì¼ ì „ì†¡ ê¸°ëŠ¥ì„ ì´ìš©í•˜ëŠ” êµ¬ì¡°ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.
- UserServiceTestì˜ ê´€ì‹¬ì‚¬ëŠ” UserServiceì—ì„œ êµ¬í˜„í•´ë†“ì€ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ê³µí•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ë§Œ ìˆë‹¤.

<br/>

- í…ŒìŠ¤íŠ¸ ëŒ€ìƒì´ ë˜ëŠ” ì˜¤ë¸Œì íŠ¸ê°€ ë˜ ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸ì— ì˜ì¡´í•˜ëŠ” ì¼ì€ ë§¤ìš° í”í•˜ë‹¤.
- ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ë¥¼ í˜‘ë ¥ ì˜¤ë¸Œì íŠ¸ë¼ê³ ë„ í•œë‹¤. (í•¨ê»˜ í˜‘ë ¥í•´ì„œ ì¼ì„ ì²˜ë¦¬í•˜ëŠ” ëŒ€ìƒì´ê¸° ë•Œë¬¸ì—)
- ì‹¤ì „ì—ì„œ ì‚¬ìš©í•  ì˜¤ë¸Œì íŠ¸ë¥¼ êµì²´í•˜ì§€ ì•Šë”ë¼ë„, ë‹¨ì§€ í…ŒìŠ¤íŠ¸ë§Œì„ ìœ„í•´ì„œë„ DIëŠ” ìœ ìš©í•˜ë‹¤.

<br/>

> ***í…ŒìŠ¤íŠ¸ ëŒ€ì—­ì˜ ì¢…ë¥˜ì™€ íŠ¹ì§•***

- í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ë§Œë“¤ì–´ì£¼ê¸° ìœ„í•´, í…ŒìŠ¤íŠ¸ ëŒ€ìƒì´ ë˜ëŠ” ì˜¤ë¸Œì íŠ¸ì˜ ê¸°ëŠ¥ì—ë§Œ ì¶©ì‹¤í•˜ë©° ë¹ ë¥´ê²Œ, ìì£¼ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ì‚¬ìš©í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ í†µí‹€ì–´ **í…ŒìŠ¤íŠ¸ ëŒ€ì—­**ì´ë¼ê³  í•œë‹¤.
- **í…ŒìŠ¤íŠ¸ ìŠ¤í…**(ëŒ€í‘œì ì¸ í…ŒìŠ¤íŠ¸ ëŒ€ì—­)ì€ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì˜¤ë¸Œì íŠ¸ì˜ ì˜ì¡´ ê°ì²´ë¡œì„œ ì¡´ì¬í•˜ë©´ì„œ í…ŒìŠ¤íŠ¸ ë™ì•ˆì— ì½”ë“œê°€ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” ê²ƒì´ë‹¤.
- DummyMailSenderëŠ” ê°€ì¥ ë‹¨ìˆœí•˜ê³  ì‹¬í”Œí•œ í…ŒìŠ¤íŠ¸ ìŠ¤í…ì˜ ì˜ˆë‹¤.
- ìŠ¤í…ì— ë¯¸ë¦¬ í…ŒìŠ¤íŠ¸ ì¤‘ì— í•„ìš”í•œ ì •ë³´ë¥¼ ë¦¬í„´í•´ì£¼ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
- ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ê°•ì œë¡œ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œì¼œ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì˜¤ë¸Œì íŠ¸ê°€ ì˜ˆì™¸ìƒí™©ì—ì„œ ì–´ë–»ê²Œ ë°˜ì‘í• ì§€ í…ŒìŠ¤íŠ¸í•  ë•Œ ì ìš©í•  ìˆ˜ë„ ìˆë‹¤.
- í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì˜¤ë¸Œì íŠ¸ê°€ ê°„ì ‘ì ìœ¼ë¡œ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ì— ë„˜ê¸°ëŠ” ê°’ê³¼ ê·¸ í–‰ìœ„ ìì²´ì— ëŒ€í•´ì„œë„ ê²€ì¦í•˜ê³  ì‹¶ë‹¤ë©´, **ëª© ì˜¤ë¸Œì íŠ¸**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- `ëª© ì˜¤ë¸Œì íŠ¸` : í…ŒìŠ¤íŠ¸ ì˜¤ë¸Œì íŠ¸ì™€ ìì‹ ì˜ ì‚¬ì´ì—ì„œ ì¼ì–´ë‚˜ëŠ” ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ë‚´ìš©ì„ ì €ì¥í•´ë’€ë‹¤ê°€ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ê²€ì¦í•˜ëŠ” ë° í™œìš©í•  ìˆ˜ ìˆê²Œ í•œë‹¤.

<br/>

ğŸ”½ ëª© ì˜¤ë¸Œì íŠ¸ë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸ ë™ì‘ ë°©ì‹

![image](https://github.com/Team-Sopetit/server-spring-study/assets/55437339/9abe5793-d31e-40c7-9458-ebf7981ca056)

- ëª© ì˜¤ë¸Œì íŠ¸ë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸ì˜ êµ¬ì¡°
- (5)ë²ˆì„ ì œì™¸í•˜ê³ ëŠ” ìŠ¤í…ìœ¼ë¡œ ë´ë„ ë¬´ë°©í•˜ë‹¤.
- í…ŒìŠ¤íŠ¸ëŠ” í…ŒìŠ¤íŠ¸ì˜ ëŒ€ìƒì´ ë˜ëŠ” ì˜¤ë¸Œì íŠ¸ì— ì§ì ‘ ì…ë ¥ ê°’ì„ ì œê³µí•˜ê³ , í…ŒìŠ¤íŠ¸ ì˜¤ë¸Œì íŠ¸ê°€ ëŒë ¤ì£¼ëŠ” ì¶œë ¥ ê°’ì„ ê°€ì§€ê³  ê²°ê³¼ë¥¼ í™•ì¸í•œë‹¤.

<br/>

> ***ëª© ì˜¤ë¸Œì íŠ¸ë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸***

ğŸ”½ ëª© ì˜¤ë¸Œì íŠ¸ë¡œ ë§Œë“  ë©”ì¼ ì „ì†¡ í™•ì¸ìš© í´ë˜ìŠ¤
```java
static class MockMailSender implements MailSender {
  private List<String> requests = new ArrayList<>();

  public List<String> getRequests() { // UserServiceë¡œë¶€í„° ì „ì†¡ ìš”ì²­ì„ ë°›ì€ ë©”ì¼ ì£¼ì†Œë¥¼ ì €ì¥í•´ë‘ê³  ì´ë¥¼ ì½ì„ ìˆ˜ ìˆê²Œ í•œë‹¤.
    return requests;
  }

  public void send(SimpleMailMessage mailMessage) throws MailException {
    requests.add(mailMessage.getTo()[0]); // ì „ì†¡ ìš”ì²­ì„ ë°›ì€ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì €ì¥í•´ë‘”ë‹¤. ê°„ë‹¨í•˜ê²Œ ì²« ë²ˆì§¸ ìˆ˜ì‹ ì ë©”ì¼ ì£¼ì†Œë§Œ ì €ì¥
  }

  public void send(SimpleMailMessage[] mailMessage) throws MailException {
  }
}
```
- í…ŒìŠ¤íŠ¸ ëŒ€ìƒì´ ë„˜ê²¨ì£¼ëŠ” ì¶œë ¥ ê°’ì„ ë³´ê´€í•´ë‘ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆë‹¤.
- í…ŒìŠ¤íŠ¸ ëŒ€ìƒì¸ UserServiceê°€ send() ë©”ì†Œë“œë¥¼ í†µí•´ ë©”ì¼ ì „ì†¡ ìš”ì²­ì„ ë³´ëƒˆì„ ë•Œ ê´€ë ¨ ì •ë³´ë¥¼ ì €ì¥í•´ë‘ëŠ” ê¸°ëŠ¥ì´ ìˆë‹¤.

<br/>

ğŸ”½ ë©”ì¼ ë°œì†¡ ëŒ€ìƒì„ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸
```java
@Test
@DirtiesContext // ì»¨í…ìŠ¤íŠ¸ì˜ DI ì„¤ì •ì„ ë³€ê²½í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¼ëŠ” ê²ƒì„ ì•Œë ¤ì¤€ë‹¤.
public void upgradeLevels() throws Exception {
  userDao.deleteAll();
  for(User user : users) userDao.add(user);

  // ë©”ì¼ ë°œì†¡ ê²°ê³¼ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë„ë¡ ëª© ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ì–´ userServiceì— ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ë¡œ ì£¼ì…í•´ì¤€ë‹¤.
  MockMailSender mockMailSender = new MockMailSender();
  userService.setMailSender(mockMailSender);

  // ì—…ê·¸ë ˆì´ë“œ í…ŒìŠ¤íŠ¸. ë©”ì¼ ë°œì†¡ì´ ì¼ì–´ë‚˜ë©´ MockMailSender ì˜¤ë¸Œì íŠ¸ì˜ ë¦¬ìŠ¤íŠ¸ì— ê·¸ ê²°ê³¼ê°€ ì €ì¥ëœë‹¤.
  userService.upgradeLevels();

  checkLevelUpgraded(users.get(0), false);
  checkLevelUpgraded(users.get(1), true);
  checkLevelUpgraded(users.get(2), false);
  checkLevelUpgraded(users.get(3), true);
  checkLevelUpgraded(users.get(4), false);

  // ëª© ì˜¤ë¸Œì íŠ¸ì— ì €ì¥ëœ ë©”ì¼ ìˆ˜ì‹ ì ëª©ë¡ì„ ê°€ì ¸ì™€ ì—…ê·¸ë ˆì´ë“œ ëŒ€ìƒê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
  List<String> request = mockMailSender.getRequests();
  assertThat(request.size(), is(2));
  assertThat(request.get(0), is(users.get(1).getEmail()));
  assertThat(request.get(1), is(users.get(3).getEmail()));
}
```
- ëª© ì˜¤ë¸Œì íŠ¸ë¥¼ í†µí•´ ë©”ì¼ ë°œì†¡ ì—¬ë¶€ë¥¼ ê²€ì¦í•  ìˆ˜ ìˆë‹¤.
- userServiceì— DI í•´ì¤¬ë˜ ëª© ì˜¤ë¸Œì íŠ¸ë¡œë¶€í„° getRequests()ë¥¼ í˜¸ì¶œí•´ì„œ ë©”ì¼ ì£¼ì†Œê°€ ì €ì¥ëœ ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
- MockMailSenderì˜ send() ë©”ì†Œë“œê°€ í˜¸ì¶œëë‹¤ë©´, ê·¸ë•Œë§ˆë‹¤ ìˆ˜ì‹ ì¸ì˜ ë©”ì¼ ì£¼ì†Œê°€ ë¦¬ìŠ¤íŠ¸ë¡œ ì¶”ê°€ëì„ ê²ƒì´ë‹¤.
- ë¦¬ìŠ¤íŠ¸ì˜ í¬ê¸°ë¥¼ í™•ì¸í•˜ê³ , ì—…ê·¸ë ˆì´ë“œ ëœ ì‚¬ìš©ìì˜ ë©”ì¼ ì£¼ì†Œë¥¼ ë¹„êµí•¨ìœ¼ë¡œì¨ ê²€ì¦í•œë‹¤.

<br/>

- í…ŒìŠ¤íŠ¸ê°€ ìˆ˜í–‰ë  ìˆ˜ ìˆë„ë¡ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ì— ê°„ì ‘ì ìœ¼ë¡œ ì…ë ¥ ê°’ì„ ì œê³µí•´ì£¼ëŠ” **ìŠ¤í… ì˜¤ë¸Œì íŠ¸**ì™€ ê°„ì ‘ì ì¸ ì¶œë ¥ ê°’ê¹Œì§€ í™•ì¸ ê°€ëŠ¥í•œ **ëª© ì˜¤ë¸Œì íŠ¸**, ì´ 2ê°€ì§€ëŠ” í…ŒìŠ¤íŠ¸ ëŒ€ì—­ì˜ ê°€ì¥ ëŒ€í‘œì ì¸ ë°©ë²•ì´ë©° íš¨ê³¼ì ì¸ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë° ë¹ ì§ˆ ìˆ˜ ì—†ëŠ” ì¤‘ìš”í•œ ë„êµ¬ë‹¤.

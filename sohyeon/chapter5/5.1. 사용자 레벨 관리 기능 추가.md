## 5.1 ì‚¬ìš©ì ë ˆë²¨ ê´€ë¦¬ ê¸°ëŠ¥ ì¶”ê°€
- ì§€ê¸ˆê¹Œì§€ ë§Œë“¤ì—ˆë˜ UserDaoë¥¼ ë‹¤ìˆ˜ì˜ íšŒì›ì´ ê°€ì…í•  ìˆ˜ ìˆëŠ” ì¸í„°ë„· ì„œë¹„ìŠ¤ì˜ ì‚¬ìš©ì ê´€ë¦¬ ëª¨ë“ˆì— ì ìš©í•œë‹¤ê³  ê°€ì •í•œë‹¤.
- ì¸í„°ë„· ì„œë¹„ìŠ¤ì˜ ì‚¬ìš©ì ê´€ë¦¬ ê¸°ëŠ¥ì—ì„œ êµ¬í˜„í•´ì•¼ í•  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
  - ì‚¬ìš©ìì˜ ë ˆë²¨ì€ BASIC, SILVER, GOLD 3ê°€ì§€ ì¤‘ í•˜ë‚˜ë‹¤.
  - ì‚¬ìš©ìê°€ ì²˜ìŒ ê°€ì…í•˜ë©´ BASIC ë ˆë²¨ì´ ë˜ë©°, ì´í›„ í™œë™ì— ë”°ë¼ì„œ í•œ ë‹¨ê³„ì”© ì—…ê·¸ë ˆì´ë“œ ë  ìˆ˜ ìˆë‹¤.
  - ê°€ì… í›„ 50íšŒ ì´ìƒ ë¡œê·¸ì¸ì„ í•˜ë©´ BASICì—ì„œ SILVER ë ˆë²¨ì´ ëœë‹¤.
  - SILVER ë ˆë²¨ì´ë©´ì„œ 30ë²ˆ ì´ìƒ ì¶”ì²œì„ ë°›ìœ¼ë©´ GOLD ë ˆë²¨ì´ ëœë‹¤.
  - ì‚¬ìš©ì ë ˆë²¨ì˜ ë³€ê²½ ì‘ì—…ì€ ì¼ì •í•œ ì£¼ê¸°ë¡œ ì¼ê´„ì ìœ¼ë¡œ ì§„í–‰ëœë‹¤. ë³€ê²½ ì‘ì—… ì „ì—ëŠ” ì¡°ê±´ì„ ì¶©ì¡±í•˜ë”ë¼ë„ ë ˆë²¨ì˜ ë³€ê²½ì´ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤.

<br/>

### 5.1.1. í•„ë“œ ì¶”ê°€

> ***Level ì´ëŠ„***

ğŸ”½ ì •ìˆ˜í˜• ìƒìˆ˜ ê°’ìœ¼ë¡œ ì •ì˜í•œ ì‚¬ìš©ì ë ˆë²¨
```java
class User {
  private static final int BASIC = 1;
  private static final int SILVER = 2;
  private static final int GOLD = 3;

  int level;

  public void setLevel(int level) {
    this.level = level;
  }
}
```
ğŸ”½ ì‚¬ìš©ì ë ˆë²¨ ìƒìˆ˜ ê°’ì„ ì´ìš©í•œ ì½”ë“œ
```java
if (user1.getLevel() == User.BASIC) {
  user1.setLevel(User.SILVER);
} 
```
- ê° ë ˆë²¨ ê°’ì„ ì½”ë“œí™”í•´ì„œ **ë²”ìœ„ê°€ ì‘ì€ ìˆ«ì**ë¡œ ê´€ë¦¬í•˜ë©´ DB ìš©ëŸ‰ë„ ë§ì´ ì°¨ì§€í•˜ì§€ ì•Šê³  ê°€ë²¼ì›Œì„œ ì¢‹ë‹¤.
- BASIC, SILVER, GOLDì²˜ëŸ¼ ì˜ë¯¸ ìˆëŠ” ìƒìˆ˜ë„ ì •ì˜í•´ë†¨ìœ¼ë‹ˆ ê¹”ë”í•˜ê²Œ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
- DBì— ì €ì¥ë  ë•ŒëŠ” getLevel()ì´ ëŒë ¤ì£¼ëŠ” ê°’ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

<br/>

```java
user1.setLevel(other.getSum());
```
- í•˜ì§€ë§Œ levelì˜ íƒ€ì…ì´ intì´ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ì •ë³´ë¥¼ ë„£ëŠ” **ì‹¤ìˆ˜ë¥¼ í•´ë„ ì»´íŒŒì¼ëŸ¬ê°€ ì²´í¬í•´ì£¼ì§€ ëª»í•œë‹¤.**

<br/>

ğŸ”½ ì‚¬ìš©ì ë ˆë²¨ìš© ì´ëŠ„
```java
package springbook.user.domain;
...
public enum Level {
  BASIC(1), SILVER(2), GOLD(3); // 3ê°œì˜ ì´ëŠ„ ì˜¤ë¸Œì íŠ¸ ì •ì˜

  private final int value;

  Level(int value) { // DBì— ì €ì¥í•  ê°’ì„ ë„£ì–´ì¤„ ìƒì„±ìë¥¼ ë§Œë“¤ì–´ë‘”ë‹¤.
    this.value = value;
  }

  public int intValue() { // ê°’ì„ ê°€ì ¸ì˜¤ëŠ” ë©”ì†Œë“œ
    return value;
  }

  public static Level valueOf(int value) { // ê°’ìœ¼ë¡œë¶€í„° Level íƒ€ì… ì˜¤ë¸Œì íŠ¸ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ ë§Œë“  static method
    switch(value) {
      case1: return BASIC;
      case2: return SILVER;
      case3: return GOLD;
      default: throw new AssertionError("Unknown value: " + value);
    }
  }
}
```
- ìˆ«ì íƒ€ì…ì„ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ëŠ” **ì´ëŠ„(ENUM, ìë°”5 ì´ìƒì—ì„œ ì œê³µ)** ì„ ì´ìš©í•˜ëŠ” ê²Œ ì•ˆì „í•˜ê³  í¸ë¦¬í•˜ë‹¤.
- ë‚´ë¶€ì—ëŠ” DBì— ì €ì¥í•  int íƒ€ì…ì˜ ê°’ì„ ê°–ê³  ìˆì§€ë§Œ, ê²‰ìœ¼ë¡œëŠ” **Level íƒ€ì…ì˜ ì˜¤ë¸Œì íŠ¸**ì´ê¸° ë•Œë¬¸ì— **ì•ˆì „í•˜ê²Œ ì‚¬ìš©**í•  ìˆ˜ ìˆë‹¤.
- ì—†ëŠ” ì½”ë“œëŠ” ì»´íŒŒì¼ëŸ¬ê°€ íƒ€ì…ì´ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì—ëŸ¬ë¥¼ ë‚´ë©´ì„œ ê±¸ëŸ¬ì¤„ ê²ƒì´ë‹¤.

<br/>

> ***User í•„ë“œ ì¶”ê°€***


ğŸ”½ Userì— ì¶”ê°€ëœ í•„ë“œ
```java
public class User {
  ...
  Level level;
  int login;
  int recommend;

  public Level getLevel() {
    return level;
  }

  public void setLevel(Level level) {
    this.level = level;
  }
  ...
  // login, recommend getter/setter ìƒëµ
}
```

- Level íƒ€ì…ì˜ ë³€ìˆ˜ë¥¼ User í´ë˜ìŠ¤ì— ì¶”ê°€í•œë‹¤.
- (ì‚¬ìš©ì ë ˆë²¨ ê´€ë¦¬ ë¡œì§ì—ì„œ ì–¸ê¸‰) ë¡œê·¸ì¸ íšŸìˆ˜ì™€ ì¶”ì²œ ìˆ˜ë„ ì¶”ê°€í•œë‹¤.

<br/>

> ***UserDaoTest í…ŒìŠ¤íŠ¸ ìˆ˜ì •***

ğŸ”½ ìˆ˜ì •ëœ í…ŒìŠ¤íŠ¸ í”½ìŠ¤ì²˜
```java
public class UserDaoTest {
  ...
  @Before
  public void setUp() {
    this.user1 = new User("sohyeon", "ê¹€ì†Œí˜„", "springno1", Level.BASIC, 1, 0);
    this.user2 = new User("seungbin", "ìµœìŠ¹ë¹ˆ", "springno2", Level.SILVER, 55, 10);
    this.user3 = new User("chan", "ë‚¨ê¶ì°¬", "springno3", Level.GOLD, 100, 40);
  }
```
- UserDaoJdbcëŠ” í…ŒìŠ¤íŠ¸ê¹Œì§€ ê°–ì¶”ê³  ìˆëŠ” ì•ˆì •ëœ ì½”ë“œë‹¤. ê¸°ì¡´ ì½”ë“œì— ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë ¤ë©´ í…ŒìŠ¤íŠ¸ë¥¼ ë¨¼ì € ë§Œë“¤ì–´ì•¼ í•œë‹¤.
- í”½ìŠ¤ì²˜ë¡œ ë§Œë“  user1, user2, user3ì— ìƒˆë¡œ ì¶”ê°€ëœ ìƒˆ í•„ë“œì˜ ê°’ì„ ë„£ëŠ”ë‹¤. (ìœ ìš©í•˜ê²Œ ì“°ê¸° ìœ„í•´ ê°ê° ë‹¤ë¥¸ ê°’ ì‚½ì…)

<br/>

ğŸ”½ ì¶”ê°€ëœ í•„ë“œë¥¼ íŒŒë¼ë¯¸í„°ë¡œ í¬í•¨í•˜ëŠ” ìƒì„±ì
```java
class User {
  ...
  public User(String id, String name, String password, Level level, int login, int recommend) {
    this.id = id;
    this.name = name;
    this.password = password;
    this.level = level;
    this.login = login;
    this.recommend = recommend;
  }
```
- ì´ì— ë§ê²Œ User í´ë˜ìŠ¤ ìƒì„±ìì˜ íŒŒë¼ë¯¸í„°ë„ ì¶”ê°€í•´ì¤€ë‹¤.

<br/>

ğŸ”½ ìƒˆë¡œìš´ í•„ë“œë¥¼ í¬í•¨í•˜ëŠ” User í•„ë“œ ê°’ ê²€ì¦ ë©”ì†Œë“œ
```java
private void checkSameUser(User user1, User user2) {
  asssertThat(user1.getId(), is(user2.getId()));
  asssertThat(user1.getName(), is(user2.getName()));
  asssertThat(user1.getPassword(), is(user2.getPassword()));
  asssertThat(user1.getLevel(), is(user2.getLevel()));
  asssertThat(user1.getLogin(), is(user2.getLogin()));
  asssertThat(user1.getRecommend(), is(user2.getRecommend()));
}
```
- UserDaoTest í…ŒìŠ¤íŠ¸ì—ì„œ 2ê°œì˜ User ì˜¤ë¸Œì íŠ¸ í•„ë“œ ê°’ì´ ëª¨ë‘ ê°™ì€ì§€ ë¹„êµí•˜ëŠ” checkSameUser() ë©”ì†Œë“œë¥¼ ìˆ˜ì •í•œë‹¤.
- ìƒˆë¡œìš´ í•„ë“œë¥¼ ë¹„êµí•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•œë‹¤.

<br/>

ğŸ”½ checkSameUser() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë§Œë“  addAndGet() ë©”ì†Œë“œ
```java
@Test
public void addAndGet() {
  ...
  User userget1 = dao.get(user1.getId());
  checkSameUser(userget1, user1);

  User userget2 = dao.get(user2.getId());
  checkSameUser(userget2, user2);
}
```
- (ì•ìœ¼ë¡œ ì¶”ê°€ë˜ê±°ë‚˜ ë³€ê²½ë¼ë„ User ì˜¤ë¸Œì íŠ¸ë¥¼ **ë¹„êµí•˜ëŠ” ë¡œì§ì„ ì¼ì •í•˜ê²Œ ìœ ì§€**í•  ìˆ˜ ìˆë„ë¡) checkSameUser()ì„ ì´ìš©í•´ ìˆ˜ì •í•œë‹¤.

<br/>

> ***UserDaoJdbc ìˆ˜ì •***

ğŸ”½ ì¶”ê°€ëœ í•„ë“œë¥¼ ìœ„í•œ UserDaoJdbcì˜ ìˆ˜ì • ì½”ë“œ
```java
public class UserDaoJdbc implements UserDao {
  ...
  private RowMapper<User> userMapper =
    new RowMapper<User>() {
      public User mapRow(ResultSet rs, int rowNum) throws SQLException {
        User user = new User();
        user.setId(rs.getString("id"));
        user.setName(rs.getString("name"));
        user.setPassword(rs.getString("password"));
        user.setLevel(Level.valueOf(rs.getInt("level")));
        user.setLogin(rs.getInt("login"));
        user.setRecommend(rs.getInt("recommend"));
        return user;
      }
    };

public void add(User user) {
  this.jdbcTemplate.update(
    "insert into users(id, name, password, level, login, recommend) " +
    "values(?,?,?,?,?,?)", user.getId(), user.getName(), user.getPassword(),
    user.getLevel().intValue(), user.getLogin(), user.getRecommend());
}
```
- **add() ë©”ì†Œë“œì˜ SQL**ê³¼ **userMapper**(ê°ì¢… ì¡°íšŒ ì‘ì—…ì— ì‚¬ìš©ë˜ëŠ” User ì˜¤ë¸Œì íŠ¸ ë§¤í•‘ìš© ì½œë°±)ì— **ì¶”ê°€ëœ í•„ë“œ**ë¥¼ ë„£ëŠ”ë‹¤.
- Level ì´ëŠ„ì€ ì˜¤ë¸Œì íŠ¸(DBì— ì €ì¥ë  ìˆ˜ ìˆëŠ” SQL íƒ€ì…X)ì´ë¯€ë¡œ, **DBì— ì €ì¥ ê°€ëŠ¥í•œ ì •ìˆ˜í˜• ê°’ìœ¼ë¡œ ë³€í™˜**í•´ì¤˜ì•¼ í•œë‹¤.
- ë°˜ëŒ€ë¡œ **ì¡°íšŒ**í•  ê²½ìš°, ResultSetì—ì„œëŠ” **DBì˜ íƒ€ì…ì¸ intë¡œ level ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.**
- Levelì˜ valueOf() ë©”ì†Œë“œë¥¼ í†µí•´ int íƒ€ì…ì˜ ê°’ì„ Level íƒ€ì…ì˜ ì´ëŠ„ ì˜¤ë¸Œì íŠ¸ë¡œ ë§Œë“¤ì–´ì„œ setLevel() ë©”ì†Œë“œì— ë„£ì–´ì¤˜ì•¼ í•œë‹¤.

<br/>

